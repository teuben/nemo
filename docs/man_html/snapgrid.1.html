<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>SNAPGRID(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
HTML automatically generated with <A HREF=http://manpages.ubuntu.com/manpages/bionic/man1/rman.1.html>rman</A><br>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
snapgrid - grid a snapshot into a 2D or 3D image (cube), with optional
moments 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<p>
<b>snapgrid in=</b>snapshot <b>out=</b>image [parameter=value] 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<i>snapgrid</i>
grids three arbitrary <a href='bodytrans.3.html'><i>bodytrans(3NEMO)</i></a>
 expressions  (default: <b>x</b>, <b>y</b> and
<b>-vz</b>) of a snapshot into a 2D or 3D <a href='image.5.html'><i>image(5NEMO)</i></a>
 dataset, with optional astronomical
projection for direct comparision with astronomical images. <p>
The X and Y
coordinates of the datacube can only be regularly gridded in histogram
fashion  (for spatial XY-smoothing see <a href='ccdsmooth.1.html'><i>ccdsmooth(1NEMO)</i></a>
, for interpolating
see also <a href='snapmap.1.html'><i>snapmap(1NEMO)</i></a>
), however the Z coordinate has the property that
it can take moments in this variable, pick a number of planes or planes
with smoothing. <p>
The output image is written in standard <a href='image.5.html'><i>image(5NEMO)</i></a>
 format,
 and can be accessed by various other programs for smoothing, display etc.
<p>
Although <a href='snapgrid.1.html'><i>snapgrid(1NEMO)</i></a>
 can grid datacubes (e.g. X-Y-Z),  <a href='snapgridsmooth.1.html'><i>snapgridsmooth(1NEMO)</i></a>

is probably easier to use,  since it does not integrate along any lines
of sight, whereas this program is more suited for taking moments along
the 3rd axis. <p>
For images that require more accurate interpolation, instead
of this histogramming approach, use <a href='snapmap.1.html'><i>snapmap(1NEMO)</i></a>
. <p>
For a related program
that creates images (and can create movies as well), see <a href='uns_2dplot.1.html'><i>uns_2dplot(1NEMO)</i></a>
.
<p>
As of V6.0 the units in 3D cubes will be particle density. This ensures that
programs such as <a href='ccdmom.1.html'><i>ccdmom(1NEMO)</i></a>
 and <a href='ccdstat.1.html'><i>ccdstat(1NEMO)</i></a>
 give the proper answer
in their summed emission. <p>
In the <b>yt</b> package such images are called <i>phase
plot</i>, where a 2D grid  in field1 (<b>xvar=</b>) and field2 (<b>yvar=</b>) is computed,
with  some statistic (<b>mom=</b>) on field3 (<b>evar=</b>). 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
The following parameters
are recognized: 
<dl>

<dt><b>in=<i>in-file</i></b> </dt>
<dd>input file, must be in <a href='snapshot.5.html'><i>snapshot(5NEMO)</i></a>
 format.
Multiple snapshots can be stacked uses the <b>times=</b> keyword: see <b>stack=</b> below.
 [no default]. </dd>

<dt><b>out=<i>out-file</i></b> </dt>
<dd>output file, will be in <a href='image.5.html'><i>image(5NEMO)</i></a>
 format [no
default]. </dd>

<dt><b>times=</b><i>t1:t2,t3,..</i> </dt>
<dd>Selection of the times of snapshots to be selected
for gridding. For <b>stack=t</b> all snapshots will be co-added into one image,
however selecting <b>stack=f</b> or selecting multiple <b>evar</b>&rsquo;s one can request multiple
output images. [Default: <b>all</b>]. </dd>

<dt><b>xrange=<i>xb:xe</i></b> </dt>
<dd>Range in <b>xvar</b> to bin, the coordinates
are allowed to decrease as well as increase.  [default: <b>-2:2</b>].<br>
 </dd>

<dt><b>yrange=<i>xb:xe</i></b> </dt>
<dd>Range in <b>yvar</b> to bin [default: <b>-2:2</b>]. </dd>

<dt><b>zrange=<i>xb:xe</i></b> </dt>
<dd>Range in
<b>zvar</b> to bin, or take moments of [default: <b>-infinity:infinity</b>]. </dd>

<dt><b>xvar=</b><i>x-expression</i>
</dt>
<dd>The value of <i>x-expression</i> is gridded along the X axis. [default: <b>x</b>]. </dd>

<dt><b>yvar=</b><i>y-expression</i>
</dt>
<dd>The value of <i>y-expression</i> is gridded along the Y axis. [default: <b>y</b>]. </dd>

<dt><b>zvar=</b><i>z-expression</i>
</dt>
<dd>The value of <i>z-expression</i> is gridded along the Z axis (<b>nz</b>&gt;1),  or moments
taken off (<b>nz=1</b>). [default: <b>-vz</b>]. </dd>

<dt><b>evar=<i>emissivity</i></b> </dt>
<dd>Variable to denote emissivity
per particle. You can select more than 1 expression, in which case different
images will be written out (only in <b>stack=f</b> mode) [default: <b>m</b>]. </dd>

<dt><b>tvar=<i>tau</i></b>
</dt>
<dd>Variable to denote the optical depth of a particle. [Default: 0] </dd>

<dt><b>dvar=<i>depth</i></b>
</dt>
<dd>Variable to denote the line of sight. [Default: z] </dd>

<dt><b>svar=<i>smoothing</i></b> </dt>
<dd>Variable
to denote gaussian smoothing  Note this is the gaussian sigma, not the
FWHM (FMHW = 2.355 * sigma). </dd>

<dt><b>nx=<i>x-pixels</i></b> </dt>
<dd>Number of pixels along the X axis
of the cube [default: <b>64</b>]. </dd>

<dt><b>ny=<i>y-pixels</i></b> </dt>
<dd>Number of pixels along the Y axis
of the cube [default: <b>64</b>]. </dd>

<dt><b>nz=<i>z-pixels</i></b> </dt>
<dd>Number of pixels along the Z axis
of the cube. If one pixel is choosen, moments can be taken (see below),
else a simple gridding is used. [default: <b>1</b>]. </dd>

<dt><b>xlab=<i>x-label</i></b> </dt>
<dd>Text used to label
the X-axis. By default the <b>xvar</b> expression is used. It may be useful in certain
astronomical environment to label the axis with recognized labels like
RA---TAN, DEC--SIN, GLON etc. </dd>

<dt><b>ylab=<i>y-label</i></b> </dt>
<dd>Same for the Y-axis. </dd>

<dt><b>zlab=<i>z-label</i></b> </dt>
<dd>Same
for the Z-axis. </dd>

<dt><b>moment=<i>number</i></b> </dt>
<dd>Order of the Z-gridding. Most commonly choosen
are: <b>0</b> (total intensity), <b>1</b>  (velocity zvar weighted intensity) and <b>2</b> (velocity
square weighted intensity), where &rsquo;intensity&rsquo; should really be read as surface
density per  square unit length. Special values of <b>-1</b> and <b>-2</b> can be used to
directly compute the <i>evar</i> weighted mean and the dispersion from the mean.
<b>-3</b> and <b>-4</b> are used to compute the gaussian-hermitian h3 and h4 moments (see
e.g. van der Marel &amp; Franx, 1993) [default: <b>0</b>]. </dd>

<dt><b>mean=t|f</b> </dt>
<dd>Should the <i>emission</i>
in a cell be averaged? This also controls the units of the gridding. For
<b>mean=f</b> (the default) a <i>surface-density</i> is computed (emission per square
length),  whereas for <b>mean=t</b> the average per<br>
 pixel (or voxel) is computed of the units of emission. Another way of looking
 at this, <b>mean=t</b> is for interpolating maps (see also <a href='snapmap.1.html'><i>snapmap(1NEMO)</i></a>
), where
as <b>mean=f</b> is for splatting information as if this was observed. [Default:
<b>f</b>]. </dd>

<dt><b>stack=t|f</b> </dt>
<dd>Should all snapshots from the input file be stacked, or write
one image per selected (see <b>times=</b>) time? [default: <b>f</b>]. </dd>

<dt><b>integrate=t|f</b> </dt>
<dd>If
selected, instead of summing points along the <i>zvar</i>, they are sorted and
integrated along <i>dvar</i>. This is appropriate when emission represents something
like a density, instead of a mass, and a total column density is needed.
 ** This option can only compute 2D moment=0 maps  and also cannot handle
stacked snapshots yet ** [default: <b>f</b>]. </dd>

<dt><b>proj=</b> </dt>
<dd>If a valid projection type
(SIN, TAN, ARC, NCP, GLS, MER, AIT) but see also <a href='wcs.1.html'><i>wcs(1NEMO)</i></a>
, the input
coordinates are interpreted in angular degrees, and griddes with the appropriate
sky projection. Default: no sky projection. </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Examples</a></h2>
The following example
makes three moment images from an N-body snapshot, then smooths and combines
them into an &rsquo;intensity&rsquo; (<b>int</b>), &rsquo;mean velocity&rsquo; (<b>vel</b>) and &rsquo;velocity dispersion&rsquo;
(<b>sig</b>) map using a CCD math operator. <p>
Note that the moment maps must be smoothed
<i>before</i> they can be combined to the proper velocity and dispersion maps.
<br>
<pre>   % snapgrid in=nbody.dat out=map0 moment=0
   % snapgrid in=nbody.dat out=map1 moment=1
   % snapgrid in=nbody.dat out=map2 moment=2
   % ccdsmooth in=map0 out=map00 gauss=0.1
   % ccdsmooth in=map1 out=map11 gauss=0.1
   % ccdsmooth in=map2 out=map22 gauss=0.1
   % mv map00 int
   % ccdmath in=int,map11     out=vel  fie=%2/%1
   % ccdmath in=int,vel,map22 out=sig  fie="sqrt(%3/%1-%2*%2)"
   % rm map11 map22
</pre>Alternatively, with the option of using negative <b>moment</b>s, one can also
use (assuming no smoothing implemented): <br>
<pre>    % snapgrid in=nbody.dat out=int moment=0
    % snapgrid in=nbody.dat out=vel moment=-1
    % snapgrid in=nbody.dat out=sig moment=-2
</pre>Consider now the situation where a coordinate is regularly sampled, with
N values between A and B. In order to grid these, one would normally use
a range=A-dx/2:B+dx/2, where dx=(B-A)/(N-1).  One can also make a grid with
N cells with emission,  and K blank cells between each valued cell (K would
be typically small, perhaps 1 or 2). With NK=(K+1)N-K and dx=(B-A)/(NK-1),
a range=A-dx/2:B+dx/2 is used.  If this is done in both the X and Y dimension,
the program <a href='ccdintpol.1.html'><i>ccdintpol(1NEMO)</i></a>
 can be used to create a bi-linearly interpolated
grid with more pixels for a seemingly higher sampled map. Most likely the
option <b>mean=t</b> will have to be used to conserve units between runs with
different values of K. <p>
Here is an example of making a gridded map of ungridded
data. Both unweighted, and weighted. Suppose the snapshot has the weights
stored in the <i>Aux</i> field, and we use these as weights (i.e. sum(mass*Aux)/sum(Aux)
would be the quantity of interest). The unweighted average uses the <b>mean=t</b>
key: <br>
<pre>    snapgrid ... out=map0 evar=m mean=t
</pre>but the weighted average computes the two maps seperately and uses <a href='ccdmath.1.html'><i>ccdmath(1NEMO)</i></a>

to divide them to get the desired result: <br>
<pre>    snapgrid ... out=map1 evar=&rsquo;m*aux&rsquo; 
    snapgrid ... out=map2 evar=&rsquo;aux&rsquo; 
    ccdmath in=map1,map2 out=map3 fie="ifeq(%2,0,0,%1/%2)"
</pre>with an additional safeguard to set cells to 0 if no emission with found
in them. 
<h2><a name='sect5' href='#toc5'>Kinemetry</a></h2>
Krajnovic et al. (2006) popularized kinemetry, a description
of line of sight velocities in terms of the first four moments (v, sigma,
h3 and h4). The following example shows how to create these maps with <b>snapgrid</b>:
<br>
<pre>  % snapgrid ...
</pre>
<h2><a name='sect6' href='#toc6'>Units</a></h2>
Units are maintained in the same way as in snapshots, they don&rsquo;t have
a specific name, but carry their normal meaning &rsquo;length&rsquo;, &rsquo;velocity&rsquo; and &rsquo;mass&rsquo;.
Since <i>snapgrid</i> calculates (surface/space) densities, its units are formally
&rsquo;mass&rsquo; per square &rsquo;length&rsquo; times &rsquo;velocity&rsquo; to the power <b>moment</b>. Notice the <b>mean=</b>
keyword, which prevents division by the cellsize. <p>
When channel maps are
produced (<b>moment=0</b>),  the data are not normalized w.r.t. the convolving velocity
beam. For a rectangular beam (<b>vrange=vmin:vmax</b>) the data should formally
be divided by <b>(vmax-vmin)</b>, for a  gaussian beam (<b>vrange=vmean,vsig</b>) by <b>vsig*sqrt(2*pi)</b>.
Also remember that a gaussian beam has <b>FWHM = 2.355*sigma</b>. <p>
Although <a href='snapscale.1.html'><i>snapscale(1NEMO)</i></a>

can also be used, after a snapshot has been gridded into a map/cube, <a href='ccdsky.1.html'><i>ccdsky(1NEMO)</i></a>

can optionally be used to rescale a cube in astronomical units (degrees
and m/s) such  that exported FITS files can be compared directly with model
generated FITS files. 
<h2><a name='sect7' href='#toc7'>Bugs</a></h2>
Combinations of large snapshots and large images
may run into memory problems since both the snapshot and the image(s) must
fit into memory to obtain turbo speeds. Use non-negative <b>moment</b>s to avoid
having to allocate one or two extra images in addition to the snapshot
and the image.  <p>
Sky projections do not guarantee flux conservation.  
<h2><a name='sect8' href='#toc8'>See
Also</a></h2>
<a href='snapgridsmooth.1.html'>snapgridsmooth(1NEMO)</a>
, <a href='snapmap.1.html'>snapmap(1NEMO)</a>
, <a href='snaprotate.1.html'>snaprotate(1NEMO)</a>
, <a href='snapslit.1.html'>snapslit(1NEMO)</a>
,
<a href='snapifu.1.html'>snapifu(1NEMO)</a>
, <a href='snapsmooth.1.html'>snapsmooth(1NEMO)</a>
, <a href='uns_2dplot.1.html'>uns_2dplot(1NEMO)</a>
, <a href='snapaxsym.1.html'>snapaxsym(1NEMO)</a>
,
<a href='wcs.1.html'>wcs(1NEMO)</a>
, <a href='tsf.1.html'>tsf(1NEMO)</a>
, <a href='snapccd.1.html'>snapccd(1NEMO)</a>
, <a href='ccdintpol.1.html'>ccdintpol(1NEMO)</a>
, <a href='ccdstack.1.html'>ccdstack(1NEMO)</a>
,
<a href='ccdsky.1.html'>ccdsky(1NEMO)</a>
, <a href='image.5.html'>image(5NEMO)</a>
,  <p>
<a href='http://www.iinet.com.au/~watson/nngridr.html'>http://www.iinet.com.au/~watson/nngridr.html</a>

<p>
http://www.ncarg.ucar.edu//ngmath/natgrid/nnhome.html (based on NNGRIDR) <p>
<a href='http://tdc-www.harvard.edu/software/skypic/'>http://tdc-www.harvard.edu/software/skypic/</a>

<p>
<a href='http://dipastro.pd.astro.it/~cosmo/Splotch/'>http://dipastro.pd.astro.it/~cosmo/Splotch/</a>
 <p>
KinMSpy  <a href='https://github.com/TimothyADavis/KinMSpy'>https://github.com/TimothyADavis/KinMSpy</a>

<p>
FluxCompensator<tt> </tt>&nbsp;<tt> </tt>&nbsp; <a href='https://github.com/koepferl/FluxCompensator'>https://github.com/koepferl/FluxCompensator</a>
 <p>
cygrid:  <a href='http://ascl.net/cygrid'>http://ascl.net/cygrid</a>

  (1606.003) 
<h2><a name='sect9' href='#toc9'>Author</a></h2>
Peter Teuben 
<h2><a name='sect10' href='#toc10'>Files</a></h2>
<br>
<pre>src/nbody/image  <tt> </tt>&nbsp;<tt> </tt>&nbsp;snapgrid.c
</pre>
<h2><a name='sect11' href='#toc11'>Update History</a></h2>
<br>
<pre>19-jan-89<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.0: Created<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
12-mar-89<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.1: added emisitivity evar<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
2-nov-90<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.0: allow stacked snapshots<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
21-oct-91<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.0: moment -1,-2 implemented<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
12-jun-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.1: added times=<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
18-jul-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.2: fixed bug when moment&lt;0 and stacked snapshots<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
30-jul-93<tt> </tt>&nbsp;<tt> </tt>&nbsp;V4.0: allow multiple  evar&rsquo;s - default is now stack=f<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
18-jun-98<tt> </tt>&nbsp;<tt> </tt>&nbsp;V4.4: added xlab/ylab/zlab and allow range[0]&gt;range[1]<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
8-may-04<tt> </tt>&nbsp;<tt> </tt>&nbsp;V5.0: added proj= to optionallaly allow sky projections<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
7-feb-06<tt> </tt>&nbsp;<tt> </tt>&nbsp;V5.1: added integrate=t to deal with 3D density points<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
2-mar-11<tt> </tt>&nbsp;<tt> </tt>&nbsp;V5.3: moment -3,-4 implemented<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
18-may-12<tt> </tt>&nbsp;<tt> </tt>&nbsp;V5.4: added smoothing in VZ (szvar)
14-feb-13<tt> </tt>&nbsp;<tt> </tt>&nbsp;V6.0: units changed on a cube (now xyz-density instead of xy-surface
brightness)<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Examples</a></li>
<li><a name='toc5' href='#sect5'>Kinemetry</a></li>
<li><a name='toc6' href='#sect6'>Units</a></li>
<li><a name='toc7' href='#sect7'>Bugs</a></li>
<li><a name='toc8' href='#sect8'>See Also</a></li>
<li><a name='toc9' href='#sect9'>Author</a></li>
<li><a name='toc10' href='#sect10'>Files</a></li>
<li><a name='toc11' href='#sect11'>Update History</a></li>
</ul>
</body>
</html>
