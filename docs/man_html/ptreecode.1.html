<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>TREECODE(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
ptreecode - parallel treecode 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
mpirun -np NN partree.exe Nbody_file
Parameter_file Max_runtime 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<b>ptreecode</b> is a parallel version of
the treecode, using MPI. 
<h2><a name='sect3' href='#toc3'>Running</a></h2>
partree.exe does not use NEMO&rsquo;s user interface.
It simply takes 3 command line arguments.  On most MPI systems, you run
the code with: <br>
<pre>    mpirun -np NN partree.exe Nbody_file Parameter_file Max_runtime
</pre>where NN is the number of processors  (must be 2^n i.e 1, 2, 4, 8, 16, 32
etc.) <p>
On different systems, the number of processors may be specified  in
different ways e.g. on the T3D, you would use  <br>
<pre>    partree.exe -npes NN Nbody_file Parameter_file Max_runtime
</pre>but, on the T3E you would instead use <br>
<pre>    mpprun -nNN partree.exe etc.
</pre><p>
The 3 command line arguments are: <br>
<pre>Nbody_file     - the nbody data for the run (see below)
Parameter_file - input parameters for the run (see below)
Max_runtime    - maximum run time in seconds
                 After this time has elapsed the code will 
                 finish the step its working on, output the data 
                 and exit.  This is useful on parallel batch 
                 queues which have fixed time limits.  
                 Max_runtime can be set to the time
                 limit minus 10 minutes or some other value so 
                 the program will exit cleanly and dump the last 
                 completed step before the time limit is reached.
</pre>
<h2><a name='sect4' href='#toc4'>Nbody_file</a></h2>
The N-body file format is binary, and very basic.  Each particle
has a mass,  a position and a velocity given by the 7 values m, x, y, z,
vx, vy, vz. The gravitational constant, G=1, so your input masses  should
be calculated with this mind. The format is simply a list of N of these
7 4-byte IEEE floating point  vectors in C written as follows: </pre>
<p>  fwrite(&amp;m,sizeof(float),1,nbody_file_pointer);<br>
  fwrite(&amp;x,sizeof(float),1,nbody_file_pointer);<br>
  fwrite(&amp;y,sizeof(float),1,nbody_file_pointer);<br>
  fwrite(&amp;z,sizeof(float),1,nbody_file_pointer);<br>
  fwrite(&amp;vx,sizeof(float),1,nbody_file_pointer);<br>
  fwrite(&amp;vy,sizeof(float),1,nbody_file_pointer);<br>
  fwrite(&amp;vz,sizeof(float),1,nbody_file_pointer);<br>
 
<p> <br>
<pre>WARNING: On Dec Alpha&rsquo;s and IBM&rsquo;S the byte order for 4-byte IEEE floats 
is reversed (big_endian vs. little_endian or vice versa) so if 
you generate data on a DEC Alpha you will need to reverse the byte 
order from 1234 to 4321 for the data to be recognized on machines 
that use standard byte ordering for IEEE.
The program swapbytes (src is swapbytes.c) will reorder the bytes for you,
the NEMO program bswap does the same thing:

<tt> </tt>&nbsp;<tt> </tt>&nbsp;bswap in=in_file out=out_file len=4
</pre>
<h2><a name='sect5' href='#toc5'>Parameter_file</a></h2>
<br>
<pre>This file format is also rather simple.  You are
allowed to assign different softening lengths to the particles if you wish.
The first nsoft1 particles get the length rsoft1, the second nsoft2
particles get rsoft2 etc.  Here it is:
nparticles  nsoftenings
nsoft1 rsoft1
nsoft2 rsoft2
nsoftn rsoftn
theta
nsteps stepnum
t dt dtout dtcheck
nbody_file_prefix
Where,
nparticles  - number of particles
nsoftenings - number of particle softening lengths
nsofti      - number of particles with the i&rsquo;th softening length, rsofti
rsofti      - the i&rsquo;th softening length
theta       - opening angle for the treecode 
              recommended values are 0.9 &lt; theta &lt; 1.2
              smaller values give more accurate forces and longer runs
              1.2 gives error in forces around 1%.
nsteps      - number of steps
stepnum     - current step number
t           - current simulation time
dt          - leapfrog timestep
dtout       - output time interval
dtcheck     - checkpoint output time interval (not used currently)
nbody_file_prefix - what it says
</pre>
<h2><a name='sect6' href='#toc6'>Output</a></h2>
</pre>Output is more nbody and parameter files with an index showing the
appropriate step number.  These files can be used to restart the code. 
<p> The
file &lsquo;&lsquo;Report&rsquo;&rsquo; is also output and gives diagnostics of momentum and energy
conservation of the code at each time step.  Some sample output is 
<p> 
<p> t 0
P -0.508763 0.808938 0.0532085 J 20.4152 -41.709 -113.745 be, ke, pe 2*ke/pe -19.8647

<p>24.8928 -44.7575 -1.11234 
<p>   t - current time<br>
   P - total system momentum (Px,Py,Pz)<br>
   J - total system angular momentum (Jx,Jy,Jz)<br>
   ke - total kinetic energy<br>
   pe - total potential energy<br>
   be - ke+pe - total binding energy - should be conserved<br>
   2*ke/pe - virial ratio - for virialized systems = -1.0<br>
 </pre>
<h2><a name='sect7' href='#toc7'>Timing</a></h2>
Integrating a Plummer sphere of 128 (?check?) particles with accuracy
<i>eta=0.02</i> for about a crossing time (T=0 to T=2) takes about XX minutes on
a SUN 3/60 with a simple f68881 floating point chip.  
<h2><a name='sect8' href='#toc8'>Limitations</a></h2>
This release
does not include the cosmological, periodic boundary version of the code.

<h2><a name='sect9' href='#toc9'>Author</a></h2>
John Dubinski    
<h2><a name='sect10' href='#toc10'>Files</a></h2>
~/src/nbody/evolve/ptreecode<tt> </tt>&nbsp;<tt> </tt>&nbsp;source code, and
an example testrun 
<h2><a name='sect11' href='#toc11'>See Also</a></h2>
MPICH=<a href='http://www.mcs.anl.gov/mpi/'>http://www.mcs.anl.gov/mpi/</a>
  
<h2><a name='sect12' href='#toc12'>History</a></h2>
<br>
<pre>xx-mar-01<tt> </tt>&nbsp;<tt> </tt>&nbsp;First Public Release within NEMO<tt> </tt>&nbsp;<tt> </tt>&nbsp;John Dubinski   
26-apr-01<tt> </tt>&nbsp;<tt> </tt>&nbsp;man page written for NEMO<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre>
<p> <p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Running</a></li>
<li><a name='toc4' href='#sect4'>Nbody_file</a></li>
<li><a name='toc5' href='#sect5'>Parameter_file</a></li>
<li><a name='toc6' href='#sect6'>Output</a></li>
<li><a name='toc7' href='#sect7'>Timing</a></li>
<li><a name='toc8' href='#sect8'>Limitations</a></li>
<li><a name='toc9' href='#sect9'>Author</a></li>
<li><a name='toc10' href='#sect10'>Files</a></li>
<li><a name='toc11' href='#sect11'>See Also</a></li>
<li><a name='toc12' href='#sect12'>History</a></li>
</ul>
</body>
</html>
