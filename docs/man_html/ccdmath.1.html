<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>CCDMATH(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
HTML automatically generated with <A HREF=http://manpages.ubuntu.com/manpages/bionic/man1/rman.1.html>rman</A><br>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
ccdmath - map arithmetic using function expressions 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<p>
<b>ccdmath
in=</b>[image1[,image2,...]]  <b>out=</b>image <b>fie=</b>expression   
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<b>ccdmath</b> combines
maps through some simple operations to make a new map. It also handles a
few arithmetic functions, such as sqrt, exp, log10. See <a href='fie.3.html'><i>fie(3NEMO)</i></a>
 for a
full definition of the available functions and operations. Input maps are
referred to by <b>%n</b>, where <b>n</b> is the ordinal number of the input maps (1 being
the first one),  in the function expression <b>fie</b>. <p>
The program can also be
used in creation mode: when no input files are given, parameters <b>%x</b>, <b>%y</b>
and <b>%z</b> in <b>fie=</b>  can be used to refer to the X,  Y and Z pixel coordinates
in the map to be created, (0,0,0)  in pixel coordinates w.r.t. reference pixel.
<b>%w</b> and <b>%r</b> can be used for 2D and 3D radius w.r.t. reference pixel, again in
pixel coordinates. 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
The following parameters are recognized in
any order if the keyword is also given: 
<dl>

<dt><b>in=<i>in-file(s)</i></b> </dt>
<dd>list of input file
name(s), each in <a href='image.5.html'><i>image(5NEMO)</i></a>
 format. In case of multiple files, the list
must be space or comma separated. If no files are given, the program is
in creation mode. </dd>

<dt><b>out=<i>out-file</i></b> </dt>
<dd>output file, will be in <a href='Image.5.html'><i>Image(5NEMO)</i></a>
 format
[no default] </dd>

<dt><b>fie=<i>expression</i></b> </dt>
<dd>Expression how to manipulate the input maps
or create output map. Input maps are referred to by <b>%n</b> or <b>$n</b>, in creation
mode position is referred to by <b>%x</b> and <b>%y</b> [no default]. </dd>

<dt><b>size=<i>nx,ny,nz</i></b> </dt>
<dd>Size
of the output map in case program is in creation mode [default: 10,10,1].
</dd>

<dt><b>crpix=<i>r1,r2,r3</i></b> </dt>
<dd>(New) values for the reference pixel. Note these are in FITS
notation, i.e. (1,1,1) is the lower left of the first plane in a cube. Recall
that (nx+1)/2 is the central pixel in coordinate X, not nx/2! By default
the WCS is transferred from the first input image to the output image,
however, by using all 3 keywords  <b>crpix=,crval=,cdelt=</b> the WCS of the output
image can be overwritten. [Default: <b>1,1,1</b> for image creation]. </dd>

<dt><b>crval=<i>r1,r2,r3</i></b>
</dt>
<dd>(New) values for the reference pixel. [Default: <b>0,0,0</b> for image creation].
</dd>

<dt><b>cdelt=<i>r1,r2,r3</i></b> </dt>
<dd>(New) values for the pixel separation.  [Default: <i>1,1,1</i> for
image creation]. </dd>

<dt><b>seed=</b><i>integer</i> </dt>
<dd>seed for the random number generator (default:
a value 0, which will be converted into a unique new value using UNIX&rsquo;s
clock time, in seconds since once-upon-a-time-in-the-seventies). </dd>

<dt><b>replicate=t|f<b>
</b></b></dt>
<dd>Normally each input image needs to be of the same shape. Setting <b>replicate=t</b>
will allow the 3rd axis of a 2D map to be replicated in order for the <b>fie=</b>
expression to be parsed. Default: false </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Example</a></h2>
Create a &rsquo;difference&rsquo; map from
two input maps: <br>
<pre>   % ccdmath inmap1,inmap2 outmap "abs(%1-%2)"
</pre></b>create the maximum of two maps: <br>
<pre>   % ccdmath inmap1,inmap2 outmap "ifgt(%1,%2,%1,%2)"
</pre></b>create the difference of two maps if either of the two is not zero: <br>
<pre>   % ccdmath inmap1,inmap2 outmap "ifne(%1,0,%1-%2,ifne(%2,0,%1-%2,0))"
</pre>create a map from scratch: <br>
<pre>  % ccdmath out=newmap fie="exp(-((%x-50)/25)**2-((%y-50)/25)**2)" size=100,100
</pre>create a (2 plane 4x3 image) cube from scratch: <br>
<pre>  % ccdmath "" cube432 "%x+10*%y+100*%z" 4,3,2
</pre>create a new WCS for an existing cube, with reference value (0,0,0) in
the center of the cube, assuming you know the size of the cube (nx,ny,nz)
and pixel sizes (dx,dy,dz): <br>
<pre>  % ccdmath cube0 cube1 %1 crpix=$nx/2+0.5,$ny/2+0.5,$nz/2+0.5 crval=0,0,0
cdelt=$dx,$dy,$dz
</pre>and creating an annulus: <br>
<pre>  %  ccdmath "" map0 "ifgt(%w,20,1,iflt(%w,10,1,0))" size=512 crpix=256,256
</pre>Rescaling a map to a linear-log, retaining linear near 0, and logarithmic
in signal/noise for large values from the mean: <br>
<pre>  set s = 0.19
  cddmath map0 map0s "sign(%1)*$s*log(1+abs(%1)/$s)"
</pre>
<h2><a name='sect5' href='#toc5'>Timing</a></h2>
Performance on Rigel (SUN 3/160, 16Mhz): 
<p> <br>
<pre>100 * 100<tt> </tt>&nbsp;<tt> </tt>&nbsp;rang: 5.8"<tt> </tt>&nbsp;<tt> </tt>&nbsp;+: 3.4"  <tt> </tt>&nbsp;<tt> </tt>&nbsp;sqrt: 2.6"
200 * 200<tt> </tt>&nbsp;<tt> </tt>&nbsp;rang: 23.2<tt> </tt>&nbsp;<tt> </tt>&nbsp;+: 13.0"<tt> </tt>&nbsp;<tt> </tt>&nbsp;sqrt: 8.7"
300 * 300<tt> </tt>&nbsp;<tt> </tt>&nbsp;rang: 51.8"<tt> </tt>&nbsp;<tt> </tt>&nbsp;+: 31.3"<tt> </tt>&nbsp;<tt> </tt>&nbsp;sqrt: 23.8"
512 * 512<tt> </tt>&nbsp;<tt> </tt>&nbsp;rang: 152.7"<tt> </tt>&nbsp;<tt> </tt>&nbsp;+: 88.4"<tt> </tt>&nbsp;<tt> </tt>&nbsp;sqrt: 64.2"
</pre>
<p> For some historic amusement, this 512^2 <i>rang</i> benchmark measured in 1989
 took 153s. On a 2021 laptop this same benchmark took 0.81/64". Scaling this
it means 12,000 times faster, in 32 years of evolution of hardware. This
was a 4.2GHz i5-1135G7. For <a href='hackcode1.1.html'><i>hackcode1(1NEMO)</i></a>
 this was a factor of 26,000,
see <a href='bench.5.html'><i>bench(5NEMO)</i></a>
. 
<p> 
<h2><a name='sect6' href='#toc6'>See Also</a></h2>
<a href='fie.3.html'>fie(3NEMO)</a>
, <a href='image.5.html'>image(5NEMO)</a>
, <a href='tsf.1.html'>tsf(1NEMO)</a>
, <a href='ccdgen.1.html'>ccdgen(1NEMO)</a>
,
<a href='ccdsky.1.html'>ccdsky(1NEMO)</a>
 
<p> 
<h2><a name='sect7' href='#toc7'>Author</a></h2>
Peter Teuben 
<p> 
<h2><a name='sect8' href='#toc8'>Files</a></h2>
<br>
<pre>src/image/trans  <tt> </tt>&nbsp;<tt> </tt>&nbsp;ccdmath.c ccdmath.1
</pre>
<p> 
<h2><a name='sect9' href='#toc9'>Update History</a></h2>
<br>
<pre> 1-Jul-87<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.0: Created<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
 6-jul-87<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.1: order keywords changed for future enhancements<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
 1-jun-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.0: new filestruct, although code is same         <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
18-dec-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.1: new keyword structure, fie() used.         <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
22-jan-89<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.3: can make map from scratch using %x, %y and %z<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
1-mar-03<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.0: set/change the WCS<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
19-jun-03<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.1: allow %w and %r, and use offset from crpix<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
25-aug-04<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.2: fixed error in setting crpix (off by 2!)<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
25-dec-2020<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.3: add replicate=<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre>
<p> <p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Example</a></li>
<li><a name='toc5' href='#sect5'>Timing</a></li>
<li><a name='toc6' href='#sect6'>See Also</a></li>
<li><a name='toc7' href='#sect7'>Author</a></li>
<li><a name='toc8' href='#sect8'>Files</a></li>
<li><a name='toc9' href='#sect9'>Update History</a></li>
</ul>
</body>
</html>
