<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>SNAPCENTERS(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
This HTML automatically generated with <A HREF=http://manpages.ubuntu.com/manpages/bionic/man1/rman.1.html>rman</A> for <A HREF=https://astronemo.readthedocs.io>NEMO</A><br>
<a href='#toc'>Table of Contents</a><p>

<p> 
<h2><a name='sect0' href='#toc0'>Name</a></h2>
snapcenters - Center position of a snapshot based on shrinking sphere
method (Power2003) 
<p> 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<b>snapcenters</b> [parameter=value] 
<p> 
<h2><a name='sect2' href='#toc2'>Description</a></h2>

<p>
<b>snapcenters</b> estimates the center of a snapshot (<i>following the discussion
in Power et al. (2003)</i>) using an iterative technique in which the center
of mass of particles within a shrinking sphere is computed recursively
until a convergence criterion is met. At each step of the iteration, the
center of the sphere is reset to the last computed barycentre and the radius
of the sphere is reduced by 2.5 per cent. The iteration is stopped when a
specified number of particles (typically either 1000 particles or 1 per
cent of the particles within the high-resolution region, whichever is smaller)
is reached within the sphere. <p>
Halo centers identified with this procedure
are quite independent of the parameters chosen to initiate the iteration,
provided that the initial sphere is large enough to encompass a large fraction
of the system. In a multi-component system, such as a dark halo with substructure,
this procedure isolates the densest region within the largest subcomponent.
In more regular systems, the centre so obtained is in good agreement with
centres obtained by weighing the centre of mass by the local density or
gravitational potential of each particle. We have explicitly checked that
none of the results presented here are biased by our particular choice
of centering procedure. <i>end-quote</i>. <p>
For <b>snapcenters</b> an additional weight-factor
can be applied to each particle. See also <a href='snapcenter.1.html'><i>snapcenter(1NEMO)</i></a>
 and <a href='snapcenterp.1.html'><i>snapcenterp(1NEMO)</i></a>

for alternative approaches. In the examples of <a href='hackdens.1.html'><i>hackdens(1NEMO)</i></a>
 a table compares
the different approaches. <p>
Convergence can be sped up by using a larger shrinking
factor (the default is only 2.5%), by setting a finite tolerance on the
centering (eta=), since the default is 0, or by increasing the minimum
number of particles via fn=. 
<p> 
<p> 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
 The following parameters are recognized
in order; they may be given in any order if the keyword is also given. Use
<b>--help</b> to confirm this man page is up to date.  
<dl>

<dt><b>in=</b> </dt>
<dd>input snapshot file name,
containing one or more snapshots. <br>
No default </dd>

<dt><b>out=</b> </dt>
<dd>output snapshot file name  <br>
No default </dd>

<dt><b>weight=</b> </dt>
<dd>weight factor used finding center <br>
[m]   </dd>

<dt><b>times=</b> </dt>
<dd>range of times to process <br>
[all]   </dd>

<dt><b>report=</b> </dt>
<dd>report the center (in addition to some convergence paramters,
see below) <br>
[f]     </dd>

<dt><b>eta=</b> </dt>
<dd>Optional additional convergence stop criterion in position.
Unless relaxed tolerance is allowed, it&rsquo;&rsquo;s best to leave <b>eta=0</b> (the default).
<br>
[0]  </dd>

<dt><b>shrink=</b> </dt>
<dd>Reduction fraction for the rmax sphere per iteration <br>
[0.025]  </dd>

<dt><b>iter=</b> </dt>
<dd>Maximum number of iterations to use <br>
[20]  </dd>

<dt><b>center=</b> </dt>
<dd>Initial estimate for the center. If the true center is not
within <b>rmax</b> of <b>center</b>, it is unlikely the center will be found. <br>
[0,0,0]   </dd>

<dt><b>fn=</b> </dt>
<dd>Minimum fraction of particles needed in shrinking rmax area.
It is adviced to keep at least 1%. If a value &gt; 1 is given, it is assumed
to be the number of particles instead. <br>
[0.01] </dd>

<dt><b>rmax=</b> </dt>
<dd>Initial radius to shrink from, should be a good size fraction
of the system size. <br>
[10]   </dd>

<dt><b>one=</b> </dt>
<dd>Only output COM as a snapshot? <br>
[not implemented] 
<p> </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Convergence</a></h2>

<p> For each iteration the radius is shrunk,
and if convergence is reached, it is reported. E.g. 
<p>  
<p> % mkplummer - 2000 seed=123
| snapcenters -  . report=t  ### nemo Debug Info: Rmax=10 n=1995 ### nemo
Debug Info: Rmax=9.75 n=1995 ### nemo Debug Info: Rmax=9.50625 n=1994 ###
nemo Debug Info: Rmax=9.26859 n=1994 4 3 9.26859    -0.005191 0.023738 0.015025

<p> Printed are: convergence reason, #iters, rmax, xcenter, ycenter, zcenter

<p>   convergence reason:<br>
   0 - unexpected convergence (should never occur)<br>
   1 - eta was reached. By setting eta=0 [the default] this should never
happen<br>
   2 - iteration max was reached<br>
   3 - nmin was reached (the goal of Power2003)<br>
   4 - number in shrinking sphere hasn&rsquo;t changed (not tested for, should
rarely occur)<br>
   <br>
 
<p>  
<p> 100/50     0.119 400/200    0.062 1600/800   0.031 
<p> 1000/500   0.040 2000/1000
 0.032 4000/2000  0.021 8000/4000  0.015 /2000 0.017   /1000 0.020 
<p> 
<h2><a name='sect5' href='#toc5'>Caveats</a></h2>
This
program is still being developed. <p>
Searching is done in Pos space using rmax,
there is no eqv. vmax search. 
<p> 
<p> 
<p> 
<h2><a name='sect6' href='#toc6'>Examples</a></h2>
An example...    $ mkplummer - 2000
| snapshift - - 5,0,0 | snapcenters -  . report=t <br>
 
<p> mkplummer - 1000 nmodel=100 | snapshift - - 0,0,0 | snapcenters -  . report=t
 debug=-1  | tabhist - 4 -0.2 0.2 -&gt; 0.020 
<p>  
<p> 
<h2><a name='sect7' href='#toc7'>See Also</a></h2>
<a href='snapcenterp.1.html'>snapcenterp(1NEMO)</a>
, <a href='snapcenter.1.html'>snapcenter(1NEMO)</a>
,
<a href='bodytrans.3.html'>bodytrans(3NEMO)</a>
, <a href='hackdens.1.html'>hackdens(1NEMO)</a>
, <a href='snapshot.5.html'>snapshot(5NEMO)</a>
 <br>
<pre>Power et al (2003) - 2003MNRAS.338...14P - shrinking sphere method, S2.5
</pre>
<p> 
<h2><a name='sect8' href='#toc8'>Files</a></h2>
NEMO/src/nbody/trans/snapcenters.c 
<p> 
<h2><a name='sect9' href='#toc9'>Ads</a></h2>
@ads <A HREF=https://ui.adsabs.harvard.edu/abs/2003MNRAS.338...14P> 2003MNRAS.338...14P </A>
<p> 
<p> 
<h2><a name='sect10' href='#toc10'>Author</a></h2>
Peter

<p>Teuben 
<p> 
<h2><a name='sect11' href='#toc11'>Update History</a></h2>
<br>
<pre>16-may-2025<tt> </tt>&nbsp;<tt> </tt>&nbsp;0.1 Drafted <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
19-may-2025<tt> </tt>&nbsp;<tt> </tt>&nbsp;0.4 renamed keywords to shrink= and fn=<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Convergence</a></li>
<li><a name='toc5' href='#sect5'>Caveats</a></li>
<li><a name='toc6' href='#sect6'>Examples</a></li>
<li><a name='toc7' href='#sect7'>See Also</a></li>
<li><a name='toc8' href='#sect8'>Files</a></li>
<li><a name='toc9' href='#sect9'>Ads</a></li>
<li><a name='toc10' href='#sect10'>Author</a></li>
<li><a name='toc11' href='#sect11'>Update History</a></li>
</ul>
</body>
</html>
