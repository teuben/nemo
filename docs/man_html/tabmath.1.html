<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>TABMATH(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
tabmath - general table manipulator 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<p>
<b>tabmath in=</b>table-file <b>out=</b>table-file
 [parameter=value] ... 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<i>tabmath</i> has a few simple functions to modify
a file in tabular format, similar to a spreadsheet calculator. It can handle
an arbitrary number of files, though the total number of columns (old and
new) is limited (currently 256). Column operations are most common, although
a limited number of row operations are also possible. <p>
New columns are computed
with the keyword <b>newcol</b>, and needs a functional description of the new
columns, usually in terms of previous columns. Any previous columns (including
the ones just created) must be referenced by number through an escape (<b>%</b>)
command. <i>e.g.</i> <b>newcol=sqrt(%1)</b> creates a new column which is the <i>sqrt</i> of the
first one. Valid column references are %1 and up. Column reference to 0 (i.e.
%0) is interpreted as the line number (1 and up, excluding comment lines).
Although the escape command can also be a dollar (<b>$</b>) sign, this creates
some discomfort in a Unix command line environment. <p>
The keyword <b>delcol</b> has
to be used to delete computed columns, the word <b>all</b> can be used to delete
all original input columns. <p>
Rows can also be deleted/selected based on a
function evaluation of the current column values. For this the <b>selfie=</b> keyword
can be used. It uses the same <a href='nemoinp.3NEMO.html'><i>nemoinp(3NEMO)</i></a>
 syntax as those for the new
column expressions. It must evaluate to exactly 0 in order for a row not
to be written. For example "<i>selfie=iflt(%1,3,1,0)</i>" would only output rows
in which the first column is less than 3. <p>
Tablefiles are simple ascii files
in a columnar format. Lines which start with a # symbol are interpreted
as comment lines and are skipped. 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
The following parameters are
recognized in any order if the keyword is also given: 
<dl>

<dt><b>in=<i>in-file</i></b> </dt>
<dd>input (ascii)
file, a table of values from which data is taken. Multiple files must be
separated by comma&rsquo;s. [no default]. </dd>

<dt><b>out=<i>out-file</i></b> </dt>
<dd>Output filename where the
output data are written [no default]. </dd>

<dt><b>newcol=<i>expression</i></b> </dt>
<dd>Expression with
which the newly added column(s) will be calculated. Parsing will be done
by <a href='fie.3NEMO.html'><i>fie(3NEMO)</i></a>
, see the man pages for specific rules. [no default]. </dd>

<dt><b>delcol=<i>expression</i></b>
</dt>
<dd><i>expression</i> is an integer range to denote the columns not to be copied to
output, e.g. <b>3,5:10,14</b> would select columns 3, 5 through  10, and 14. The
word <b>all</b> may also be used, in which case all columns from the input file(s)
are deleted, and only  [Default: not used, i.e. all columns, old and new,
are output]. </dd>

<dt><b>selfie=<i>expression</i></b> </dt>
<dd>Expression which must evaluate to 0 if a
row is not to be output. </dd>

<dt><b>format=<i>expression</i></b> </dt>
<dd>A (<a href='printf.3.html'><i>printf(3)</i></a>
) format specification
with which the new columns are written to output [<b>%g</b>]. </dd>

<dt><b>seed=</b><i>seed</i> </dt>
<dd>Integer
initial seed in case random numbers have been used in the expression. If
0 is given, the time of the day will be used (see  <a href='xrandom.3NEMO.html'><i>xrandom(3NEMO)</i></a>
 for other
special seed values) to initialize the random number generator. [Default:
<b>0</b>]. </dd>

<dt><b>comments=f|t</b> </dt>
<dd>Should comments be passed through to the output, or discarded.
By default comments are ignored, but with comments=t they can be output
unmodified also . Be careful with multiple input files that do not have
the same amount of comment lines. </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Example</a></h2>
To use <i>tabmath</i> as a function calculator,
uses stdin (-) and stdout (-) as filenames for input and output, e.g. <br>
<pre>tabmath - - "sqrt(%1)" allb
</pre>Then for every number you input, it returns the function value. <p>
Here are
two examples how to create a table from scratch: <br>
<pre>    nemoinp 1:100:2 newline=t &gt; odd.tab
    nemoinp 1::50   newline=t &gt; one.tab
will contain a table with all odd numbers from 1 through 99, and
another table with all 1s. Both tables have 50 rows.

Most table programs in NEMO only operate on columns. 
No functions exist yet to operate
on rows, other than selecting rows for output (see selfie=).
As an example to look at a running derivative between two columns,
awk(1) can be used as follows:

% nemoinp 1:10 | tabmath - - &rsquo;%1*2+rang(0,0.1)&rsquo; seed=1 | diffs.awk
2 3.94938 1 2.08013 1.5 1.86925
3 6.07426 2 3.94938 2.5 2.12488
4 8.14975 3 6.07426 3.5 2.07549
5 9.96586 4 8.14975 4.5 1.81611
6 11.8817 5 9.96586 5.5 1.91584
7 13.9754 6 11.8817 6.5 2.0937
8 16.0503 7 13.9754 7.5 2.0749
9 17.9156 8 16.0503 8.5 1.8653
10 19.8898 9 17.9156 9.5 1.9742
% cat diffs.awk
#! /bin/awk -f
#
{
  if (NR &gt; 1) {
    print $1, $2, xold, yold, ($1+xold)/2, ($2-yold)/($1-xold);
  }
  xold = $1;
  yold = $2;
}
</pre>
<p> Here is an example to select only rows from a table where column 4 is
between values $a and $b: <br>
<pre>   tabmath file - selfie="ifgt(%4,$a,iflt(%4,$b,1,0),0)"
</pre>
<h2><a name='sect5' href='#toc5'>Common Expressions</a></h2>
Although <a href='fie.3NEMO.html'>fie(3NEMO)</a>
 expressions  are quite rich, some
common boolean constructions are hard to write down (ever written complex
SQL expressions?). So, here are some common ones. We will use a notation
where P1, P2, .. refer to the parameters 1,2,...,  that match %1,%2,... in fie
notation, and  V1,V2,... to some arbitrary values (numbers), and R1 and R2
to the two return values depending if the boolean expression is true (R1)
or false (R2): <br>
<pre>(P1&gt;V1) ? R1 : R2       <tt> </tt>&nbsp;<tt> </tt>&nbsp;ifgt(%1,V1,R1,R2)
(P1&gt;V1 &amp;&amp; P2&gt;V2) ? R1 : R2<tt> </tt>&nbsp;<tt> </tt>&nbsp;ifgt(%1,V1,ifgt(%2,V2,R1,R2),R2)
(V1&lt;P1&lt;V2) ? R1 : R2        <tt> </tt>&nbsp;<tt> </tt>&nbsp;ifgt(%1,V1,iflt(%1,V2,R1,R2),R2)
</pre>
<h2><a name='sect6' href='#toc6'>See Also</a></h2>
<a href='colrm.1.html'>colrm(1)</a>
, <a href='expand.1.html'>expand(1)</a>
, <a href='awk.1.html'>awk(1)</a>
, <a href='cut.1.html'>cut(1)</a>
, <a href='paste.1.html'>paste(1)</a>
, <a href='tablines.1NEMO.html'>tablines(1NEMO)</a>
,
<a href='tabtranspose.1NEMO.html'>tabtranspose(1NEMO)</a>
, <a href='tabplot.1NEMO.html'>tabplot(1NEMO)</a>
, <a href='table.5NEMO.html'>table(5NEMO)</a>
 <p>
jdb (http://www.isi.edu/~johnh/SOFTWARE/JDB/):
 a package of commands for manipulating flat-ASCII databases from shell
scripts. <p>
msort - <a href='http://billposer.org/Software/msort.html'>http://billposer.org/Software/msort.html</a>
 - sophisticated sorting
 program <p>
starbas - <a href='http://cfa-www.harvard.edu/~john/starbase/starbase.html'>http://cfa-www.harvard.edu/~john/starbase/starbase.html</a>
 -
an ASCII relational database for UNIX. 
<h2><a name='sect7' href='#toc7'>Author</a></h2>
Peter Teuben 
<h2><a name='sect8' href='#toc8'>Bugs</a></h2>
Parsing of
<b>newcol</b> expression is done by <a href='nemoinp.3NEMO.html'><i>nemoinp(3NEMO)</i></a>
, and  is space sensitive. Parsing
allows more than one value, e.g. "1 _+ 1" is interpreted as two values, instead
of the number 2. "1+1" would be interpreted as 2. Hence multiple columns
(with probably the wrong value) would be created in the first example. <p>
If
comments are passed on, processing multiple input files which do not have
matching comment lines will cause the output to have odd lines. <p>
Complex
expressions where one component fails, fails the whole expression.  An example
is adding two gaussians with different widths. The one with the narrow gaussian
component will cause an internal failure (exp() argument overflow). For
example, the following expression to add two gaussians <br>
<pre>fie="$a1+$b1*exp(-(%1-$c1)**2/(2*$d1**2)) + 
     $a2+$b2*exp(-(%1-$c2)**2/(2*$d2**2)) + 
     rang(0,$sig)"
</pre>
<p>can only be reliably be done as follows 
<p> <br>
<pre>nemoinp $x |
   tabmath - - "$b1*exp(-(%1-$c1)**2/(2*$d1**2))" |
   tabmath - - "$b2*exp(-(%1-$c2)**2/(2*$d2**2))" |
   tabmath - - "%1,%2+%3+$a1+$a2+rang(0,$sig)" all
</pre>
<p> 
<h2><a name='sect9' href='#toc9'>Update History</a></h2>
<br>
<pre>18-May-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.0 created<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
1-Jun-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.1 name changed nemotable-&gt;tabmath<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
xx-jun-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.2 added stride keyword<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
23-aug-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.3 added in2 keyword, removed stride bug<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
27-oct-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.4 multiple new columns and %0 reference allowed<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
10-nov-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.5 allow tab;s also as column separators<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
18-feb-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.0 turbospeed parsing now done by fie()<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
13-jun-98<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.0 deleted stride/skip keywords, added selfie=<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
24-feb-00<tt> </tt>&nbsp;<tt> </tt>&nbsp;document improved<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT/VS
18-apr-01<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.1 added comments=<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Example</a></li>
<li><a name='toc5' href='#sect5'>Common Expressions</a></li>
<li><a name='toc6' href='#sect6'>See Also</a></li>
<li><a name='toc7' href='#sect7'>Author</a></li>
<li><a name='toc8' href='#sect8'>Bugs</a></li>
<li><a name='toc9' href='#sect9'>Update History</a></li>
</ul>
</body>
</html>
