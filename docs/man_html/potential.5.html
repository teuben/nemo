<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>POTENTIAL(5NEMO) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
potential - format for (flow) potential (and force field) description
(functors) 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<br>
<pre> #include &lt;potential.&gt;h
 #include &lt;potential_float.h&gt;      /* optional */
 typedef struct {
    string name;
    string pars;
    string file;
    struct a_potential *next;
 } a_potential; 
void inipotential (npar, par, name)
int *npar;      <tt> </tt>&nbsp;<tt> </tt>&nbsp;/* number of parameters (I) */double par[];   <tt> </tt>&nbsp;<tt> </tt>&nbsp;/* list of
parameters (I/O) */char *name;     <tt> </tt>&nbsp;<tt> </tt>&nbsp;/* optional (file) name for data (I)
*/
void potential_double (ndim, pos, acc, pot, time)
const int *ndim;     <tt> </tt>&nbsp;<tt> </tt>&nbsp;/* number of dimensions (I) */const double pos[];
 <tt> </tt>&nbsp;<tt> </tt>&nbsp;/* position (I) */double acc[], *pot;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* forces and potential (O) */const
double *time;        /* time (I) */
void potential_float (ndim, pos, acc,
pot, time)
const int *ndim;     <tt> </tt>&nbsp;<tt> </tt>&nbsp;/* number of dimensions (I) */const float pos[]; 
<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* position (I) */float acc[], *pot;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* forces and potential (O) */const
float *time;        /* time (I) */
integer function  inipotential (npar,
par, name)
integer npardouble precision par(*)character name*(*)
integer function potential_double
(ndim, pos, acc, pot, time)
integer ndim     double precision pos(*)double precision acc(*) double
precision potdouble precision time
integer function potential_float (ndim,
pos, acc, pot, time)
integer ndim     real pos(*)real acc(*) real potreal time</pre>
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<i>potential</i>
is a convenient data structure to hold an ascii description of a user selected
potential, and all it&rsquo;s descriptors (id-name, parameters, associated strings/file(s)).
It is currently also stored in the <a href='orbit.5.html'><i>orbit(5NEMO)</i></a>
 data structure. <p>
<a href='potential.5.html'><i>potential(5NEMO)</i></a>

 is a &rsquo;filestructure&rsquo; which  defines a potential (and force/density or velocity
field)  through a standardized  interface routine, as described in <a href='potential.3.html'><i>potential(3NEMO)</i></a>
.
<p>
A <a href='potential.5.html'><i>potential(5NEMO)</i></a>
 datafile <b>must</b> have two (or three) externally accessible
routines  <b>inipotential</b> and <b>potential_double</b> and/or <b>potential_flot</b>, (old
name:<b>potential</b>) with a  parameter sequence as described above. The parameters
are all called by reference to allow interfaces with some common but more
primitive languages. Notably FORTRAN is now supported in the BSD calling
convention of parameters (see <b>potentialf.c</b>). The first parameter, <b>par[0]</b>
in C, and <a href='par.1.html'><b>par(1)</b></a>
 in fortran, is reserved for the pattern speed. User written
potentials must take this into account. And return the pattern speed (or
it&rsquo;s default) in that location. If another parameter describes the pattern
speed (e.g. the lagrangian radius, as in <i>athan92</i>),  <i>inipotential</i>  must compute
the pattern speed and return it in the first parameter. 
<h2><a name='sect3' href='#toc3'>Examples</a></h2>
The following
table lists the non-pattern speed parameters  for a few example potentials
found in <b>$NEMOOBJ/potential</b>. <i>Note: the pattern speed is not listed here</i>
<p>
<br>
<pre>harmonic<tt> </tt>&nbsp;<tt> </tt>&nbsp;wx,wy,wz<tt> </tt>&nbsp;<tt> </tt>&nbsp;1,1,1
plummer<tt> </tt>&nbsp;<tt> </tt>&nbsp;m,a      <tt> </tt>&nbsp;<tt> </tt>&nbsp;1,1
log  <tt> </tt>&nbsp;<tt> </tt>&nbsp;mc,rc,q  <tt> </tt>&nbsp;<tt> </tt>&nbsp;1,1,1
bar83<tt> </tt>&nbsp;<tt> </tt>&nbsp;fm,fx,ca<tt> </tt>&nbsp;<tt> </tt>&nbsp;1.334697416,8.485281374,0.2
hackforce<tt> </tt>&nbsp;<tt> </tt>&nbsp;tol,eps,rsize,fcells<tt> </tt>&nbsp;<tt> </tt>&nbsp;1,0.025,4,0.75
ccd<tt> </tt>&nbsp;<tt> </tt>&nbsp;Iscale,Xcen,Ycen,Dx,Dy<tt> </tt>&nbsp;<tt> </tt>&nbsp;1,0,0,1,1
</pre>A full listing, including their mathematical expression can be found in
the NEMO manual, see also <i>$NEMO/text/manuals/potential.inc,</i>, and of course
in <i>$NEMO/src/orbit/potential/data</i>. 
<h2><a name='sect4' href='#toc4'>Bugs</a></h2>
Since the later introduction of a
third character valued parameter in <i>inipotential()</i> a Fortran-to-C interface
cannot be used in as portable a way as before. A small Fortran-to-C interface
is however available, but is not guaranteed to work on all machines. Also
keep in mind if you write your potentials in fortran: common blocks and
other used routines get loaded into the executable, with the potential
for duplicate symbol names. 
<p> Most likely <a href='loadobj.3.html'><i>loadobj(3NEMO)</i></a>
 will break under
such circumstances. <p>
Second: no I/O should be done. In practise this also
means that this third parameter, <b>potfile</b>, of <i>inipotential</i> cannot be used,
as is mostly serves as a filename. The reason is that we didn&rsquo;t want the
programs to have to link in huge fortran I/O libraries, including various
portability problems.  <p>
There is one exception: <a href='potlist.1.html'><i>potlist(1NEMO)</i></a>
 is allowed
to  load <a href='potential.5.html'><i>potential(5NEMO)</i></a>
 files with FORTRAN WRITE statements. After you
have made sure the function works as you think,  these statements must
be Commented out and can then be reloaded by most other potential/orbit
programs. 
<h2><a name='sect5' href='#toc5'>Flow Potentials</a></h2>
Experimental changes to the interface were implemented
by the <a href='flowcode.1.html'><i>flowcode(1NEMO)</i></a>
 and <a href='vpotcode.1.html'><i>vpotcode(1NEMO)</i></a>
 code. This requires special versions
of potential desriptors, with the same calling convention but different
meaning to the arguments: <p>
<b>flowcode</b> uses a potential which returns the (currently
2-dimensional) velocities at the requested input position. These are returned
in the <b>acc</b> slot. The <b>pot</b> has no meaning, though is used to represent densities
in programs like <a href='mkflowdisk.1.html'><i>mkflowdisk(1NEMO)</i></a>
. <p>
<b>vpotcode</b> uses a potential which expects
the velocity to be  input in the <b>acc</b> slot, but the returned arguments (<b>acc</b>
and <b>pot</b>) have the same meaning. This is to emulate (non-coriolis) forces
which depend on velocity. <p>
<b>mkflowdisk</b> initializes a 2D disk based on the
flow velocities. 
<h2><a name='sect6' href='#toc6'>Meridional Plane in Axisymmetric Potentials</a></h2>
A well known
fact about meridional motion in an axisymmetric system is that their 3D
motion is really a 2D motion in the R-z plane with an effective potential
<br>
<pre>                      L**2
            Phi +    ------
                     2 * R**2
</pre>but unlike motion in rotating potential this requires the authors of potentials
to modify their code in something like the following: (pos[0] is R, pos[1]
is z, pos[2] is not used) <br>
<pre>    double tmp = sqr(ang_mom/pos[0]);
    *pot += 0.5*tmp;
    acc[0] += tmp / pos[0];
</pre>
<h2><a name='sect7' href='#toc7'>Environment</a></h2>
The environment variable <b>POTPATH</b> can be used to search for potentials
in other than the local directory. 
<h2><a name='sect8' href='#toc8'>Other</a></h2>
See also the "pav" format used in
the LP-VI code (Carpintero et al.  ascl1501.007) 
<h2><a name='sect9' href='#toc9'>Caveat</a></h2>
Since the old format
did not use _float or _double, there will be some potentials with no _float
support, since _double is the default if  not present in the symbol table.
For C/C++ routines authors are recommended to either split their potential()
in a potential_double() and potential_float(), or rename potential() to
potential_double() and include &lt;potential_float.h&gt; (available for NEMO 3.2.2
and above) to have _float call  _double (the penalty for this is about
4%). 
<h2><a name='sect10' href='#toc10'>See Also</a></h2>
<a href='get_potential.3.html'>get_potential(3NEMO)</a>
, <a href='orbit.5.html'>orbit(5NEMO)</a>
, <a href='acceleration.5.html'>acceleration(5NEMO)</a>
, <a href='manipulator.5.html'>manipulator(5NEMO)</a>
,
<a href='flowcode.1.html'>flowcode(1NEMO)</a>
, <a href='mkflowdisk.1.html'>mkflowdisk(1NEMO)</a>
, <a href='vpotcode.1.html'>vpotcode(1NEMO)</a>
 
<h2><a name='sect11' href='#toc11'>Author</a></h2>
Peter Teuben

<h2><a name='sect12' href='#toc12'>Files</a></h2>
<br>
<pre>~/src/orbit/potential   potential.c, potential.h potentialf.c
~/text/manuals      <tt> </tt>&nbsp;<tt> </tt>&nbsp;potential.inc (latex description)
</pre>
<h2><a name='sect13' href='#toc13'>Update History</a></h2>
<br>
<pre>13-Jul-87<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.0: Original created<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
8-Apr-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.0: added parameter &rsquo;name&rsquo; for hackforce<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
13-Mar-89<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.1: added &rsquo;name_len&rsquo; in case fortran interface<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
9-feb-90<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.0: added time parameter to potential()<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
24-may-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;V4.0: documented the new potential struct   PJT
11-oct-93<tt> </tt>&nbsp;<tt> </tt>&nbsp;V5.0: formalized get_pattern<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
16-apr-96<tt> </tt>&nbsp;<tt> </tt>&nbsp;documented &rsquo;flowcode&rsquo; and &rsquo;vpotcode&rsquo; deviations <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
19-sep-01<tt> </tt>&nbsp;<tt> </tt>&nbsp;documented _float/_double                        <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
19-nov-03<tt> </tt>&nbsp;<tt> </tt>&nbsp;more flow documentation, added mkflowdisk<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
19-jul-04<tt> </tt>&nbsp;<tt> </tt>&nbsp;promote acceleration(5)  <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Examples</a></li>
<li><a name='toc4' href='#sect4'>Bugs</a></li>
<li><a name='toc5' href='#sect5'>Flow Potentials</a></li>
<li><a name='toc6' href='#sect6'>Meridional Plane in Axisymmetric Potentials</a></li>
<li><a name='toc7' href='#sect7'>Environment</a></li>
<li><a name='toc8' href='#sect8'>Other</a></li>
<li><a name='toc9' href='#sect9'>Caveat</a></li>
<li><a name='toc10' href='#sect10'>See Also</a></li>
<li><a name='toc11' href='#sect11'>Author</a></li>
<li><a name='toc12' href='#sect12'>Files</a></li>
<li><a name='toc13' href='#sect13'>Update History</a></li>
</ul>
</body>
</html>
