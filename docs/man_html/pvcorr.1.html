<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>PVCORR(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
HTML automatically generated with <A HREF=http://manpages.ubuntu.com/manpages/bionic/man1/rman.1.html>rman</A><br>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
pvcorr - PV map or XYV cube cross correlation search for spectral lines

<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<b>pvcorr</b> [parameter=value] 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
Using a template area/volume
in a PV map or XYV cube, this template is shifted in the velocity (V) direction
and a cross correlation is computed as function of V. Normally a strong
known line will be selected as template,  with a known rest frequency,
from which the other lines can then be identified. See also <a href='tabpeak.1.html'><i>tabpeak(1NEMO)</i></a>

to find the peaks in the output from this program. Some renormalizations
are then needed, which in the presence of doppler shifts comes with some
 elaborate math. An example of this is given below for the low redshift
galaxy N253 in the case of some ALMA observations. 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
The following
parameters are recognized in any order if the keyword is also given: 
<dl>

<dt><b>in=</b>
</dt>
<dd>Input image file - must be an PV map, with V along the Y-axis, or a XYV cube,
with V along the Z-axis. No default. </dd>

<dt><b>clip=</b> </dt>
<dd>Clip value, above which to search
for valid profiles in the template area defined between rows/planes <b>v0</b>
and <b>v1</b> (inclusive). </dd>

<dt><b>v0=</b> </dt>
<dd>First row to search for the template, based on the
<b>clip=</b> level.  If none given, the program will find the largest peak in the
map/cube and decide on a reasonable template. Rows are 1-based. [-1] </dd>

<dt><b>v1=</b> </dt>
<dd>Last
row to search for template. [-1] </dd>

<dt><b>vscale=</b> </dt>
<dd>Scale the velocity pixel size by
this number to get more presentable numbers in the output. Astronomical
data sometimes appear in Hz or m/s. For 2D maps this should be the Y coordinate,
for 3D cubes the Z coordinate. [Default: 1] </dd>

<dt><b>rms=</b> </dt>
<dd>Experimental way to normalize
the data to attempt to get more predictable values for the correlation
coefficients. Default not used. </dd>

<dt><b>mode=</b> </dt>
<dd>Cross correlation mode.  1=true cross
correllation (default) where the  template map values are multiplied by
the map values, i.e. intensity weighted. 0=template map equally weighted,
this gives emphasize to the noisy lines to be searched for.  2=use the intensity
weighted mean velocity within the template to re-sample the map and sum
their emission along this curved line.   Default: 1 </dd>

<dt><b>region=</b> </dt>
<dd>MIRIAD style
region definition of the template area. ** Not implemented yet ** but expect
something like region=polygon(10,10,40,15,40,25,10,20), all in pixel coordinates.
</dd>

<dt><b>out=</b> </dt>
<dd>Optional output filename. If used, for PV maps, the output is 4 columns
of X coordinate, V0,V1 and Vmean, all in 0-based pixel coordinates.   For
XYV maps (not implemented yet) there will be 3 planes: V0, V1 and Vmean
resp. Default: not used. </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Examples</a></h2>
First an uncalibrated (in velocity) pv1.tab
is produced, this needs to be inspected  where the strongest template line
is located. The velocity axis can then be recomputed such that the template
line as the correct value, and all the others fall in place: <br>
<pre>pvcorr in=pv1 clip=0.01 v0=0 v1=30 vscale=1e-9 out=pv1.trace &gt; pv1.tab
tabplot pv1.trace 1 2,3,4 color=2,3,4 line=1,1
# y0min=6 y1max=20
# inspect where the tabpeak cutoff should be, 0.01 seems ok to get all and
a bit more
tabpeak pv1.tab clip=0.01 &gt; pv1.peak
# the reference line was fitted at -0.000066 (strongest line in pv1.peak)
but has freq 100.07640 GHz
tabmath pv1.peak - %1+0.000066+100.07640,%2 all format=%f
100.076400 1.668270 [h3cn]
100.199489 0.018321 
100.457913 0.015710 
100.536535 0.075491 ? nh2cn
100.626081 0.173972 ch3oh
100.708805 0.021336 
101.009627 0.019676 
101.028764 0.026361 
101.140399 0.044207 ch3sh
101.169243 0.053001 ?
101.343654 0.018929 
101.476141 0.139334 h2cs_1
101.526876 0.018724 
101.779270 0.017957 
tabmath pv1.tab - %1+0.000066+100.07640,%2 all format=%f | tabplot - ymin=-0.1
ymax=0.2 point=2,0.1 line=1,1 color=2 ycoord=0,0.01
</pre>
<h2><a name='sect5' href='#toc5'>Caveats</a></h2>
The current template is defined via the parameters <b>(clip,y0,y1)</b>
and is far from ideal, hence the <b>out=</b> to inspect which area/volume was
computed. Ideally a properly smoothed version of a PV diagram will contain
a better definition of the template. Another option is to find the peak
in the map, assuming this is related to a strong well known line, then
walk down the spectrum until clip is reached. This would alleviate one from
having to supply a <b>(y0,y1)</b> pair. <p>
Instead of the derived template shape,
one could also define the offset by using a first moment. Or a gaussian
fit. This would require resampling the spectrum for the cross correlation
and is more expensive, but possibly more accurate. <p>
Can also use the template
to define a v_mean, and resample this curvy line through PV and add up
all the emission, creating a spectrum. Not quite cross correllation, but
since the code is all local... This is mode=2. <p>
Finally, not all lines have
a similar distribution in PV, this will diffuse or can even destroy the
cross correlation.  <p>
Output cross correlations still have dubious units 
<h2><a name='sect6' href='#toc6'>See
Also</a></h2>
<a href='tabpeak.1.html'>tabpeak(1NEMO)</a>
, <a href='pvtrace.1.html'>pvtrace(1NEMO)</a>
, <a href='image.5.html'>image(5NEMO)</a>
 
<h2><a name='sect7' href='#toc7'>Files</a></h2>
src/image/rotcur/pvcorr.c

<h2><a name='sect8' href='#toc8'>Author</a></h2>
Peter Teuben 
<h2><a name='sect9' href='#toc9'>Update History</a></h2>
<br>
<pre>29-May-2013<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.1 Created<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
30-may-2013<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.4 Exended to 3D cubes<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
31-may-2013<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.5 mode=0,2 implemented<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Examples</a></li>
<li><a name='toc5' href='#sect5'>Caveats</a></li>
<li><a name='toc6' href='#sect6'>See Also</a></li>
<li><a name='toc7' href='#sect7'>Files</a></li>
<li><a name='toc8' href='#sect8'>Author</a></li>
<li><a name='toc9' href='#sect9'>Update History</a></li>
</ul>
</body>
</html>
