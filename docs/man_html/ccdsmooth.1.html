<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>CCDSMOOTH(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
HTML automatically generated with <A HREF=http://manpages.ubuntu.com/manpages/bionic/man1/rman.1.html>rman</A><br>
<a href='#toc'>Table of Contents</a><p>

<p> 
<h2><a name='sect0' href='#toc0'>Name</a></h2>
ccdsmooth - smoothing of an image map (2D or 3D) 
<p> 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<p>
<b>ccdsmooth
in=</b>image <b>out=</b>image [parameter=value] 
<p> 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<i>ccdsmooth</i> will smooth
an image (cube) through a simple direct convolution (no FFT). The smoothing
beam must be circular/spherical, or smoothing must be done independantly
per coordinate by calling <i>ccdsmooth</i> multiple times using the <b>dir=</b> keyword
(see below). <p>
Spatial smoothing in X-Y can also be done by creating an image
of a beam, which is then convolved with the input image. For example, non-circular
beams with a non-zero positon angle (in FITS: <b>BPA</b>) will need to create a
beam file using <a href='ccdgen.1.html'><i>ccdgen(1NEMO)</i></a>
. <p>
For more artistic versions of a smoothing
operation, such as added noise and diffraction spikes for bright stars,
see <a href='ccddiffract.1.html'><i>ccddiffract(1NEMO)</i></a>
. 
<p> 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
 The following parameters are recognized
in order; they may be given in any order if the keyword is also given. Use
<b>--help</b> to confirm this man page is up to date.  
<dl>

<dt><b>in=<i>in-file</i></b> </dt>
<dd>input file, in <a href='Image.5.html'><i>Image(5)</i></a>

format [no default] </dd>

<dt><b>out=<i>out-file</i></b> </dt>
<dd>output file, will be in <a href='Image.5.html'><i>Image(5)</i></a>
 format
[no default] </dd>

<dt><b>gauss=<i>value</i></b> </dt>
<dd>Beam size (FWHM, note FWHM = 2*sqrt(2*<a href='ln.2.html'>ln(2)</a>
) =
2.355 * sigma) of a  gaussian smoothing kernel, in WCS units. Note this is
size of the used smoothing kernel, NOT the resulting beam in the output
map, which generally will be bigger depending on the pre-existing beam. 
If this parameter is used, the parameter <b>smooth</b> is ignored [default: not
used]. </dd>

<dt><b>moffat=<i>value</i></b> </dt>
<dd>If given, this will be the FWHM of the Moffat smoothing
function. </dd>

<dt><b>dir=x|y|z</b> </dt>
<dd>Direction of smoothing. This gives the flexibility of smoothing
in x, y and/or z separately. Note that when smoothing in more than one coordinate
the <i>beam</i> is forced to be the same in each dimension [default: xy]. </dd>

<dt><b>smooth=<i>array</i></b>
</dt>
<dd>Smoothing array, should be at least 1 number, prefarably normalized  to
unity for sake for conservation of units (mass per unit square length).
The program does not normalize the beam to unity. Example is e.g. the Hanning
smoothing: "0.25,0.5,0.25". [default: <b>0.25,0.5,0.25</b>]. This parameter is only used
if <b>gauss</b> parameter is not used. </dd>

<dt><b>wiener=<i>value</i></b> </dt>
<dd>If used, this will be the (square)
size of the Wiener filter. </dd>

<dt><b>nsmooth=<i>value</i></b> </dt>
<dd>Number of times the above smoothing
kernel is applied over the data. [default: <b>1</b>]. </dd>

<dt><b>bad=<i>bad_value</i></b> </dt>
<dd>Input pixel
value which to skip in smoothing. [Default: not used] </dd>

<dt><b>beta=<i>moffat_beta</i></b> </dt>
<dd>If
used, this is the <i>beta</i> parameter for the Moffat smoothing function. [Default:
4.765] </dd>

<dt><b>cut=<i>cutoff_value</i></b> </dt>
<dd>Value at which to cutoff the gaussian beam.  [Default:
<b>0.01</b>] </dd>

<dt><b>beam=</b> </dt>
<dd>Optional 2D spatial beam, in <a href='Image.5.html'><i>Image(5)</i></a>
 format. This should be
a map with an odd number of pixels, ideally where the central pixel value
is 1. Normalization by the beam volume is done automatically, such that
smoothing conserves flux.  The WCS of the beam is ignored, it&rsquo;s the pixels
that count. 
<p> </dd>

<dt><b>mode=<i>edge_mode</i></b> </dt>
<dd>Special edge smoothing mode (testing). [0] 
<p> </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Examples</a></h2>
Here
is an example to compute the noise of an image with unity noise that has
been smoothed with a beam/pixel (B/P) ratio of 2.0 : <br>
<pre>  ccdgen "" -  noise 0,1 size=1000,1000 seed=123 | ccdsmooth - - 2.0 | ccdstat
- | grep dispersion
  Mean and dispersion    : -0.000116 0.334048
</pre>with the following table showing the resulting RMS for a few values of
the B/P ratio <br>
<pre>B/P     RMS
---    -----
0.0    1.000
1.0    0.796
2.0    0.334
3.0    0.223
4.0    0.168
5.0    0.1367
6.0    0.1160
7.0    0.1012
8.0    0.0917
</pre>caveat/TBD:   this does not follow the expected (?) 1/sqrt(1.1309)/(B/P)

<p> sigma_smooth = -0.133 + 1.52 / beam 
<p> <p>
Here is an example of creating a beam
image, with 5 x 2.5 beam, and a position angle of 30 degrees, by creating
a disk at pa=-30 and inclination the cos(bmin/bmaj): <br>
<pre>    ccdgen beam1 gauss 1,5 size=33,33 pa=-30 inc="acosd(0.5)"
</pre>
<p> 
<h2><a name='sect5' href='#toc5'>Timing</a></h2>
<br>
<pre>With 68881 on SUN 3/50 (~16Mhz) and 200*200 map - old program (pre-V2.1)
Nbeam=17<tt> </tt>&nbsp;<tt> </tt>&nbsp;54s
Nbeam=33<tt> </tt>&nbsp;<tt> </tt>&nbsp;98s
Nbeam=47<tt> </tt>&nbsp;<tt> </tt>&nbsp;140s
HanningThe following are the weights needed in smooth= for subsequent hanning
smoothings: 
1: 0.25,0.5,0.25
2: 0.0625,0.25,0.375,0.25,0.0625 
3: 0.015625,0.09375,0.234375,0.3125,0.234375,0.09375,0.015625 
4: 0.00390625,0.03125,0.109375,0.21875,0.273438,0.21875,0.109375,0.03125,0.00390625

</pre>and these results in a reduction of the RMS by 0.61, 0.52, 0.47 and 0.44 resp.
Note this is not the official Hanning definition (0.5-0.5 cos(2.pi.N/(M-1))).
 <br>
<pre>1: 0.25,0.5,0.25
2: 0.08333333,0.25,0.33333333,0.25,0.08333333
3: 0.03661165,0.125,0.21338835,0.25,0.21338835,0.125,0.03661165,
4: 0.0190983,0.0690983,0.1309017,0.1809017,0.2,0.1809017,0.1309017,0.0690983,0.0190983
5: 0.01116455,0.04166667,0.08333333,0.125,0.15550212,0.16666667,0.15550212,0.125,0.08333333,0.04166667,0.01116455
</pre>which reduce the RMS by 0.61, 0.49, 0.43, 0.38 and 0.34 resp. 
<p> 
<h2><a name='sect7' href='#toc7'>Noise Reduction</a></h2>
For
a given smoothing, a map with random gaussian noise will have a smaller
noise for given smoothing. Most maps in astronomy will not have uncorrelated
noise. Here&rsquo;s a (bash) script and results to sample that behavior. We fix
the noise at 1, and for given smoothing (in terms of pixels FWHM) the noise
will be lower: <br>
<pre>export DEBUG=-1
slist=$(nemoinp 0.01,0.25:5:0.25)
for s in $slist; do
     echo -n "$s "
     ccdgen "" - noise 0,1 size=256,256 | ccdsmooth - - $s | ccdstat - | grep
^Mean | awk &rsquo;{print $6}&rsquo;
     ccdgen "" - noise 0,1 size=256,256 | ccdsmooth - - $s | ccdstat - | txtpar
- p0=Mean,1,6
done
</pre>
<p> 
<h2><a name='sect8' href='#toc8'>Bugs</a></h2>
Smoothing a map which has already been smoothed will result in an
incorrect header - this would be a simple sum of squares, if the beams are
aligned with the axis. 
<p> 
<h2><a name='sect9' href='#toc9'>See Also</a></h2>
<a href='ccdgen.1.html'>ccdgen(1NEMO)</a>
, <a href='ccdfill.1.html'>ccdfill(1NEMO)</a>
, <a href='ccddiffract.1.html'>ccddiffract(1NEMO)</a>
,
<a href='snapccd.1.html'>snapccd(1NEMO)</a>
, <a href='snapsmooth.1.html'>snapsmooth(1NEMO)</a>
, <a href='snapgrid.1.html'>snapgrid(1NEMO)</a>
, <a href='image.5.html'>image(5NEMO)</a>
 
<p> 
<h2><a name='sect10' href='#toc10'>Author</a></h2>
Peter

<p>Teuben 
<p> 
<h2><a name='sect11' href='#toc11'>Files</a></h2>
<br>
<pre>src/image/trans     <tt> </tt>&nbsp;<tt> </tt>&nbsp;ccdsmooth.c
</pre>
<p> 
<h2><a name='sect12' href='#toc12'>History</a></h2>
<br>
<pre>29-jun-87<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.0: Created as module from CCD program<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
30-Jun-87<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.1: improved &rsquo;struct&rsquo; filestructure      <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
 9-jul-87<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.2: keyword &rsquo;dir&rsquo; and keyword order changed<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
 1-jun-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.0: new filestruct, although code is same<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
 5-feb-89<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.2: general 3D smoothing                <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
11-sep-91<tt> </tt>&nbsp;<tt> </tt>&nbsp;some additional comments                <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
12-mar-98<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.1: added cut=, fixed fwhm=0.0         <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
23-jun-21<tt> </tt>&nbsp;<tt> </tt>&nbsp;add EXAMPLE with smoothing noise<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
31-may-22<tt> </tt>&nbsp;<tt> </tt>&nbsp;documented missing parameters<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
20-sep-23<tt> </tt>&nbsp;<tt> </tt>&nbsp;V4.0 add beam=<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Examples</a></li>
<li><a name='toc5' href='#sect5'>Timing</a></li>
<li><a name='toc6' href='#sect6'>Hanning</a></li>
<li><a name='toc7' href='#sect7'>Noise Reduction</a></li>
<li><a name='toc8' href='#sect8'>Bugs</a></li>
<li><a name='toc9' href='#sect9'>See Also</a></li>
<li><a name='toc10' href='#sect10'>Author</a></li>
<li><a name='toc11' href='#sect11'>Files</a></li>
<li><a name='toc12' href='#sect12'>History</a></li>
</ul>
</body>
</html>
