<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>RVSTACK(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
This HTML automatically generated with <A HREF=http://manpages.ubuntu.com/manpages/bionic/man1/rman.1.html>rman</A> for <A HREF=https://astronemo.readthedocs.io>NEMO</A><br>
<a href='#toc'>Table of Contents</a><p>

<p> 
<h2><a name='sect0' href='#toc0'>Name</a></h2>
rvstack - extract Radius-Velocity diagram from a data cube with selected

<p>stacking 
<p> 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<b>rvstack</b> in=cube out=map [parameter=value] 
<p> 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<b>rvstack</b>
takes all points within a (narrow) wedge around the major or minor axis
of an assumed galaxy disk data cube, and stacks these data to construct
a two-dimensional <i>Radius-Velocity map</i>, centered on the galaxy in position
and velocity. The intent is to show the rotation curve along the major axis,
or (Z-axis) outflow along the minor axis. If there is signal at negative
velocities, either there are leading spiral arms, or there is inflow. 
<p> By
default it will stack the two sides of the galaxy (see also <b>side=</b>), so
the radial coordinate will run from 0 to some Rmax, and  in velocity it
will run from some -Vmax to Vmax. This is done in such a way as to expect
positive rotation around the Z-axis, or a positive outflow along the Z axis.
For this the position angle (<b>pa=</b>) has been correctly set to the major axis
/ receding side for rotation, and minox axis / receding (near) side for
outflow. <p>
Weak signal rotation and/or bulk outflow could be detected this
way, but we offer no guarentee! If you have many like-minded galaxies, stacking
these images may beat the noise down even more. For subsequent stacking
<a href='ccdstack.1.html'><i>ccdstack(1NEMO)</i></a>
 will need to be used. <p>
Options exist to scale the Radius
and Velocity to different units, such that objects can be stacked in a
physical space, as opposed to observed space. See <b>rscale=</b> and <b>vscale=</b>. <p>
<p>
When
<b>gscale=t</b> is set, the coordinates are geometrically corrected as well, as
follows: <br>
<pre>Rotation<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;Outflow
--------<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;---------
R<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;R/sin(inc)
V/sin(inc)/cos(theta)<tt> </tt>&nbsp;<tt> </tt>&nbsp;V/cos(inc)
</pre>where <b>theta</b> is the position angle away from the major axis in the plane
of the galaxy. The radius <b>R</b> has been corrected for this as well. This can
leave some gaps in radius and velocity. See CAVEATS below. <p>
Points along an
arc are all accumulated (technically: averaged), and placed on the same
radial grid as the pixel size in the input data cube. We might need some
trick next neighbor smoothing in order for pixels near the center to have
a value. 
<p> 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
 The following parameters are recognized in order; they
may be given in any order if the keyword is also given. Use <b>--help</b> to confirm
this man page is up to date.  
<dl>

<dt><b>in=</b><i>image_cube</i> </dt>
<dd>input data cube, in standard
<a href='image.5.html'><i>image(5NEMO)</i></a>
 format. The third axis must be velocity, or at least match
the units used in the <b>vlsr=</b> keyword below. [No default] </dd>

<dt><b>out=</b><i>image_map</i> </dt>
<dd>output
R-V map. [No default] </dd>

<dt><b>pa=</b> </dt>
<dd>position angle along which the wedge is taken. This
is normally  the <b>major axis receding side</b> (with mode=rotation) or the <b>minor
axis near side</b> (for mode=outflow), in order get a positive velocity signal
in the RV map. When <b>gscale=t</b> is set, will there be a difference how the
radius and velocity are scaled. </dd>

<dt><b>inc=</b> </dt>
<dd>inclination angle of the disk [45]
</dd>

<dt><b>vsys=</b> </dt>
<dd>systemic velocity [0]    </dd>

<dt><b>center=</b><i>xpos,ypos</i> </dt>
<dd>rotation center (in pixel
units, where 0,0=lower left). If not supplied, the reference pixel will
be used. Default: reference pixel. </dd>

<dt><b>angle=</b> </dt>
<dd>full angle around the position
angle <b>pa=</b> around which points are accumulated into the R-V plot.  [Default:
10] </dd>

<dt><b>blank=</b> </dt>
<dd>Value of the blank pixel to be ignored. [Default: 0.0] </dd>

<dt><b>rscale=</b>
</dt>
<dd>Scaling factor for radius. This would be used to stack galaxies based on
some physical (e.g. kpc) scaling, not geometry, see <b>gscale=</b> below.  [Default:
1] </dd>

<dt><b>vscale=</b> </dt>
<dd>Scaling factor for velocity. This would be  used to stack galaxies
based on a mass scaling, not geometry, see <b>gscale=</b> below. [Default: 1] </dd>

<dt><b>gscale=f|t</b>
</dt>
<dd>A boolean if to scale for (inclination and position angle based) geometry.
If selected, rotation is scaled by 1/sin(i), outflow by 1/cos(i). Radius
is not scaled for rotation, but by 1/cos(i) for outflow. Small position
angle in the disk plane ("theta") based corrections are also applied. [Default:
f] </dd>

<dt><b>mode=r|o</b> </dt>
<dd>Select output mode: rotation (r) or <a href='outflow.o.html'>outflow (o)</a>
.   [Default:
r] </dd>

<dt><b>side=0|-1|1</b> </dt>
<dd>By default it will stack both sides (0), but this option will
allow you to stack <a href='one.1.html'>one (1)</a>
 or the other (-1) side. [Default: 0] </dd>

<dt><b>tab=t|f</b> </dt>
<dd>(debugging)
write a test table.  [Default: f] </dd>

<dt><b>jiggle=t|f</b> </dt>
<dd>Debugging spreading signal. Don&rsquo;t
use. 
<p> </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Caveats</a></h2>
Code is still under developement, in particular dealing with
units is unresolved. <p>
A wedge has the disadvantage the the noise decreases
inversely proportional to the sqrt(radius), but has a <i>matched-filter</i> approach
to a conic outflow. An alternative would be to have an option for <b>angle=</b>
to be replaced with <b>width=</b>. <p>
The gaps in radius and/or velocity produced
with <b>gscale=t</b> can be a nuisance. For stacking many images, for example using
<a href='ccdstack.1.html'><i>ccdstack(1NEMO)</i></a>
, this should disappear, but otherwise some smoothing/interpolation
might be needed. Not implemented. <p>
Outflow is hard-coded as outflow along the
Z axis. What should the off-axis relationship be? Conical? No theta correction
applied here, as we don&rsquo;t have a model like we have for rotation. 
<p> 
<h2><a name='sect5' href='#toc5'>Examples</a></h2>
An
example using our standard NGC 6503 cube given in km/s velocity units. 
<p>
<br>
<pre>  rvstack ngc6503.ccd rvma.ccd pa=-60 inc=75 vsys=27 center=164,123 rscale=3600

  rvstack ngc6503.ccd rvmi.ccd pa=30  inc=75 vsys=27 center=164,123 rscale=3600

  rvstack ngc6503_83.ccd rvma_83.ccd pa=-60 inc=75 vsys=27 center=129,128
rscale=3600 
  rvstack ngc6503_83.ccd rvmi_83.ccd pa=30  inc=75 vsys=27 center=129,128
rscale=3600 
</pre>
<p> Here is an example made with <b>mk_cone</b> <br>
<pre>    $NEMO/scripts/csh/mk_cone out=cone2 rmin=0 vscale=0 outflow=0.5 cone=10
flow=rise noise=1
    
</pre>
<p> 
<h2><a name='sect6' href='#toc6'>See Also</a></h2>
<a href='ccdstack.1.html'>ccdstack(1NEMO)</a>
, <a href='ccdzshift.1.html'>ccdzshift(1NEMO)</a>
, <a href='ccdmath.1.html'>ccdmath(1NEMO)</a>
, <a href='image.5.html'>image(5NEMO)</a>
,
<a href='rotcur.5.html'>rotcur(5NEMO)</a>
 <p>
<a href='https://github.com/jbjolly/LineStacker'>https://github.com/jbjolly/LineStacker</a>
 <p>
PyStacker <a href='https://arxiv.org/abs/2305.10240'>https://arxiv.org/abs/2305.10240</a>


<p> 
<h2><a name='sect7' href='#toc7'>Files</a></h2>
<br>
<pre>src/image/rotcur/rvstack.c
scripts/csh/mk_cone - example script to create PPV cubr of disk + conic
outflow along Z
https://www.cv.nrao.edu/fits/data/samples/cubes/ngc6503.fits  (old 1983 VLA
data)
https://...   (TBD - new data)
</pre>
<p> 
<h2><a name='sect8' href='#toc8'>Author</a></h2>
Peter Teuben 
<p> 
<h2><a name='sect9' href='#toc9'>Update History</a></h2>
<br>
<pre>6-may-2021<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.4 First working version<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
31-may-2021<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.7 better geometry correction<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
3-jun-2021<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.8a clarify near/far side choice<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Caveats</a></li>
<li><a name='toc5' href='#sect5'>Examples</a></li>
<li><a name='toc6' href='#sect6'>See Also</a></li>
<li><a name='toc7' href='#sect7'>Files</a></li>
<li><a name='toc8' href='#sect8'>Author</a></li>
<li><a name='toc9' href='#sect9'>Update History</a></li>
</ul>
</body>
</html>
