<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>IMAGE(5NEMO) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
image - binary format for 2D and 3D image/cube files 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<br>
<pre>#include &lt;stdinc.h&gt;
#include &lt;filestruct.h&gt;
#include &lt;image.h&gt;
</pre>
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<i>image</i> implement a rectangular  2-dimensional matrix or 3-dimensional
cube in a  <a href='filestruct.5NEMO.html'><i>filestruct(5NEMO)</i></a>
 datafile.  The current implementation restricts
images to well known 2- and 3-dimensional cases, as well  as the restriction
that the whole image must be in memory. See <a href='mdarray.3NEMO.html'><i>mdarray(3NEMO)</i></a>
 for a more general
 multi-dimensional array interface (though there is no special I/O interface
for this data structure). The coordinate transformation  to world coordinates
is by no means restricted to a simple linear equation of the form: <br>
<pre>        x.w.c. = SCALE * i + OFFSET
</pre>where <i>i</i> runs from 0 to N-1, the dimension of the matrix in any of its coordinates.
<p>
<i>Image</i> files are used in 2D and 3D images, i.e. a matrix of values of any
kind (intensity, velocity etc.). The output format of <a href='image.3NEMO.html'><i>image(3NEMO)</i></a>
 files
is the general binary structured fileformat as described in <a href='filestruct.3NEMO.html'><i>filestruct(3NEMO)</i></a>
.
<p>
The data is stored on disk in Fortran (column-major) or C (row-major) fashion,
as in <i>Data(row,column,plane)</i> depending on a compile switch or #define in
the image.h module, which must be included in every program using images.
The default compilation is using the FORDEF, i.e. x coordinate running fastest
in memory (compatibility with existing contour and FITS routines). 
<h2><a name='sect3' href='#toc3'>Format</a></h2>
<br>
<pre>typedef struct {
    real   *frame;<tt> </tt>&nbsp;<tt> </tt>&nbsp; /* pointer to datablock */
    real   **matrix;     /* 2D special case: pointers to pointers */
    real   ***cube;      /* 3D special case: ptr to ptr to ptr&rsquo;s  */
    int    axis;         /* axis type (0=old, no ref; 1=with ref */
    int    nx;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp; /* number of pixels along x-axis */
    int    ny;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp; /* number of pixels along y-axis */
    int    nz;           /* number of pixels along z-axis */
    real   xmin;<tt> </tt>&nbsp;<tt> </tt>&nbsp; /* x-value belonging to first x-pixel */
    real   ymin;<tt> </tt>&nbsp;<tt> </tt>&nbsp; /* y-value belonging to first y-pixel */
    real   zmin;<tt> </tt>&nbsp;<tt> </tt>&nbsp; /* z-value belonging to first z-pixel */
    real   dx;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp; /* step in x-pixel */
    real   dy;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp; /* step in y_pixel */
    real   dz;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp; /* step in z_pixel */
    real   xref;         /* reference pixel in X */
    real   yref;         /* reference pixel in Y */
    real   zref;         /* reference pixel in Z */
    real   map_min;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* minimum map value */
    real   map_max;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* maximum map value */
    int    beamtype;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* type of beam used for beam smoothing */
    real   beamx;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* beamwidth along x (if used) */
    real   beamy;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* beamwidth along y (if used) */
    real   beamz;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* beamwidth along z (if used) */
    string namex;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* pointer to x-axis name string */
    string namey;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* pointer to y-axis name string */
    string namez;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* pointer to z-axis name string */
    string unit;
    real   time;
    string storage;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;/* pointer to storage fashion string */
} image, *imageptr;
</pre>
<h2><a name='sect4' href='#toc4'>Access-macros</a></h2>
Accessing the individual structure components can be done through
some pre-define macros (in <b>image.h</b>): <br>
<pre>#define Frame(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;frame)
#define Nx(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;nx)
#define Ny(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;ny)
#define Nz(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;nz)
#define Axis(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;axis)
#define Xmin(iptr) <tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;xmin)
#define Ymin(iptr) <tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;ymin)
#define Zmin(iptr) <tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;zmin)
#define Dx(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;dx)
#define Dy(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;dy)
#define Dz(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;dz)
#define Xref(iptr) <tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;xref)
#define Yref(iptr) <tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;yref)
#define Zref(iptr) <tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;zref)
#define MapMin(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;map_min)
#define MapMax(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;map_max)
#define BeamType(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;beamtype)
#define Beamx(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;beamx)
#define Beamy(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;beamy)
#define Beamz(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;beamz)
#define Namex(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;namex)
#define Namey(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;namey)
#define Namez(iptr)<tt> </tt>&nbsp;<tt> </tt>&nbsp;((iptr)-&gt;namez)
#define Unit(iptr)      ((iptr)-&gt;unit)
#define Storage(iptr)   ((iptr)-&gt;storage)
/* row major */
#if defined(CDEF)
#define MapValue(iptr,ix,iy)<tt> </tt>&nbsp;<tt> </tt>&nbsp;(*( (iptr)-&gt;frame + iy + ix*Ny(iptr) ))
#define CubeValue(iptr,ix,iy,iz)<tt> </tt>&nbsp;<tt> </tt>&nbsp;(*( (iptr)-&gt;frame + iz + Nz(iptr)*(iy + Ny(iptr)*ix)))
#endif
/* column major */
#if defined(FORDEF)
#define MapValue(iptr,ix,iy)<tt> </tt>&nbsp;<tt> </tt>&nbsp; (*( (iptr)-&gt;frame + ix + Nx(iptr)*iy) )
#define CubeValue(iptr,ix,iy,iz)<tt> </tt>&nbsp;<tt> </tt>&nbsp;(*( (iptr)-&gt;frame + ix + Nx(iptr)*(iy+Ny(iptr)*iz)))
#endif 
</pre>
<h2><a name='sect5' href='#toc5'>Array Notation</a></h2>
The <i>MapValue</i> and <i>CubeValue</i> macros are sometimes cumbersome
typography, and using two image library routines,  <b>map2_image</b> and <b>map3_image</b>
these can be converted to the commonly used array syntax: <br>
<pre>    image *iptr = open_image(....);
    real **a = map2_image(iptr);
    for (i=0; i&lt;nx; i++)
        for (j=0; j&lt;nx; j++)
            a[i][j] = 0.0;
</pre><p>
The following example creates a simple cube by which you can test the row-major
and column-major implementations. <p>
In CDef mode: <br>
<pre>    % ccdmath "" cube0 "%x+10*%y+100*%z" 4,3,2
    % tsf cube0
    double MapValues[4][3][2] 0.00000 100.000 10.0000 110.000 20.0000 120.000
...  123.000
</pre>In ForDef mode: <br>
<pre>    % tsf cube0
    double MapValues[4][3][2] 0.00000 1.00000 2.00000 3.00000 10.0000 11.0000
... 123.000
</pre>
<h2><a name='sect6' href='#toc6'>Limitations</a></h2>
The current default images (axis=0) have their original at the
first (lower-left = 0,0) pixel. In FITS parlance, there is no freedom in
the location of the reference pixel, it&rsquo;s (0,0). For axis=1 (only a few programs
now support it, notably <a href='ccdfits.1NEMO.html'><i>ccdfits(1NEMO)</i></a>
 and <a href='fitsccd.1NEMO.html'><i>fitsccd(1NEMO)</i></a>
) this limitation
will go away, but only simple cartesian coordinate systems are supported.

<h2><a name='sect7' href='#toc7'>Future Expansions</a></h2>
Code could be modified to use <a href='dynamem.3NEMO.html'>dynamem(3NEMO)</a>
. Allows more
flexable use by addressing image[i][j] instead of slower macros MapValue(iptr,i,j)

<h2><a name='sect8' href='#toc8'>See Also</a></h2>
<a href='snapshot.5NEMO.html'>snapshot(5NEMO)</a>
, <a href='image.3NEMO.html'>image(3NEMO)</a>
, <a href='tsf.1NEMO.html'>tsf(1NEMO)</a>
, <a href='mdarray.3NEMO.html'>mdarray(3NEMO)</a>
 
<h2><a name='sect9' href='#toc9'>Author</a></h2>
Peter
Teuben 
<h2><a name='sect10' href='#toc10'>Files</a></h2>
<br>
<pre>~/src/pjt/image   <tt> </tt>&nbsp;<tt> </tt>&nbsp;image.c image.h image.3 image.5
</pre>
<h2><a name='sect11' href='#toc11'>Update History</a></h2>
<br>
<pre>29-Jun-87<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.0: Original created<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
30-Jun-87<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.0: use struct as interface<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
22-May-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;comment to use dynamem(3NEMO)<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
23-dec-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.3: velocity added to header<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
18-jan-89<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3.0: 3D added PJT
1-feb-89<tt> </tt>&nbsp;<tt> </tt>&nbsp;V4.0: compile switch for FORDEF and CDEF matrix storage<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
21-feb-00<tt> </tt>&nbsp;<tt> </tt>&nbsp;A[i][j] usage        <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
19-may-03<tt> </tt>&nbsp;<tt> </tt>&nbsp;improved documentation<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
8-may-04<tt> </tt>&nbsp;<tt> </tt>&nbsp;V5.0: added reference pixel for axis type 1<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
7-may-13<tt> </tt>&nbsp;<tt> </tt>&nbsp;added benchmark example
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Format</a></li>
<li><a name='toc4' href='#sect4'>Access-macros</a></li>
<li><a name='toc5' href='#sect5'>Array Notation</a></li>
<li><a name='toc6' href='#sect6'>Limitations</a></li>
<li><a name='toc7' href='#sect7'>Future Expansions</a></li>
<li><a name='toc8' href='#sect8'>See Also</a></li>
<li><a name='toc9' href='#sect9'>Author</a></li>
<li><a name='toc10' href='#sect10'>Files</a></li>
<li><a name='toc11' href='#sect11'>Update History</a></li>
</ul>
</body>
</html>
