<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>GETPARAM(3NEMO) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
getXparam, hasvalue, isaparam, initparam, finiparam, stop - main startup
and command line processing. 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<br>
<pre>#include &lt;stdinc.h&gt;#include &lt;getparam.h&gt;string defv[]={
<tt> </tt>&nbsp;<tt> </tt>&nbsp;"key1=val1\n   Example help for key1",
<tt> </tt>&nbsp;<tt> </tt>&nbsp;"key2=val2\n<tt> </tt>&nbsp;<tt> </tt>&nbsp;Example help for key2",
<tt> </tt>&nbsp;<tt> </tt>&nbsp;"VERSION=1.0\n 30-apr-2002 pjt",
<tt> </tt>&nbsp;<tt> </tt>&nbsp;NULL,
};
string usage="Example usage for program";
</pre>string cvsid="$Id: $"; <br>
<pre>
void initparam(string *argv, string *defv)void finiparam(void)
void stop(int
level)
string getparam(string name)int getiparam(string name)long getlparam(string
name)double getdparam(string name)bool getbparam(string name)
string *getargv(int
*argc)
int indexparam(string basename, int idx)string getparam_idx(string
basename,int idx)int getiparam_idx(string basename,int idx)long getlparam_idx(string
basename,int idx)double getdparam_idx(string basename,int idx)bool getbparam_idx(string
basename,int idx)
void putparam(string name,string value)void promptparam(string
name,string prompt)
bool hasvalue(string name)bool isaparam(string name)bool
updparam(string name)int getparamstat(string);extern int error_level;extern
int debug_level;extern int yapp_level;extern int help_level;
    undocumented:
_bell_level_history_review_flag_yapp_dev_yapp_string_help_string_argv_string
</pre>
<h2><a name='sect2' href='#toc2'>Description</a></h2>
These
functions provide a simple and uniform mechanism for  command line processing
(see also <a href='nemomain.3NEMO.html'>nemomain(3NEMO)</a>
 for an even simpler approach). Input as well as
output (storage) of selected parameters can be controlled via command line
parameters. First, <i>initparam</i> is called to set up values associated with
a set of possible keyword names;  after this <i>getparam</i> and any of its relatives
may be called to access and/or parse the value associated with a specified
 keyword. <i>finiparam</i>  should be called before the program ends, to ensure
any outstanding requests are dealt with (e.g. writing updated keyword files,
see HELP and DEBUG below), or optionally complain about unprocessed command
line arguments. Output of parameters is described in <a href='outparam.3NEMO.html'><i>outparam(3NEMO)</i></a>
. <p>
<i>initparam</i>
is called with two arguments: the argument vector <i>argv</i> which is passed
to <i>main</i>, and a similar vector <i>defv</i> which determines the set of legal keyword
names and their default values. More precisely, <i>defv</i> is of the form <p>
<blockquote><br>
<pre>string defv[] = { "name=value\nhelp", . . ., "VERSION=x.y", NULL };
</pre></blockquote>
<p>
<i>initparam</i> determines a value for each <i>name</i> in <i>defv</i> by scanning the command
line arguments in <i>argv</i>, any values supplied in a keyword file (see below)
and finally adopting the value supplied by <i>defv</i> if no other value can be
found. Note the recommended  (but not enforced) usage of the <b>VERSION</b> keyword;
this version ID will be used to tag the history of datafiles which were
created by programs, and  will also warn users when outdated keyword files
are used (see below). <p>
Arguments specified in <i>argv</i> are matched with names
specified in <i>defv</i> either one of two ways. Those appearing to the left of
the first argument containing an embedded "=" sign are <i>matched by position</i>:
the first such argument is associated with the first name listed in <i>defv</i>,
and so on; it is an error if more arguments are supplied in <i>argv</i> than names
are supplied in <i>defv</i>. The remaining arguments must all be of the form "<i>name</i>=<i>value</i>",
and are <i>matched by keyword</i>: <i>name</i> must appear in <i>defv</i>, and <i>value</i> is associated
with <i>name</i>. It is an error to specify more than one <i>value</i> for a given <i>name</i>.
If getparam is compiled with MINMATCH, keyword names are also matched in
minimum match mode. <p>
An exception to commandline parsing is made for any
arguments that follow the standalone command line argument "--". The function
<i>getargv()</i> can be used to get access to any arguments that follow (and including)
"--". The returned array simply points into the original <i>char **argv</i>, but
starts at the location of "--". The returned <i>argc</i> therefore only  counts the
number of arguments after  (and including) "--", and thus making argv[0]
be "--". <p>
Depending on a user specified <b>help_level</b> (see below) parameters may
also be set by reading them from a keyword file. The keyword file is unique
for each program, and has the name "<i>program</i><b>.def</b>". Although there is some
control over the directory in which these keyword files should be located
(<b>$NEMODEF</b>, but more on that later),  it is dangerous to use keyword files
during multiple sessions since NEMO does not use a file locking mechanism.
Command line keyword values are always favored over values from a keyword
file. <p>
Once <i>initparam</i> has returned, the value associated with a <i>name</i> may
be obtained (as a <b>string</b>) by <i>getparam</i>, or directly  converted to an <b>int</b>,
<b>long</b>, <b>double</b>, or <b>bool</b> by the functions <i>getiparam</i>, <i>getlparam</i>, <i>getdparam</i>,
and <i>getbparam</i> respectively. The latter recognizes the digit "1" or any string
starting with one of "tTyY" as TRUE, and "0" or any string starting with
one of "fFnN" as FALSE. All the <i>getXparam</i> function can do simple parsing
of expressions, see <a href='nemoinp.3NEMO.html'><i>nemoinp(3NEMO)</i></a>
 for some extended rules. Also note that
 <i>getparam</i> returns a string into private space, that should not be modified
or freed! An single parameter integer that starts with the <b>0x</b> string, can
also be parsed as a hexdecimal value (see <a href='strtol.3.html'><i>strtol(3)</i></a>
). <p>
<b>getparamstat</b> is currently
only available to provide ZENO compatibility, it currently triggers a call
to <a href='error.3NEMO.html'><i>error(3NEMO)</i></a>
 when called. <p>
As a special case, the contents of <i>argv</i>[0],
which is the name used to invoke the process, are associated with the keyword
name <b>argv0</b>. This is useful when reporting errors from library routines which
may have no other way of determining what program called them; for example,
<p>
<blockquote><br>
<pre>  printf("sqrt in %s: negative arg\n", getparam("argv0"));
</pre></blockquote>
<p>
could be used to print an error message from a square-root procedure, giving
the name of the program in which the error occured. The macro getargv0(),
defined in getparam.h, can also be used for this, instead of called getparam().
This technique is used by the routine, <a href='error.3NEMO.html'><i>error(3NEMO)</i></a>
; it reports the program
name in square brackets before the string is output.  <p>
The optional <b>usage</b>
and <b>cvsid</b> strings, that will need to be defined by the user, can be queried
with the <b>help=u</b> and <b>help=I</b> options. 
<h2><a name='sect3' href='#toc3'>Required Arguments</a></h2>
Arguments with default
values (as listed in <i>defv</i>) of "???" are required; <i>initparam</i> will print
an informative message and quit if no value for such an argument can be
obtained from <i>argv</i>. This feature is handy for things which must be specified
or for which no reasonable default exists. 
<h2><a name='sect4' href='#toc4'>Version</a></h2>
It is good (NEMO) programming
practice to give your program a VERSION id. We refer to this as the <i>internal</i>
VERSION id. The NEMO technique has historically been by adding it as the
last keyword, <b>VERSION</b>, in upper case.  Its value should be of the form <b>x.y</b>,
where <b>x</b> is the major version number, and <b>y</b> the minor version number. Sometimes
a subversion labeled <b>a, b, c, ...</b> has been added.  <p>
Not only does this enable
the running task to warn users if outdated keyword files are used, but
also it provides an automated way to label the data history with the version
of the program used to generate that data. A minor version number conflict
will result in a warning message, but a major one will result in a fatal
error message. If your program has changed data format, or keywords have
changed meaning or name, it is adviced to change the major  version number.
<p>
The <i>external</i> VERSION id is the id stored in some external keyword database,
(such as the commandline or a keyword file), that is supplied to the running
task. This would make it possible for  programs to refuse execution if the
internal and  external VERSION id do not match. We do not currently employ
this technique. Most NEMO programs have a section labeled <b>UPDATE HISTORY</b>
in which old version ID&rsquo;s are labeled by time, comment and author. 
<h2><a name='sect5' href='#toc5'>Indexed
Keywords</a></h2>
The <b>indexparam</b> and <b>getparam_idx</b> family provides one way of access
to indexed keywords. Indexed keywords are defined in the <b>defv</b> vector by
a basename that ends in with the <b>#</b> symbol, which can at runtime be replaced
by any set of non-negative integers, e.g. <b>naxis#</b> can be used to for example
define <b>naxis1=10</b>, <b>naxis4=4</b> (note the index is actually 0 based). It is up
to the programmer to decipher missing elements (e.g. using <b>isaparam</b> or <b>indexparam</b>).
<p>
<i>indexparam(basename,-1)</i> returns the largest index that was found, <i>indexparam(basename,-2)</i>
returns 0 if the keyword is not an indexed keyword, and  <i>indexparam(basename,idx)</i>,
for <i>idx &gt;= 0</i>, will check existence (1=true) for a specific index.  
<h2><a name='sect6' href='#toc6'>Help Functions</a></h2>
Besides
interpreting the command line, <i>initparam</i> provides some assistance to the
user via an additional argument (in addition to those defined in <i>defv</i>),
namely <p>
<blockquote><br>
<pre>help=option,option,...
</pre></blockquote>
<p>
If this argument, which must be specified by name, appears in <i>argv</i>, <i>initparam</i>
will generate some helpful information before returning. Possible options
include 
<dl>

<dt><b>a</b> </dt>
<dd>- print program name and command line arguments, <br>
 </dd>

<dt><b>p,k</b> </dt>
<dd>- print program name and all parameter values, <br>
 </dd>

<dt><b>d,v</b> </dt>
<dd>- print program name and default values, <br>
 </dd>

<dt><b>n</b> </dt>
<dd>- print newlines after every parameter/default values, <br>
 </dd>

<dt><b>o</b> </dt>
<dd>- show output keywords (see <a href='outparam.3NEMO.html'><i>outparam(3NEMO)</i></a>
) <br>
 </dd>

<dt><b>c</b> </dt>
<dd>- show CPU usage: clock, user, system, child-user, child-system and cpu-tick-0
<br>
 </dd>

<dt><b>q</b> </dt>
<dd>- exit after other help requests. <br>
 </dd>

<dt><b>u</b> </dt>
<dd>- show usage string <br>
 </dd>

<dt><b>h</b> </dt>
<dd>- show key and help strings <br>
 </dd>

<dt><b>t</b> </dt>
<dd>- show help as MIRIAD doc file (expert mode) <br>
 </dd>

<dt><b>t</b> </dt>
<dd>- show help as KHOROS pane file (expert mode) <br>
 </dd>

<dt><b>i</b> </dt>
<dd>- show some internal variables of the user interface (expert mode) </dd>
</dl>
<p>
These
options must be abbreviated to one character. For example, <p>
<blockquote><br>
<pre>help=d,q
</pre></blockquote>
<p>
will print defaults and then quit (actually, the comma is not needed). <p>
This
feature may be disabled by including an entry for <b>help</b> in <i>defv</i>, in which
case help processing is left to the applications program (not recommended).
<p>
An environment variable <b>HELP</b> or the system keyword <b>help=</b> can be set to
a non-zero number to change to various levels of interactive input if implemented.

<h2><a name='sect7' href='#toc7'>Output Keys</a></h2>
The system keyword <b>outkeys=</b><i>key1,key2,...</i> controls which  pre-defined
output keys (see <a href='outparam.3NEMO.html'><i>outparam(3NEMO)</i></a>
) are going to  output to NEMO&rsquo;s persistent
global keyword database. 
<h2><a name='sect8' href='#toc8'>Debugging</a></h2>
The system keyword <b>debug=</b><i>debug_level</i> is
checked for by the <i>initparam</i> call. It sets the <b>debug_level</b> to the requested
value. Any calls to <a href='dprintf.3NEMO.html'><i>dprintf(3NEMO)</i></a>
 will only be send to the standard error
output device,(<i>stderr</i>), if <b>debug</b> is less or equal than <b>debug_level</b>. Any
initial setting of <b>debug_level</b> is also done through an environment variable
<b>DEBUG</b>, but overriden by the <b>debug=</b> keyword. 
<h2><a name='sect9' href='#toc9'>Files</a></h2>
<br>
<pre>~/src/kernel/io   <tt> </tt>&nbsp;<tt> </tt>&nbsp;getparam.c 
~/src/kernel/cores<tt> </tt>&nbsp;<tt> </tt>&nbsp;error.c (stop)
</pre>
<h2><a name='sect10' href='#toc10'>See Also</a></h2>
<a href='environ.5.html'>environ(5)</a>
, <a href='dprintf.3NEMO.html'>dprintf(3NEMO)</a>
, <a href='error.3NEMO.html'>error(3NEMO)</a>
, <a href='nemoinp.3NEMO.html'>nemoinp(3NEMO)</a>
, <a href='nemomain.3NEMO.html'>nemomain(3NEMO)</a>
,
<a href='outparam.3NEMO.html'>outparam(3NEMO)</a>
 
<h2><a name='sect11' href='#toc11'>Diagnostics</a></h2>
Complains via <a href='error.3NEMO.html'><i>error(3NEMO)</i></a>
 or the <i>local_error()</i>
function about extra arguments, unknown arguments,  etc.  This will generally
result in a stopped program. 
<h2><a name='sect12' href='#toc12'>Bugs</a></h2>
The code to access <i>environ</i> has only been
implemented for the system environment variables <b>DEBUG, YAPP, HISTORY,
BELL, REVIEW, ERROR, ARGV</b>  and <b>HELP</b>.  <p>
Some undocumented features. The <i>NEMO
Users Guide</i> is often more complete. <p>
A key-less parameter that contains an
&rsquo;=&rsquo; sign confuses the parser and will most likely complain about an unknown
parameter. E.g. "i%%128==0" will return <i>Parameter "i%128" unknown</i>. 
<h2><a name='sect13' href='#toc13'>Examples</a></h2>
Here
are some examples of usage of such a user interface. Assume we have a program
<b>p</b>, which has keywords <b>a</b>, <b>b</b> and <b>c</b>, of which <b>c</b> is an indexed keyword <br>
<pre>% p help=
p a=1 b=2 c#= VERSION=0.1
% p help=h
a                : keyword a [1]
b                : keyword b [2]
c#               : indexed keyword c []
VERSION          : PJT [0.1]
% p a=2
% p c2=1 c0=1.2
% mkplummer . 1000000 help=c
CPU_USAGE mkplummer : 7.84    6.99 0.42  0.00 0.00  6202936
</pre>
<h2><a name='sect14' href='#toc14'>Author</a></h2>
Joshua Barnes, Peter Teuben 
<h2><a name='sect15' href='#toc15'>Update History</a></h2>
<br>
<pre>xx-nov-86<tt> </tt>&nbsp;<tt> </tt>&nbsp;created                         <tt> </tt>&nbsp;<tt> </tt>&nbsp;Joshua Barnes
16-oct-87<tt> </tt>&nbsp;<tt> </tt>&nbsp;add system keyword host=        <tt> </tt>&nbsp;<tt> </tt>&nbsp;Peter Teuben
9-mar-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;add system keyword debug=       <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
21-apr-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;interactive input                <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
24-nov-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;editor mode in help=              <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
6-mar-89<tt> </tt>&nbsp;<tt> </tt>&nbsp;added nemoinp parsing of getXparam<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
28-nov-94<tt> </tt>&nbsp;<tt> </tt>&nbsp;V3 rewrite, many new features, deleted some others<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
12-feb-95<tt> </tt>&nbsp;<tt> </tt>&nbsp;added updparam
20-jan-02<tt> </tt>&nbsp;<tt> </tt>&nbsp;re-implemented indexed keywords<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
12-jul03<tt> </tt>&nbsp;<tt> </tt>&nbsp;added getargv()<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
13-may-04<tt> </tt>&nbsp;<tt> </tt>&nbsp;added help=c<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
29-dec-04  <tt> </tt>&nbsp;<tt> </tt>&nbsp;added help=I and documented CVSID<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Required Arguments</a></li>
<li><a name='toc4' href='#sect4'>Version</a></li>
<li><a name='toc5' href='#sect5'>Indexed Keywords</a></li>
<li><a name='toc6' href='#sect6'>Help Functions</a></li>
<li><a name='toc7' href='#sect7'>Output Keys</a></li>
<li><a name='toc8' href='#sect8'>Debugging</a></li>
<li><a name='toc9' href='#sect9'>Files</a></li>
<li><a name='toc10' href='#sect10'>See Also</a></li>
<li><a name='toc11' href='#sect11'>Diagnostics</a></li>
<li><a name='toc12' href='#sect12'>Bugs</a></li>
<li><a name='toc13' href='#sect13'>Examples</a></li>
<li><a name='toc14' href='#sect14'>Author</a></li>
<li><a name='toc15' href='#sect15'>Update History</a></li>
</ul>
</body>
</html>
