<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>ROTCUR(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
HTML automatically generated with <A HREF=http://manpages.ubuntu.com/manpages/bionic/man1/rman.1.html>rman</A><br>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
rotcur - fit parameters to velocity field using tilted rings 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<b>rotcur
in=</b>velfie [parameters=values ...] 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<i>rotcur</i> derives the kinematical
parameters from the observed velocity field by fitting a tilted-rings model
to the velocity field.  It does a non-linear least-squares-fitting to the function:
<p>
  <br>
<pre>         v(x,y) = VSYS + VROT * cos(theta) * sin(INC)
                      - (x-XPOS) * sin(PA) -/+ (y-YPOS) * cos(PA) ?
where:   cos(theta) = -----------------------------------------
                                       r
                      - (x-XPOS) * cos(PA) - (y-YPOS) * sin(PA)
and:     sin(theta) = -----------------------------------------
                                   r * cos(INC)
</pre>where the radius <i>r</i> is measured in the plane of the galaxy:   <br>
<pre>         r = sqrt( (x-XPOS)**2 + (y-YPOS)**2/cos(INC)**2 )
</pre><p>
In the above formula <i>v(x,y)</i> denotes the radial velocity at rectangular
sky coordinates <i>x</i> and <i>y</i>, <i>VSYS</i> the systemic  velocity, <i>VROT</i> the rotational
velocity, <i>INC</i> the inclination angle and <i>theta</i> the  azimuthal distance from
the major axis in the plane of the galaxy.   In itself, <i>theta</i> is a function
of the inclination (<i>INC</i>) and the  position angle (<i>PA</i>) of the major axis.
<i>XPOS</i> and <i>YPOS</i> denote the position of the rotation center in pixels w.r.t.
0,0 being the lower left corner of the map.  <i>rotcur</i> can fit for each ring
the 6 parameters <i>VSYS</i>, <i>VROT</i>, <i>INC</i>, <i>PA</i>, <i>XPOS</i> and <i>YPOS</i>, though any combination
of them can be fixed (see <b>fixed=</b>). The position angle <i>PA</i> of the major axis
is defined as the angle, taken in anti-clockwise direction between the north
direction on the &lsquo;&lsquo;sky&rsquo;&rsquo; and the major axis of the receding half (positive
 radial velocity) of the galaxy.  <p>
Values equal the undefined value (currently
0.0) are ignored in the fit. See <a href='ccdmath.1.html'><i>ccdmath(1NEMO)</i></a>
 or <a href='fitsccd.1.html'><i>fitsccd(1NEMO)</i></a>
 on how
to create a velocity field with such undefined values. <p>
By setting the keyword
<b>fitmode=</b> appropriately, <i>rotcur</i> can also be used to fit a model of pure
expansional velocities:   <br>
<pre>         v(x,y) = VSYS + VROT * sin(theta) * sin(INC)
</pre>use <b>fitmode=sin,1</b> in this case. <i>currently XPOS and YPOS <b>must</b></i> be held fixed
in this case. <p>
For a detailed discussion of this method see K. Begeman, <i>Astr.
&amp; Astrophys. </i> <b>223</b>, 47. (1989) and references therein. <p>
See also <a href='velfit.1.html'><i>velfit(1NEMO)</i></a>

on the classic WWB73 (Warner, Wright and Baldwin, 1973, MNRAS, 163,163)
method. 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
The following parameters are recognized: 
<dl>

<dt><b>in</b>=<i>image_vel</i>
</dt>
<dd>Input velocity field map, either in <a href='image.5.html'><i>image(5NEMO)</i></a>
 format, or <a href='table.5.html'><i>table(5NEMO)</i></a>

format. See also <b>imagemode=</b> below. No default. </dd>

<dt><b>radii</b>=<i>r0,r1,r2,...rN</i> </dt>
<dd>Inner and
outer radii for <i>N</i> touching rings (in arcsec). Remember that the number of
radii is hence one more than the number of rings. The <b>units=</b> keyword can
be used to scale your physical units in the header to &lsquo;&lsquo;human readable&rsquo;&rsquo; units
(arcsec). Radii must be either all increasing or decreasing. Note that the
corresponding keyword in <b>GIPSY</b> has a different meaning,  where they denote
the ring centers, and a different keyword <i>WIDTHS=</i> controls the width of
each ring. No default. </dd>

<dt><b>vrot</b>=<i>v1,v2,...vN</i> </dt>
<dd>Array of rotation (or expansion) velocities,
one for each ring.  If less than the number of rings is given, the trailing
ones are filled with the last supplied value. </dd>

<dt><b>pa</b>=<i>p1,p2,...pN</i> </dt>
<dd>Array of position
angles (degrees), one for each ring.  As is the convention, this is the
PA of the receding side of the galaxy. See also <b>vrot=</b>. </dd>

<dt><b>inc</b>=<i>i1,i2,...iN</i> </dt>
<dd>Array
of inclinations (degrees), one for each ring. See also <b>vrot=</b>. </dd>

<dt><b>vsys</b>=<i>v0</i> </dt>
<dd>Systemic
velocity. Only one number applies, though VSYS can vary accross rings. </dd>

<dt><b>center</b>=<i>x0,y0</i>
</dt>
<dd>Rotation center (grid units w.r.t. lower left corner being 0,0). Two numbers
are required. Default: center of map. </dd>

<dt><b>frang</b>= </dt>
<dd>free angle around minor axis
(degrees), in the plane of the galaxy, from which data is excluded from
the fit (thus the total cone size of ignored data around the minor axis
is 2*<b>frang</b>) [Default: <b>20.0</b>]. </dd>

<dt><b>side</b>= </dt>
<dd>Choose the side of the galaxy to fit the
velocity field to. Valid options are <b>receding</b>, <b>approaching</b>  or <b>both</b> side(s).
[Default: <b>both</b>]. </dd>

<dt><b>weight</b>= </dt>
<dd>Choice of geometric weighting function with which
points are weighed into the least squares solution as a function of galactic
angle away from the major axis. Valid options are: <b>uniform</b>, <b>cosine</b>, and
<b>cos-squared</b>. [Default: <b>cosine</b>]. </dd>

<dt><b>fixed</b>= </dt>
<dd>List of parameters, separated by commas,
to be kept fixed during the fit. Choose any of the following: <b>vsys, vrot,
pa, inc, xpos, ypos</b>, although at least one parameters should be kept free.
[Default: none, i.e. all parameters free. </dd>

<dt><b>ellips</b>= </dt>
<dd>The names of two parameters
for which to calculate an error ellips.  (see <b>fixed=</b>). For the two parameters
it shows the major and minor axis, position angle of the one sigma deviation
ellipse. [Default: not used] </dd>

<dt><b>beam</b>= </dt>
<dd>The beam size (FWHM, in arcsec) for beam
correction. One or two numbers required. Currently these are only used to
correct error bars for the number of independant points per beam. If not
given, each point is assumed independant. [no correction]. </dd>

<dt><b>dens</b>=<i>image_den|true|false</i>
</dt>
<dd>Image containing the density. From this local derivatives <i>(dN/dx)/N</i> and
 <i>(dN/dy)/N</i> are computed numerically, and used for an  estimate of beam
smearing corrections. See also <a href='testbsc.1.html'><i>testbsc(1NEMO)</i></a>
. Note that for bizarre reasons
this keyword can be used to trigger reading a weight column in tabular
input mode (Bimagemode=). [Default: required if a beam is supplied]. </dd>

<dt><b>wtmap</b>=<i>wt_image</i>
</dt>
<dd>If given, the weights (like 1/RMS^2) of the pixels. </dd>

<dt><b>tab</b>= </dt>
<dd>If specified, this
output table is used in <i>append</i> mode! This table can be piped through <a href='tabcomment.1.html'><i>tabcomment(1NEMO)</i></a>

and  fed to <a href='ccdvel.1.html'><i>ccdvel(1NEMO)</i></a>
 to create model velocity fields. [Default: not
used]. </dd>

<dt><b>resid</b>= </dt>
<dd>If specified, this output will either contain a residual image
(OBS-FIT) if the input file was an image, or a table with X, Y, Velocity
and Residual Velocities in each ring.  Each ring will be separated from
the previous one with a simple commented line specifying which ring it
refers to.  [Default: not used]. </dd>

<dt><b>tol</b>= </dt>
<dd>Tolerance for convergence of <i>nllsqfit</i>
[Default: <b>0.001</b>]. </dd>

<dt><b>lab</b>= </dt>
<dd>Mixing parameter for <i>nllsqfit</i> [Default: <b>0.001</b>] </dd>

<dt><b>itmax</b>=
</dt>
<dd>Maximum number of allowed <i>nllsqfit</i> iterations [Default: <b>50</b>] </dd>

<dt><b>units</b>= </dt>
<dd>Units
of input axes for radius and velocity. Valid options are <b>deg, arcmin, arcsec,
rad</b> for radius. A numeric value can also be given, in which case your image
pixel separation from the image header is multiplied by this number to
get to the &lsquo;&lsquo;arcsec&rsquo;&rsquo; that will be quoted in the tables. The units for velocity
can only be numeric, and will be the factor by which the velocities in
the map are multiplied. [Default: <b>deg</b>] </dd>

<dt><b>blank=</b> </dt>
<dd>Value of the blank pixel that
needs to be ignored. [Default: <b>0.0</b>]. </dd>

<dt><b>inherit=t|f</b> </dt>
<dd>Logical denoting if the initial
conditions for subsequent fitted rings should be inherited from the previous
successfully fitted ring. The fixed parameters keep of course their fixed
value. [Default: <b>t</b>] </dd>

<dt><b>reuse=t|f</b> </dt>
<dd>Reuse pixels between rings. If neighboring rings
have a different geometries, it can occur that pixels will be reused. This
flag will prevent that. Note, if you don&rsquo;t reuse pixels, rotcur will more
likely produce a different rotation curve if you start at outer rings,e.g.
radii=100:0:-10. [Default: <b>t</b>] </dd>

<dt><b>fitmode=</b><b>cos|sin</b><b>,1</b> </dt>
<dd></dd>

<dt><b>nsigma=</b> </dt>
<dd>Reject outlier points
will fall outside nsigma times the dispersion  away from the mean velocity
in a ring. By default, it will not reject any outliers. </dd>

<dt><b>imagemode=t|f</b> </dt>
<dd>Image
input file mode? By default the input file is an image, alternatively a
simple ascii table with X and Y positions in columns 1 and 2, and radial
velocities in column 3, and optional errors in the radial velocity in column
4 (activated by setting <b>dens=t</b>). [Default: t] </dd>

<dt><b>wwb73=t|f</b> </dt>
<dd>Use a simpler WWB73
(Warner, Wright, Baldwin 1973) linear method of fitting? [false] </dd>
</dl>

<h2><a name='sect4' href='#toc4'>AWK</a></h2>
The
standard output is normally not very useful; it displays, for each iteration,
the run of parameters plus the number of points and mean error in the ring.
The following <a href='awk.1.html'><i>awk(1)</i></a>
 scripts may be useful to extract information per ring:
<i>iter. number, vsys, vrot, pa, icn, xpos, ypos, npoints, sigma_vel</i>. <br>
<pre>BEGIN{count=0;line="";}
{
  if ($1 == "radius"){
    if (count != 0){
      printf("%s  %s0,rad,line);
      rad=$4;
    }else{
      count=1; 
      rad=$4;
    }
  }else{
    line=$0
  }
}
END{printf("%s  %s0,rad,line);}
</pre>
<h2><a name='sect5' href='#toc5'>Example</a></h2>
Here is an example of creating a synthetic velocity field with ccdvel,
and analysing it with rotcur: <br>
<pre>    % set r=&lsquo;nemoinp 0:100:5&lsquo;
    % set v=&lsquo;nemoinp 0:100:5 | tabmath - - "100*%1/(20+%1)" all&lsquo;
    % ccdvel out=map1.vel rad="$r" vrot="$v" pa=30 inc=60
    % rotcur in=map1.vel radii=0:100:5 vrot=0:100:5 pa=30 inc=60 vsys=0
tab=map1.rotcur units=arcsec,1
    % head map1.rotcur
  radius   systemic   error  rotation   error position    error   inclination
 error   x-position   error   y-position   error
          velocity           velocity           angle               angle
              of center            of center
 (arcsec)   (km/s)   (km/s)   (km/s)    (km/s)(degrees)  (degrees)  (degrees)
  (degrees) (grids w.r.t. (0,0))  (grids w.r.t. (0,0))
     7.50      0.00     0.44     27.08    0.50    30.45       1.09      59.72 
     2.47      63.50      0.20      63.50      0.30 96
    12.50     -0.00     0.24     38.54    0.28    30.66       0.41      59.27  
    0.94      63.50      0.13      63.50      0.20 150
    ...
    % tail map1.rotcur
 average inclination      :    59.93  (   0.043)  degrees
 average position angle   :    30.05  (   0.044)  degrees
 average systemic velocity:    -0.00  (   0.001)  km/s
 average x-position       :    63.50  (   0.000)  grids
 average y-position       :    63.50  (   0.001)  grids
</pre>
<h2><a name='sect6' href='#toc6'>Bugs</a></h2>
Failures in <i>nllsqfit</i> are not handled gracefully, and may <i>error</i> out
the program. Usage of the <b>error=</b> system keyword can be used to bypass such
bad rings, use with caution though and study the output. <p>
Errorbars quoted
in the table are only an estimate since the beam size is not known. Multiply
these numbers by the square root of the number of pixels per beam to get
a more realistic estimate. If the beamsize, <b>beam=</b>, is given, the formulae
of Sicking (1997) was previously used to correct the errors for: <br>
<pre><tt> </tt>&nbsp;<tt> </tt>&nbsp;factor = sqrt(4.PI.B_x.B_y/(D_x.D_y))
</pre>but this is clearly too large, instead <br>
<pre><tt> </tt>&nbsp;<tt> </tt>&nbsp;factor = sqrt(PI/(4ln2).B_x.B_y/(D_x.D_y))
</pre>is now used. <p>
Sign of the pixelsize <i>Dx,Dy</i> in the CCD header is ignored, and
an astronomical image is assumed. See also the <b>reuse=</b> keyword. <p>
For calculations
of residuals in  overlapping rings (e.g. warps) only the last ring velocity
will be used. 
<h2><a name='sect7' href='#toc7'>See Also</a></h2>
<a href='ccdvel.1.html'>ccdvel(1NEMO)</a>
, <a href='tabcomment.1.html'>tabcomment(1NEMO)</a>
, <a href='rotcurves.1.html'>rotcurves(1NEMO)</a>
,
<a href='rotcurshape.1.html'>rotcurshape(1NEMO)</a>
, <a href='pvtrace.1.html'>pvtrace(1NEMO)</a>
, <a href='runvelfitss07.1.html'>runvelfitss07(1NEMO)</a>
, <a href='ccdmom.1.html'>ccdmom(1NEMO)</a>
,
<a href='testbsc.1.html'>testbsc(1NEMO)</a>
,  gal(AIPS), rocur(AIPS), <a href='velfitpatch.1.html'>velfitpatch(1NEMO)</a>
, <a href='rotcur.5.html'>rotcur(5NEMO)</a>

<br>
<pre>Begeman(1989):  1989A+A...223...47B
Warner, Wright, Baldwin (1973): 1973MNRAS.163..163W
pPXF: http://www-astro.physics.ox.ac.uk/~mxc/idl/#ppxf
2DBAT:  https://github.com/seheonoh/2dbat
Bbarolo: http://editeodoro.github.io/Bbarolo/
BBAROLO: https://bbarolo.readthedocs.io/en/latest/
GALPAK3D: http://galpak3d.univ-lyon1.fr/index.html
GBKFIT: http://supercomputing.swin.edu.au/projects/gbkfit/
TiRiFiC: http://www.astron.nl/~jozsa/tirific/index.html
</pre>
<h2><a name='sect8' href='#toc8'>Author</a></h2>
K. Begeman (original GIPSY Sheltran version, now also available in
C), P. J. Teuben (NEMO C version) 
<h2><a name='sect9' href='#toc9'>Update History</a></h2>
<br>
<pre>19/jul/83<tt> </tt>&nbsp;<tt> </tt>&nbsp;original program                     <tt> </tt>&nbsp;<tt> </tt>&nbsp;KGB
9/mar/85<tt> </tt>&nbsp;<tt> </tt>&nbsp;revision of program                 <tt> </tt>&nbsp;<tt> </tt>&nbsp;KGB
23/may/86<tt> </tt>&nbsp;<tt> </tt>&nbsp;migrated to VAX-VMS                  <tt> </tt>&nbsp;<tt> </tt>&nbsp;KGB
27/nov/88<tt> </tt>&nbsp;<tt> </tt>&nbsp;UNIX version                           <tt> </tt>&nbsp;<tt> </tt>&nbsp;pjt
8-feb-91<tt> </tt>&nbsp;<tt> </tt>&nbsp;flushed buffers ROTCUR.DAT each write<tt> </tt>&nbsp;<tt> </tt>&nbsp;pjt
30-apr-91<tt> </tt>&nbsp;<tt> </tt>&nbsp;moved to NEMO into C                   <tt> </tt>&nbsp;<tt> </tt>&nbsp;pjt
10-sep-91<tt> </tt>&nbsp;<tt> </tt>&nbsp;documentation improved           <tt> </tt>&nbsp;<tt> </tt>&nbsp;pjt
17-oct-91<tt> </tt>&nbsp;<tt> </tt>&nbsp;added Npts to table output      <tt> </tt>&nbsp;<tt> </tt>&nbsp;pjt
21-may-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;added Bob Gruendl&rsquo;s rotcur awk scripts<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
12-jun-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;added inherit=t as default      <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
13-aug-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;implemented fitmode= without XPOS,YPOS<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
15-oct-99<tt> </tt>&nbsp;<tt> </tt>&nbsp;compute residuals and add resid=<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
14-mar-01<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.5: clarifications, added nsigma=    <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
9-may-01<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.6a: corrected error correction factor<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
10-aug-01<tt> </tt>&nbsp;<tt> </tt>&nbsp;clarified some differences between NEMO and GIPSY versions<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
26-jan-02<tt> </tt>&nbsp;<tt> </tt>&nbsp;Added unit (scale factor) for velocity too<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
26-jun-02<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.8: added tabular input for irregular spaced data, fixed example<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
11-sep-02<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.9: implemented map residual velocity field<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
30-jan-03<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.10: allow tables to use error in velocity<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
2-jun-04<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.12: finally implemented the reuse= option<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
6-jun-20<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.13: added wtmap=<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
18-jan-21<tt> </tt>&nbsp;<tt> </tt>&nbsp;V2.14: beam error factor back to standard, not Sicking<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>AWK</a></li>
<li><a name='toc5' href='#sect5'>Example</a></li>
<li><a name='toc6' href='#sect6'>Bugs</a></li>
<li><a name='toc7' href='#sect7'>See Also</a></li>
<li><a name='toc8' href='#sect8'>Author</a></li>
<li><a name='toc9' href='#sect9'>Update History</a></li>
</ul>
</body>
</html>
