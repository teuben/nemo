<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>IO_NEMO_F(3NEMO) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
<b>io_nemo_f</b> -- High level C function to read/save NEMO snapshot from a
FORTRAN program. 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<br>
<pre>io_nemo_f(filename, slen, MAXBODY, param, ....)
character * filename(*);/* input/output file name */
integer     slen;       /* #characters in &rsquo;infile&rsquo; */
integer     MAXBODY;    /* maximun bodies allowed */
character * param(*);   /* parameters list */

Descriptionio_nemo_f is a high level C function which allows the user to
perform I/O operations on NEMO snapshot files from a FORTRAN program.  The
use of this function is very simple and doesn&rsquo;t require any knowledge of
how to program in NEMO. 

Parameters 
 filename=character variable Input/Output file name of the NEMO snapshot
that you want to read/save. (this CHARACTER string must be a VARIABLE, not
a constant !). slen=integer Lenght of the file name.  (We need this information
because of the interface bettween FORTRAN and C language) MAXBODY=integer
Size of array that you use to get/put the data. Match the size of the array
to the maximum number of bodies that you are able to read/save.  param=character
Param is a string in which you specify what you want to do with the NEMO
file. Each choice is defined with a flag separated with &rsquo;,&rsquo;. There are two
kind of flags. (1) Information flags allow to specify some actions during
the I/O. (2) Variables flags allow to specify what you want to get/put from/into
the NEMO file. The FLAGS list is described below. DO NOT FORGET TO ADD A
\0 at the end of Param variable as you can see in the example below. 
(1)
Information flagss | save Specify that you want to save data to a NEMO file.
r | read Specify that you want to read data from a NEMO file. real4|single
Specify that the variables that you use to get/put data from/into NEMO
files have been declared in single precision. (real * 4). real8|double Specify
that the variables you use to get/put data from/into NEMO files have been
declared in double precision. (real * 8). f | n3 Assumes that you declared
yours two-dimensionnal FORTRAN arrays (pos, vel, acc) using the number of
bodies for the first dimension and the number of space coordinates (always
3D) for the second dimension. (example : real * 4 pos(10000,3) ). c | 3n Assumes
that you declared yours two-dimensionnal FORTRAN arrays (pos, vel, acc)
using the number of space coordinates (always 3D)  for the first dimension
and the number of bodies for the second dimension. (example : real * 4 vel(3,10000)
). info | diag Gives some informations during the runtime execution.  
(2)
Variables flags n|nbody Match to the number of bodies. t|time Match to the
snapshot time. m|mass Match to the particle masses. x|pos Match to the particle
positions. v|vel Match to the particle velocities. p|pot Match to the particle
potentials. a|acc Match to the particle accelerations. aux Match to the auxiliary
array. k|keys Match to the keys array. d|dens Match to the particle density.
e|eps Match to the particle softening.  st Select snapshot&rsquo;s times. You have
to  put the selected time in a string limited by the character &rsquo;#&rsquo;. Example
"100:150#" select the time beween 100 and 150. The string is fully compatible
with the expression usually given to nemoinpi (Cf man nemoinpi).  sp Select
snapshot&rsquo;s particles. You have to  put the selected particles in a string
limited by the character &rsquo;#&rsquo;. Example "0:299999#" select the particles beween
0 and 299999. The returned nbody corresponds to the selected nbody. In the
example above it would thus be 300000. The string is fully compatible with
the expression usually given to nemoinpi (Cf man nemoinpi).   
ArgumentsThe
variable flags specify which data you will get/put from/into the NEMO file,
hence after the selection string param, you must insert all the selected
variables (arguments) in the same order with which they have been declared
in param.  Return ValueThe function return 1 if successfull, 0 if the end
of snapshot has been reached.  ExampleHere is a FORTRAN program to illustrate
the use of the function io_nemo_f(). The program reads all the time steps
into a NEMO a file, and saves the data in another NEMO file. Source file
of the example below is located here: $NEMOSRC/nbody/io_nemo/test_src/nemo_fortran_d_3n.F

C----------------------------------------------------------- 
      program nemo_fortran
      implicit none
c maximum # of bodies
      integer MAXBODY<tt> </tt>&nbsp;<tt> </tt>&nbsp;
      parameter (MAXBODY=100000)
      real*8  
c particle masses.
     +     mass(1:MAXBODY),
c particle positions and velocities    
     +     pos(3,MAXBODY), vel(3,MAXBODY),
c snapshot time
     +     ts
c file names
      character infile*80,outfile*80
      integer i,j,k,nbody,io_nemo_f,close_io_nemo_f
c get input snapshot filename
      write(*,*)&rsquo;Infile name : &rsquo;
      read(*,&rsquo;(a80)&rsquo;)infile
c get output snapshot filename
      write(*,*)&rsquo;outfile name : &rsquo;
      read(*,&rsquo;(a80)&rsquo;)outfile
      i = 1
      do while (i.gt.0) 
c read the snapshot up to the end of file 
c at the end of snapshot, io_nemo_f return 0
         i=io_nemo_f(infile,80,MAXBODY,"real8,3n,read,n,m,x,v,t,info\0",
     $        nbody,mass,pos,vel,ts)
c save the snapshot
         if (i.gt.0) then
            j=io_nemo_f(outfile,80,MAXBODY,"real8,3n,save,n,m,x,v,t, 
     $           info\0",nbody,mass,pos,vel,ts)
         endif
      end do
c close the snapshot &rsquo;outfile&rsquo;
      k= close_io_nemo_f(outfile,80)
      end
C----------------------------------------------------------- 

Important Thingsa) Notice in the example above, that in the parameter list,
&rsquo;n&rsquo; matches &rsquo;nbody&rsquo;, &rsquo;m&rsquo; matches &rsquo;mass&rsquo;, &rsquo;x&rsquo; matches &rsquo;pos&rsquo;, &rsquo;v&rsquo; matches &rsquo;vel&rsquo;, &rsquo;t&rsquo; matches
&rsquo;ts&rsquo;.  All the variables are in the same order that they have been declared
in the param list. Notice also that you must add \0 at the end of Param variable
"real8,3n,read,n,m,x,v,t,info\0".  b) You must declare all the two-dimensionnal
arrays in the same way. That means all the dimensions must be the same for
all the arrays, moreover both one-dimensional and two-dimensional array must
have the same size for the maximum of bodies.  c) All the arrays must be
declared in the same floating type.  d) During a "read" operation, the function
io_nemo_f() return &rsquo;0&rsquo; if it is the end of the NEMO file. That means that
no new values have been read.  </pre><p>

<h2><a name='sect10' href='#toc10'>Compilation</a></h2>
To use the function <i>io_nemo_f()</i>
from a FORTRAN program you must link your program with the library <i>libnemo.a</i>
as described  in the Makefile below. Notice that there are specials compilation
flags  and linking options according to you use <b>g77 compiler</b> or <b>gfortran
compiler</b> or <b>ABSOFT fortran compiler</b>. <p>
<br>
<pre># ----------------------------------------
# MAKEFILE to use IO_NEMO_F
# 
# ----------------------------------------
# path for NEMO Library and IO_NEMO_F library
LIBS = -L$(NEMOLIB)
# - - - - - - - - - - - - - - - - - - - -
# compilation with g77 compiler
# - - - - - - - - - - - - - - - - - - - -
G77FLAGS = -fno-second-underscore -Wno-globals
nemo_fortran_g77 : nemo_fortran.F
<tt> </tt>&nbsp;<tt> </tt>&nbsp;g77 $(G77FLAGS)  -o $@ nemo_fortran.F $(LIBS) \
                  -lnemomaing77 -lnemo -lm
# - - - - - - - - - - - - - - - - - - - -
# compilation with gfortran compiler
# - - - - - - - - - - - - - - - - - - - -
GFORTFLAGS = -fno-second-underscore
nemo_fortran_g77 : nemo_fortran.F
<tt> </tt>&nbsp;<tt> </tt>&nbsp;gfortran $(GFORTFLAGS)  -o $@ nemo_fortran.F $(LIBS) \
                  -lnemomaing77 -lnemo -lm
# - - - - - - - - - - - - - - - - - - - -
# compilation with absoft f77 compiler
# - - - - - - - - - - - - - - - - - - - -
ABFFLAGS = -B108 -K
nemo_fortran_ABSOFT : nemo_fortran.F
<tt> </tt>&nbsp;<tt> </tt>&nbsp;$(ABSOFT)/bin/f77 $(ABFFLAGS)  -o $@ nemo_fortran.F $(LIBS) \
                   -lnemo -lm
# ----------------------------------------
</pre>
<h2><a name='sect11' href='#toc11'>See Also</a></h2>
<br>
<pre>nemo(1NEMO), snapshot(5NEMO).
</pre>
<h2><a name='sect12' href='#toc12'>Author</a></h2>
Jean-Charles LAMBERT 
<p> 
<h2><a name='sect13' href='#toc13'>BUGS and COMMENT</a></h2>
Please, report all bugs and
comment to :  <br>
<pre>Jean-Charles.Lambert@oamp.fr
</pre>
<h2><a name='sect14' href='#toc14'>Update History</a></h2>
<br>
<pre>15-Jun-95<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.0 : created                        JCL
21-Jun-95<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.10: bugs fixes                     JCL
12-Dec-95<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.11: possibility to close file      JCL
11-Mar-96<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.12: acceleration I/O added         JCL
04-Apr-97<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.13: generic real format            JCL
07-Apr-97<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.14: manual created                 JCL 
19-Jul-02<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.20: io_nemo/io_nemo_f unified      JCL 
18-Mar-04<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.21: bugs fixed, softening added    JCL
03-Mar-05<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.30: code cleaning, valgrind safe   JCL
24-Apr-06<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.31: memory leak fixed              JCL
19-Jun-06<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.32: happy gfortran                 JCL
29-May-07<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.42: handle snapshot with different JCL
<tt> </tt>&nbsp;<tt> </tt>&nbsp;               nbodies
29-Feb-08<tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.50: add Aux and Dens array         JCL
</pre>
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> <p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>(1) Information flags</a></li>
<li><a name='toc5' href='#sect5'>(2) Variables flags</a></li>
<li><a name='toc6' href='#sect6'>Arguments</a></li>
<li><a name='toc7' href='#sect7'>Return Value</a></li>
<li><a name='toc8' href='#sect8'>Example</a></li>
<li><a name='toc9' href='#sect9'>Important Things</a></li>
<li><a name='toc10' href='#sect10'>Compilation</a></li>
<li><a name='toc11' href='#sect11'>See Also</a></li>
<li><a name='toc12' href='#sect12'>Author</a></li>
<li><a name='toc13' href='#sect13'>BUGS and COMMENT</a></li>
<li><a name='toc14' href='#sect14'>Update History</a></li>
</ul>
</body>
</html>
