<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>TRICKS(8NEMO) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<p> 
<h2><a name='sect0' href='#toc0'>Name</a></h2>
tricks - some Unix tricks when using NEMO 
<p> 
<h2><a name='sect1' href='#toc1'>Files: Compression and Such</a></h2>
One
can use <a href='cat.1.html'><i>cat(1)</i></a>
 to catenate structured binary files, e.g. <br>
<pre><tt> </tt>&nbsp;<tt> </tt>&nbsp;cat r001a.dat &gt;&gt;r001.dat
</pre><p>
To copy structured binary files between machines of different binary format,
use the <a href='tsf.1.html'><i>tsf(1NEMO)</a>
, <a href='rsf.1.html'>rsf(1NEMO)</i></a>
 programs and, if available, the <a href='compress.1.html'><i>compress(1)</a>
,
<a href='uncompress.1.html'>uncompress(1)</i></a>
 utilities: <br>
<pre><tt> </tt>&nbsp;<tt> </tt>&nbsp;tsf in=r001.dat maxprec=t allline=t | compress &gt;&gt; r001.data.Z
and on the other machine:
<tt> </tt>&nbsp;<tt> </tt>&nbsp;zcat r001.data.Z | rsf - r001.dat
</pre>On non-Unix supercomputers, often the ASCII "205" format (see e.g. <a href='atos.1.html'><i>atos(1NEMO)</i></a>
)
will be used. This may be saved in compressed format also, and can be processed
by NEMO after <br>
<pre><tt> </tt>&nbsp;<tt> </tt>&nbsp;zcat r001.data.Z | atos - r001.dat
</pre>See also the <a href='tcppipe.1.html'><i>tcppipe(1NEMO)</i></a>
 program to read the data over a pipe from another
machine. <p>
Some N-body programs, which are capable of handling a series of
snapshots, and selecting them using the <b>times=</b> keyword, are not able to
handle subsequent snapshots which are larger than the first one. In fact,
 unpredictable things may happen, although usually it results in a core
because of illegal memory access. There are two solutions. The program can
be recompiled, by using a <b>-DREALLOC</b> flag or <b>#define</b> it in the source code.
The second solution is to prepend the datafile with a large enough &rsquo;dummy&rsquo;
file. <p>
To display a scatter diagram in the form of a contour map, convert
the two columns to a snapshot by calling them &rsquo;x&rsquo; and &rsquo;y&rsquo; coordinates. Remaining
phase space coordinates are unimportant. Set masses to 1, and use the <a href='atos.1.html'><i>atos(1NEMO)</i></a>

format. A program like <a href='awk.1.html'><i>awk(1)</i></a>
 can write the file for <a href='atos.1.html'><i>atos(1NEMO)</i></a>
, then <a href='snapgrid.1.html'><i>snapgrid(1NEMO)</i></a>

creates a <a href='image.5.html'><i>image(5NEMO)</i></a>
 file, which can be optionally smoothed using <a href='ccdsmooth.1.html'><i>ccdsmooth(1NEMO)</i></a>

and displayed with <a href='ccdplot.1.html'><i>ccdplot(1NEMO)</i></a>
. In case your host has nicer contour plotting
programs, use <a href='ccdfits.1.html'><i>ccdfits(1NEMO)</i></a>
 to write a <a href='fits.5.html'><i>fits(5NEMO)</i></a>
 format file. Check also
the tabccd shell script, if available, or perhaps someone wrote it in C
already. It calls awk, atos and snapgrid. <p>
The <a href='ds9.1.html'><i>ds9(1)</i></a>
 program is one of the
external programs which can be used to display images. <i>ds9</i> can understand
a variety of FITS compression standards. Transform your image to a fits
file using <a href='ccdfits.1.html'><i>ccdfits(1NEMO)</i></a>
, and use  ds on that fits file. 
<p> 
<h2><a name='sect2' href='#toc2'>PIPES and SHARED
MEMORY</a></h2>
NEMO encourages you to use pipes where serial operations make sense
(see also <a href='tee.1.html'><i>tee(1)</i></a>
). However on Linux, assuming you have enough memory, using
/dev/shm (or anything that uses <a href='tmpfs.1.html'><i>tmpfs(1)</i></a>
)   will sacrifice your memory
to store data temporarely and could speed up your I/O dominated workflow.
Here is an example: <br>
<pre>       mkdir /dev/shm/$USER
       cd /dev/shm/$USER
       mkspiral s000 1000000 nmodel=40
</pre>The example of <a href='mkspiral.1.html'><i>mkspiral(1NEMO)</i></a>
 is taken from the NEMO <a href='bench.5.html'><i>bench(5NEMO)</i></a>
 suite,
but this example is actually not very I/O dominated. The variable $XDG_RUNTIME_DIR
can also be used, or $TMPDIR, depending on your system configuration. Another
option is using the <a href='mktemp.1.html'><i>mktemp(1)</i></a>
 command, e.g. <b>mktemp tmp.XXXXXXXX<b> <p>
Using <a href='tcppipe.1.html'><i>tcppipe(1NEMO)</i></b></b></a>

one can read data produced on other machines <p>
<a href='zrun.1.html'><i>zrun(1)</i></a>
 can uncompress on
the fly, by prepending it to the command <br>
<pre><tt> </tt>&nbsp;<tt> </tt>&nbsp;zrun fitsccd ngc6503.fits.gz - | tsf -
</pre><p>
<a href='pee.1.html'><i>pee(1)</i></a>
 is tee for pipes <p>
<a href='sponge.1.html'><i>sponge(1)</i></a>
 soaks up standard input and writes to
a file <p>
<a href='vipe.1.html'><i>vipe(1)</i></a>
 edits a pipe using your editor,e.g. <br>
<pre><tt> </tt>&nbsp;<tt> </tt>&nbsp;command1 | vipe | command2
</pre><p>
<a href='pv.1.html'><i>pv(1)</i></a>
 monitors the progress of data through a pipe, e.g. <br>
<pre>        mkplummer - 10000 nmodel=10 | pv | snapscale - . mscale=1
</pre>
<p> 
<h2><a name='sect3' href='#toc3'>PARALLEL and OpenMP</a></h2>
Most programs in NEMO are still single-core, but many
current machines have a number of cores. If a program only uses a fraction
of the memory on the machine, the GNU <a href='parallel.1.html'><i>parallel(1)</i></a>
 program can be used to
spread the load, e.g. <br>
<pre>       echo mkplummer . 10000 &gt; run.txt
       echo mkplummer . 10000 &gt;&gt; run.txt
       parallel --jobs 2 &lt; run.txt
</pre>which will run both jobs in parallel <p>
Although NEMO can be configured using
<b>--with-openmp</b> to take advantage of multi-cores OpenMP computing, there are
really no programs in NEMO taking advantage of this yet. However, programs
using <i>nemo_main()</i> should be aware of the user interface implications of
controlling how many cores are used: <br>
<pre>   0.  the number of cores as per omp_get_num_procs().  We actually take
a short-cut and use
       omp_get_max_threads() since it listens to OMP_NUM_THREADS (see next
item)
       [the user has no control over this]
   1.  setting the environment variable OMP_NUM_THREADS to the (max) number
of cores it will use
   2.  using the np= system keyword will override any possible setting of
OMP_NUM_THREADS
       in the step before.
   
</pre>
<p> 
<h2><a name='sect4' href='#toc4'>Slurm</a></h2>

<p> slurm is a popular package you will find on large computer clusters.

<p> 
<h2><a name='sect5' href='#toc5'>See Also</a></h2>
<a href='nemo.1.html'>nemo(1NEMO)</a>
, <a href='bench.5.html'>bench(5NEMO)</a>
, <a href='tee.1.html'>tee(1)</a>
, <a href='pee.1.html'>pee(1)</a>
, <a href='netcat.1.html'>netcat(1)</a>
, <a href='zrun.1.html'>zrun(1)</a>
,
<a href='parallel.1.html'>parallel(1)</a>
, <a href='sponge.1.html'>sponge(1)</a>
, <a href='vipe.1.html'>vipe(1)</a>
 
<p> 
<h2><a name='sect6' href='#toc6'>Author</a></h2>
Peter Teuben. 
<p> 
<h2><a name='sect7' href='#toc7'>Update History</a></h2>
<br>
<pre>18-Aug-88<tt> </tt>&nbsp;<tt> </tt>&nbsp;Document created<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT 
5-mar-89<tt> </tt>&nbsp;<tt> </tt>&nbsp;tabccd added         <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
6-mar-89<tt> </tt>&nbsp;<tt> </tt>&nbsp;ds added          <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
9-oct-90<tt> </tt>&nbsp;<tt> </tt>&nbsp;fixed some typos<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
jan-2020<tt> </tt>&nbsp;<tt> </tt>&nbsp;added pipe/shm<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
may-2021<tt> </tt>&nbsp;<tt> </tt>&nbsp;OpenMP<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Files: Compression and Such</a></li>
<li><a name='toc2' href='#sect2'>PIPES and SHARED MEMORY</a></li>
<li><a name='toc3' href='#sect3'>PARALLEL and OpenMP</a></li>
<li><a name='toc4' href='#sect4'>Slurm</a></li>
<li><a name='toc5' href='#sect5'>See Also</a></li>
<li><a name='toc6' href='#sect6'>Author</a></li>
<li><a name='toc7' href='#sect7'>Update History</a></li>
</ul>
</body>
</html>
