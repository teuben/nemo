<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>IO_NEMO(3NEMO) manual page</title>
</head>
<body bgcolor='white'>
HTML automatically generated with <A HREF=http://manpages.ubuntu.com/manpages/bionic/man1/rman.1.html>rman</A><br>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
<b>io_nemo</b> -- High level C function to read/save NEMO snapshot from a C
program. 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<br>
<pre>io_nemo(filename, param, ....)
char * filename;/* input/output file name */
char * param;   /* parameters list */

Descriptionio_nemo is a high level C function which allows the user to
perform I/O operations on NEMO snapshot files from a C program. It works
quite like C printf function. The use of this function is very simple and
require only some basic knowledge of how to program in NEMO. 

Parameters

 filename=character variable Input/Output file name of the NEMO snapshot
that you want to read/save. param=character Param is a string in which you
specify what you want to do with the NEMO file. Each choice is defined with
a flag separated with &rsquo;,&rsquo;. There are two kind of flags. (1) Information flags
allow to specify some actions during the I/O. (2) Variables flags allow
to specify what you want to get/put from/into the NEMO file. The FLAGS list
is described below. 
(1) Information flagss | save Specify that you want to
save data to a NEMO file. r | read Specify that you want to read data from
a NEMO file. float|single Specify that the variables that you use to get/put
data from/into NEMO files have been declared in single precision. (float).
double Specify that the variables you use to get/put data from/into NEMO
files have been declared in double precision. (double). info | diag Gives
some informations during the runtime execution. close Specify that you want
to close the NEMO file.  
(2) Variables flags n|nbody Match to the number
of bodies. t|time Match to the snapshot time. m|mass Match to the particle
masses. x|pos Match to the particle positions. v|vel Match to the particle
velocities. p|pot Match to the particle potentials. a|acc Match to the particle
accelerations. aux Match to the auxiliary array. k|keys Match to the keys
array. d|dens Match to the particle density. e|eps Match to the particle softening.
h|history Match to the NEMO file name that you want to keep track about
the history. st Select snapshot&rsquo;s times. You have to  put the selected time
in a string. Example "100:150" select the time beween 100 and 150. The string
is fully compatible with the expression usually given to nemoinpi (Cf man
nemoinpi). sp Select snapshot&rsquo;s particles. You have to  put the selected particles
in a string. Example "0:299999" select the particles beween 0 and 299999.
The returned nbody corresponds to the selected nbody. In the example above
it would thus be 300000. The string is fully compatible with the expression
usually given to nemoinpi (Cf man nemoinpi). b Integer variable to store
input/output bit flags (see $NEMOINC/snapshot/snapshot.h). During read operation,
this variable is filled up with OR bit operation according to the components
requested and the existing components in the file. Example: if you ask for
positons and potentials and no potentials exist on the snapshot, then bit
flags will contain only PosBit. During write operation, if it is used, io_nemo
engine will only save components, which have their bits positionned on
it, AND requested to be saved. (see a complete example here: $NEMOSRC/nbody/io_nemo/test_src/io_nemo_test.c).
 ArgumentsThe variable flags specify which data you will get/put from/into
the NEMO file, hence after the selection string param, you must insert
all the selected variables (arguments) in the same order with which they
have been declared in param. For each of the following requested flags:
n,t,m,x,v,a,p,b,k,e you **must** give as argument an address of pointer.
During read opreation, io_nemo check NULL pointer for each arguments. In
case of NULL pointer the memory is automatically allocated to fill up with
the requested component. If not NULL, io_nemo supposed that the pointer
is already allocated. For the flags sp,st,h you just have to give the pointer
as argument.  Return ValueThe function return 1 if successfull, 0 if the
end of snapshot has been reached, -2 if there is no ParticlesTag, or -1 if
at least one of the components requested does not exist (in that case you
should use &rsquo;b&rsquo; parameter to filter existing components).  ExampleHere is a
simple NEMO C program to illustrate the use of the function io_nemo(). The
program reads all the time steps into a NEMO a file, and saves the data
in another NEMO file. (See a more complete example here: $NEMOSRC/nbody/io_nemo/test_src/io_nemo_test.c).

/* ----------------------------------------------------- *\ 
|* NEMO program test using &rsquo;io_nemo()&rsquo; function
\* ----------------------------------------------------- */
#include &lt;stdinc.h&gt;
#include &lt;getparam.h&gt;
#include &lt;io_nemo.h&gt;
string defv[]=  
{ "in=???\n       input snapshot",
  "out=???\n      output snapshot",
  "VERSION=1.0\n  16-April-97 jcl",
  NULL
};
string usage="NEMO program test using &rsquo;io_nemo()&rsquo; function";
/* ----------------------------------------------------- *\ 
|* Main program
\* ----------------------------------------------------- */
nemo_main()
{
  float * pos=NULL, * vel=NULL, * mass=NULL;
  float * time=NULL;
  int   * nbody=NULL;
  string in,out;
  int i,j;
  in  =  getparam("in");
  out =  getparam("out");
  i = 1;
  while (i!=0) {
      /* read the NEMO snapshot */
      i=io_nemo(in,"float,n,t,x,v,m,read,info",
<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;&amp;nbody,&amp;time,&amp;pos,&amp;vel,&amp;mass);
      /* save the NEMO snapshot */
      if (i != 0)
<tt> </tt>&nbsp;<tt> </tt>&nbsp;j=io_nemo(out,"float,n,t,x,v,m,h,save,info",
<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;  &amp;nbody,&amp;time,&amp;pos,&amp;vel,&amp;mass,in);
  }
  /* close the output NEMO snapshot */
  io_nemo(out,"close");
}
/* ----------------------------------------------------- *\ 
|* END
\* ----------------------------------------------------- */

Important Thingsa) Notice in the example above, that in the parameter list,
&rsquo;n&rsquo; matches &rsquo;nbody&rsquo;, &rsquo;m&rsquo; matches &rsquo;mass&rsquo;, &rsquo;x&rsquo; matches &rsquo;pos&rsquo;, &rsquo;v&rsquo; matches &rsquo;vel&rsquo;, &rsquo;t&rsquo; matches
&rsquo;ts&rsquo;.  All the variables are in the same order that they have been declared
in the param list.  b) All the NEMO variables (nbody, time, mass, pos, vel,
acc, pot) must be declared as a pointer equal to NULL. During the io_nemo()
call, theses pointers will be allocated according the number of bodies
in the snapshot, so you must give the adress of the pointer ( ie : &amp;pos,
&amp;vel, ...etc).  c) All the floating arrays must be declared in the same floating
type.  d) During a "read" operation, the function io_nemo() return &rsquo;0&rsquo; if
it is the end of the NEMO file. That means that no new values have been
read.  </pre><p>

<h2><a name='sect10' href='#toc10'>Compilation</a></h2>
To use the function <i>io_nemo()</i> from a C program you must
link your program with the library <i>libnemo.a</i>  as described in the Makefile
below. <p>
<br>
<pre># ----------------------------------------
# MAKEFILE to use IO_NEMO
# 
# ----------------------------------------
# path for NEMO Library and IO_NEMO library
LIBS = -L$(NEMOLIB) -L/usr/local/lib
# 
CFLAGS = -I$(NEMOINC) -I$(NEMOLIB)
io_nemo_test : io_nemo_test.o
<tt> </tt>&nbsp;<tt> </tt>&nbsp;$(CC) -o $@ io_nemo_test.o $(LIBS) \
                  -lnemo -lm
# ----------------------------------------
</pre>
<h2><a name='sect11' href='#toc11'>See Also</a></h2>
<br>
<pre>nemo(1NEMO), snapshot(5NEMO).
</pre>
<h2><a name='sect12' href='#toc12'>Author</a></h2>
Jean-Charles LAMBERT 
<p> 
<h2><a name='sect13' href='#toc13'>BUGS and COMMENT</a></h2>
Please, report all bugs and
comment to :  <br>
<pre>Jean-Charles.Lambert@oamp.fr
</pre>
<h2><a name='sect14' href='#toc14'>Update History</a></h2>
<br>
<pre>15-Nov-96<tt> </tt>&nbsp;<tt> </tt>&nbsp; V1.0 : created                           JCL
21-Feb-97<tt> </tt>&nbsp;<tt> </tt>&nbsp; V1.1 : memory optimisation               JCL
16-Apr-97<tt> </tt>&nbsp;<tt> </tt>&nbsp; V1.11: manual created                    JCL 
19-Jul-02<tt> </tt>&nbsp;<tt> </tt>&nbsp; V1.2 : io_nemo and io_nemo_f unified     JCL
18-Mar-04<tt> </tt>&nbsp;<tt> </tt>&nbsp; V1.21: bugs fixed, softening added       JCL
03-Mar-05<tt> </tt>&nbsp;<tt> </tt>&nbsp; V1.30: memory bugs fixed, keybits added  JCL
<tt> </tt>&nbsp;<tt> </tt>&nbsp;                valgrind mem/leak safe            
24-Apr-06<tt> </tt>&nbsp;<tt> </tt>&nbsp; V1.31: memory leak fixed                 JCL
19-Jun-06<tt> </tt>&nbsp;<tt> </tt>&nbsp; V1.32: happy gfortran                    JCL
29-May-07<tt> </tt>&nbsp;<tt> </tt>&nbsp; V1.42: handle snapshot with different    JCL
<tt> </tt>&nbsp;<tt> </tt>&nbsp;                nbodies   
29-Feb-08<tt> </tt>&nbsp;<tt> </tt>&nbsp; V1.50: add Aux and Dens array            JCL
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>(1) Information flags</a></li>
<li><a name='toc5' href='#sect5'>(2) Variables flags</a></li>
<li><a name='toc6' href='#sect6'>Arguments</a></li>
<li><a name='toc7' href='#sect7'>Return Value</a></li>
<li><a name='toc8' href='#sect8'>Example</a></li>
<li><a name='toc9' href='#sect9'>Important Things</a></li>
<li><a name='toc10' href='#sect10'>Compilation</a></li>
<li><a name='toc11' href='#sect11'>See Also</a></li>
<li><a name='toc12' href='#sect12'>Author</a></li>
<li><a name='toc13' href='#sect13'>BUGS and COMMENT</a></li>
<li><a name='toc14' href='#sect14'>Update History</a></li>
</ul>
</body>
</html>
