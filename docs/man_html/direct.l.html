<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>DIRECT(1.2) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
<b>direct</b> - Calculates the gravitational acceleration and potential for
all particles in an N-body simulation output using the direct, O(N^2), method.

<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<b>direct</b> [-e &lt;fSoftRadius&gt;]  [-spline] [-plummer] [-uniform]  <br>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;[-p &lt;xyzPeriod&gt;] [-G &lt;fGravConst&gt;] [-b &lt;iBlockSize&gt;] <br>
 <br>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;[-dgs] [-do &lt;MarkFile&gt;] [-o &lt;FileName&gt;]<br>
 <br>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;[-i &lt;iChkptInterval&gt;] [-restart] [-v] [-t]<br>
 <br>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;<br>
 
<p> Reads particles from stdin in the tipsy binary format. 
<p> 
<h2><a name='sect2' href='#toc2'>Options</a></h2>
<b>[-e &lt;fSoftRadius&gt;]:</b>
Default: takes softening from input file <br>
This argument sets the softening length used in calculating the gravitational
interactions for all particles. 
<p> <b>[-spline]:</b> This is the default. <br>
Specifies that cubic spline softening is to be used. The equations for the
interaction are those specified by equations (A1) and (A2) from the paper
TREESPH: A UNIFICATION OF SPH WITH THE HIERARCHICAL TREE METHOD, Lars Hernquist
and Neal Katz, APJ Supplement Series 70:416-446, 1989. 
<p> <b>[-plummer]:</b> <br>
Specifies that plummer softening is to be used. The interaction is given
by phi = -m/(|r|^2 + h^2)^(1/2) and a = -m*r/(|r|^2 + h^2)^(3/2), where h is the softening
length and r is the vector from particle j to particle i.  Note: this type
of softening is NOT newtonian beyond some distance as are the other softening
methods. This can put an otherwise equilibrium model slightly out of equilibrium.

<p> <b>[-uniform]:</b> <br>
Specifies that uniform-density sphere softening is to be used. The  interaction
is given by phi = -m*|r|^2/h^3, a = -m*r/h^3  for (|r| &lt; h) and phi = -m/|r| and a =
-m*r/|r|^3 for (|r| &gt;= h) where h is the softening length and r is the vector
from particle j to particle i. 
<p> <b>[-p &lt;xyzPeriod&gt;]:</b> Default: non-periodic calculation
<br>
This argument specifies that periodic boundary conditions are to be considered
in calculating gravity. The argument value sets the size  (length of each
side) of the periodic box which contains the particles. The Ewald summation
method is used when calculating the gravitational interactions. 
<p> <b>[-G &lt;fGravConst&gt;]:</b>
Default fGravConst = 1.0 <br>
This argument allows the user to specify the gravitational constant used
by direct to calculate the gravitational interactions. 
<p> <b>[-b &lt;iBlockSize&gt;]:</b>
Default iBlockSize = 256 <br>
This argument optimizes direct&rsquo;s use of the primary cache on the machine.
It should be set to reflect the size of your machine&rsquo;s primary data cache.
The default value assumes a primary data cache size of 16k bytes. If you
know the size of your primary data cache then the formula is <b>iBlockSize</b>
= nPrimaryDataBytes / 64. You can also try different <b>iBlockSize</b> values on
a small data-set, to get the optimum value. 
<p> <b>[-dgs]:</b> Default: all particles
considered (-dgs) <br>
This set of flags allows the user to specify the particle types to be considered
for the gravity calculation. If the user specifies <b>-d,</b> then only the dark
matter particles are considered. With <b>-dg,</b> both dark and gas particles are
considered but any star particles are  ignored. The default is, effectively
<b>-dgs.</b> 
<p> <b>[-do &lt;MarkFile&gt;]:</b> Default action: all <b>[-dgs]</b> selected particles are calculated

<p> This flag allows only marked particles to be calculated. The effects of
the other selected particles are still taken into account. The mark file
is in TIPSY ARRAY format, where an entry of NOT-zero means that the particle
is marked for calculation. A zero entry means the particle&rsquo;s acceleration
and potential will not be calculated, but its effects on any marked particles
will be  included. The accelerations and potentials of all the unmarked
particles are output as zero. 
<p> <b>[-o &lt;FileName&gt;]:</b> Default Output Name = "direct"
<br>
This allows the user to specify an alternate name for the  output files.
For example, if the user specifies <b>-o king</b> on the command line, then direct
will by produce the files king.acc and king.pot. 
<p> <b>[-i &lt;iChkptInterval&gt;]:</b> Default
is no checkpoint files <br>
This argument enables the generation of checkpoint files. The interval between
successive checkpoints is given in number of blocks by <b>&lt;iChkptInterval&gt;.</b> This
is useful when large data-sets are being generated to allow recovery after
a system crash or other problem. The  <b>-restart</b> flag allows restarting the
calculation from the last checkpoint. 
<p> <b>[-restart]:</b> Default is no restart
<br>
This flag enables restart mode. All command line arguments are  ignored
other than  <b>-o &lt;FileName&gt;, -i &lt;iChkptInterval&gt;</b> and <b>-v.</b> If <b>-o &lt;FileName&gt;</b> is specified,
direct will restart the calculation from the checkpoint file &lt;FileName&gt;.chk,
otherwise it looks for the file direct.chk and restarts from that. Note:
if you do not specify a new &lt;iChkptInterval&gt;, then direct will not remove
the checkpoint file at the end of the calculation. 
<p> <b>[-v]:</b> Default is no output
<br>
This flag allows the user to enable diagnostic output (on stdout).  The
output produced is the block indecies which direct is currently processing.
The time between outputs should be roughly constant. This will make you
feel better when direct is calculating a lagre data-set, where the time
between start and any real output generated is large. It will also output
the CPU time used by direct a the end. 
<p> <b>[-t]:</b> Default is test-mode not enabled
<br>
This flag is a developer&rsquo;s flag and simply does a "no-brainer" N^2 algorithm
to test the other features of this tool. Checkpointing is not enabled when
this flag is specified. 
<p> 
<h2><a name='sect3' href='#toc3'>Description</a></h2>

<p> <b>Direct</b> is a tool designed to test more
complicated gravity codes such as Barnes-Hut, Fast Multipole and error-controlling
tree-codes as well as FFT codes. It is also the method of choice when dealing
with less than  about 10000 particles. The primary application remains the
testing and error analysis of more sophisticated codes. Typical things looked
at  are the distrbution of relative and absolute errors in the acceleration
as well as the maximum and rms values. Another application when a well understood
mass distribution is calculated (such as a king model), is the analysis
of the discreteness noise as a function of N. 
<p> The method used by direct
to calculate the gravitational accelerations and potentials is to process
the interaction matrix (an NxN matrix with  entry_ij being the interaction
between particle i and particle j) in blocks. The interaction matrix is
also anti-symmetric with respect to the accelerations (a_ij + a_ji = 0,
i!=j) and symmetric with respect to  potentials (p_ij - p_ji = 0, i!=j).
This allows only the lower triangle of blocks to be calculated, with special
treatment of the diagonal blocks. This makes direct quite a bit faster than
the simplest implementation, and when the block size is set properly (see
<b>-b &lt;iBlockSize&gt;</b> above) makes it scale exactly as O(N^2) in CPU time. 
<p> The softening
is now "symmetric", such that the softening used for an interaction is
taken to be the average of the softenings of the two interacting particles,
h_ij = 0.5*(h_i + h_j). For the case where all particles have the same softening,
the results are of course the same.  
<p> 
<h2><a name='sect4' href='#toc4'>Output Files</a></h2>

<p> <b>direct.acc</b> : This ASCII
file is in TIPSY VECTOR format  and contains the acceleration vectors of
all particles in  the input file. If certain types of particles were omitted
with the <b>-dgs</b> flag combination, then the acceleration in this file will
be zero for those particles. This file can be read in by tipsy or any other
analysis tool able to read this format. 
<p> <b>direct.pot</b> : This ASCII file is
in TIPSY ARRAY format  and contains the potentials of all particles in
 the input file. If certain types of particles were omitted with the <b>-dgs</b>
flag combination, then the potential in this file will be zero for those
particles. This file can be read in by tipsy or any other analysis tool
able to read this format. 
<p> 
<h2><a name='sect5' href='#toc5'>Examples</a></h2>

<p> &gt; direct -e 0.1 -o dark &lt; dark.bin 
<p> This calculates
the gravitational acceleration and potential for all particles in the tipsy
binary input file dark.bin. The softening radius is set to 0.1 and the masses
for the particles are taken from the  input file. The gravitational constant
is the default G = 1.0. The files dark.acc and dark.pot are produced. 
<p> &gt; direct
-p 1 -o dark_p &lt; dark.bin 
<p> This calculates the gravitational acceleration and
potential for all particles in the tipsy binary input file dark.bin. The
softening radii and masses for the particles are taken from the input file.
The calculation will take into consideration periodic boundary conditions
with a periodic box of length 1.0. The Ewald summation technique is used
to include the effects of periodic boundary conditions. The gravitational
constant is the default G = 1.0. The files dark_p.acc and dark_p.pot are produced.

<p> &gt; direct -e 0.025 -v -d &lt; gasrun.bin 
<p> This calculates the gravitational acceleration
and potential for only the dark matter particles of the input file gasrun.bin.
The accelerations and potentials of the gas particles will be set to zero
in the output  files. Verbose output is requested, and will cause direct
to output  diagnostic output on stdout. Softening radius of 0.025 is used
and the gravitational constant is again G = 1.0. The default files direct.acc
and direct.pot are produced. 
<p> &gt; direct -o big -v -i 10000 -restart 
<p> This restarts
a previous calculation from the checkpoint file, big.chk. Verbose output
is requested and a new checkpoint interval of 10000 is specified (this
is likely the same as the previously used value). 
<p> 
<h2><a name='sect6' href='#toc6'>Warnings</a></h2>

<p> 1) Since <b>direct</b>
is an O(N^2) method (and scales precisely so), it can take VERY long to
calculate large problems. For a million particles, a week to several weeks
of CPU time may be required. 
<p> 2) If you are using periodic boundary conditions
EXPECT the calculation to take about 100 times longer! This increase in
time is due to the  very expensive Ewald interactions. Note: faster, more
approximate  techniques exist for handling periodic BCs, but this code
was designed to provide a correct answer. 
<p> 3) Do NOT modify the doubles
in the code to floats. Although this  provides significant speedup, the
results may not be useful due to  round-off errors. 
<p> 4) Round-off and truncation
errors are an aspect where a high precision multipole calculation (such
as FMM code) may well produce more accurate results. Be careful in using
direct to test such codes! 
<p> 
<h2><a name='sect7' href='#toc7'>Bugs</a></h2>

<p> Please report any!   <br>
 
<h2><a name='sect8' href='#toc8'>See Also</a></h2>

<p> <a href='tipsy.1.html'>tipsy(1)</a>
, <a href='smooth.1.html'>smooth(1)</a>
 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> 
<p> <p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Options</a></li>
<li><a name='toc3' href='#sect3'>Description</a></li>
<li><a name='toc4' href='#sect4'>Output Files</a></li>
<li><a name='toc5' href='#sect5'>Examples</a></li>
<li><a name='toc6' href='#sect6'>Warnings</a></li>
<li><a name='toc7' href='#sect7'>Bugs</a></li>
<li><a name='toc8' href='#sect8'>See Also</a></li>
</ul>
</body>
</html>
