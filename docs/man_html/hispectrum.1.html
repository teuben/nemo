<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>HISPECTRUM(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
hispectrum - HI spectrum extraction and gridder 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<b>hispectrum</b> [parameter=value]

<h2><a name='sect2' href='#toc2'>Description</a></h2>
<i>hispectrum</i> can perform any of the following functions: <p>
1) List
the scan positions of a given HI survey dataset.  <p>
2) Extract a single spectrum
from the combined HI surveys.  It does this by simply searching through
the databases until the distance to the requested position is less than
a required miniumum distance. It can also report the nearest or take an
average of the spectra within a search radius. See the <b>mode=</b> keyword below.
<p>
3) Combine, weigh and grid spectra from the combined HI surveys into a
velocity-position-position (VLB) datacube. This is  generally a  time- and
disk-consuming task, since a temporary list of relevant scans is written
to disk into a scratch file. Note that creating a datacube is done by gridding
in X and Y, while the Velocity axis is sampled (interpolated) from a predefined
set of values (normally regular, like the grid in X and Y). <p>
The HI survey
databases live in either your current directory or the directory given
by the environment variable <b>HI_DIR</b>, and can be compressed (.Z or .gz) (see
<a href='hi.5NEMO.html'><i>hi(5NEMO)</i></a>
). 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
The following parameters are recognized in any order
if the keyword is also given: 
<dl>

<dt><b>hi=</b><i>HI_id</i> </dt>
<dd>Input dataset id&rsquo;s to combine {hh,pk,ar,bl,ww,kj,lb}.
 Minimum match is applied. See also <a href='hi.5NEMO.html'><i>hi(5NEMO)</i></a>
 for survey id&rsquo;s. [No default].
</dd>

<dt><b>lon=</b><i>l</i> </dt>
<dd>Desired galactic <a href='longitude.l.html'>longitude (l)</a>
 to find a single spectrum. Must be
in the range 0..360 degrees. If none supplied, all scan positions  in the
database will be shown. This keyword is only active when cube gridding (see
<b>cube=</b> below) has not been selected. </dd>

<dt><b>lat=</b><i>b</i> </dt>
<dd>Desired galactic latitude (b)
to find a single spectrum. Must be in the range -90..90 degrees. See comments
above. </dd>

<dt><b>vlsr=</b><i>vmin:vmax:vstep</i> </dt>
<dd>Velocity value samples (km/s, in LSR units),
on which the output spectrum is interpolated. If none choosen, the original
raw data will be shown.  When gridding a datacube (see <b>cube=</b> below),  you
<b>must</b> specify these output velocities since different datasets are on different
velocity scales (note: the user should compensate for interpolation using
the <b>bscale/bzero</b> keywords below). When a requested velocity is outside the
range of the raw data, 0.0 is returned in the spectrum.  Default: none. </dd>

<dt><b>cube=</b><i>fits_file</i>
</dt>
<dd>Output cube, if requested.  This file will be in standard <a href='fits.5NEMO.html'><i>fits(5NEMO)</i></a>
 format.
 Default: none, a single spectrum or all scan positions are listed (see
<b>lat=</b> and <b>lon=</b> above). </dd>

<dt><b>xgrid=</b><i>xmin,xmax,step</i> </dt>
<dd>X-range (min and max) and step,
in the output cube (see also <b>projection=</b>). If <i>xmin</i> is negative, the galactic
center will be properly placed  somewhere in the middle of the grid. Note
these values are the centers of the first and last pixel requested, not
the edges of the pixels. Default: none. </dd>

<dt><b>ygrid=</b><i>ymin,ymax,step</i> </dt>
<dd>Y-range (min
and max) and step, in the output cube  Note these values are the centers
of the first and last pixel requested. Default: none. </dd>

<dt><b>bscale=</b><i>scale_factor(s)</i>
</dt>
<dd>Scale factors applied to input spectra. See also <b>bzero=</b>. One value for each
input dataset much be given (see <b>hi=</b> above). Default: 1.0. </dd>

<dt><b>bzero=</b><i>offset(s)</i>
</dt>
<dd>Offset applied to input spectra after scaling (<b>bscale=</b>).  One for each input
dataset much be given (see <b>hi=</b> above). Default: 0.0. </dd>

<dt><b>weight=</b><i>factor(s)</i> </dt>
<dd>Relative
weight factor given to a dataset when they are combined. One for each input
dataset much be given (see <b>hi=</b> above). Default: 1.0 </dd>

<dt><b>ncell=</b> </dt>
<dd>Number of neighbor
cells to use in gridding. Default: 0 (only the scans in the cell of interest
are taken into account). </dd>

<dt><b>sigma=</b> </dt>
<dd>Weighting distance (in degrees) with which
data from neighboring  pixels are used to combine. Currently the weighing
function ... [Default: <b>1</b>]. </dd>

<dt><b>dist=</b> </dt>
<dd>Minimum distance when to stop searching for
a single spectrum. Only used if you want to override the one in the database
(it is probably not a good idea to use this keyword and let the database
choose a value). Default: not used, the internal database value (see <i>hi.h</i>:
 <b>hi_defs[].dist_min</b>) is used. </dd>

<dt><b>mode=first|aver|near</b>     </dt>
<dd>Modes in single spectrum
search. Possible modes are  <i>first, average,</i> and <i>nearest</i>. Minimum match applies.
[Default: <b>first</b>]. </dd>

<dt><b>clip=</b> </dt>
<dd>Range of brightness temperatures which to include
or exclude from the gridding. Note clipping occurs AFTER the data has been
rescaled with the <b>bzero,bscale</b> parameters(see above). Default: none. <i>** not
implemented **</i> </dd>

<dt><b>outfreq=</b> </dt>
<dd>Status output frequency (debug=1). Searching the
databases  for valid scans is very time consuming, and it&rsquo;s useful to keep
the user informed. Use <b>0</b> if no status output requested. Default: <b>100</b>. </dd>

<dt><b>projection=</b>
</dt>
<dd>Projection. Valid projections are <b>cartesian</b>, in which  galactic <a href='longitude.l.html'>longitude
(l)</a>
 and latitude (b) are gridded, <b>npolar</b> and <b>spolar</b> grid the north-polar
and south-polar cap resp. (<b>xgrid= and ygrid=</b> are also in degrees, and measure
the degrees away from the polar cap), <b>cos</b> and <b>aitoff</b>. For <b>npolar</b> the galactic
center is at the bottom,  running clockwise, for <b>spolar</b> at the top, running
counter clockwise. [Default: <b>cartesian</b>. </dd>

<dt><b>projpar=</b> </dt>
<dd>Optional parameters associated
with a projection. Currently only used for <b>cos</b> and <b>aitoff</b>  where they are
used to override the central longitude (the default being the mean of xmin
and xmax). </dd>

<dt><b>headline=</b><i>comments</i> </dt>
<dd>Comments added to table/fits file. Default:
none. </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Examples</a></h2>
The following example lists all scan positions (l, b, ra,
dec) for the (Heiles&amp;Habing) Hat Creek high latitude survey. Note the output
is very large (134932 scans) and has been redirected to a file <i>hh.pos</i>: <br>
<pre>    % hispectrum in=hh &gt; hh.pos
</pre><p>
This second example extracts a spectrum in the form of an ascii table. You
can plot it using NEMO&rsquo;s <i>tabplot</i> program, or go into a mongo-type program:
<br>
<pre>    % hispectrum in=hh lon=45 lat=20 &gt; hh.45.20.spectrum
</pre><p>
The third example grids a portion of the sky into a VLB  (velocity-longitude-latitude)
FITS cube: <br>
<pre>    % hispectrum in=hh,pk vlsr=-100:100:2 xgrid=200,300,2 ygrid=-30,30,2
\
        cube=cube1.fits 
</pre>
<h2><a name='sect5' href='#toc5'>Limitations</a></h2>
Program is disk space intensive: a scratch file with all velocity
interpolated scans within the ROI  (Region Of Interest: <b>xgrid, ygrid</b>) will
be created; this will need about <i>4 * nscans * nv</i> bytes. In addition the
output datacube will be <i> 4 * nv * nx * ny</i> in size. <i>nx, ny</i> are the number
of pixels in X and Y, <i>nv</i> those requested in velocity. The factor of 4 from
the assumption that a C-float needs 4 bytes storage. <p>
Velocity interpolation
is enforced, but when gridding and combining multiple dataset proper <b>bscale</b>
factor&rsquo;s need to be used to get the correct answer. I.e. each dataset should
be multiplied with the ratio of the channel separation of original divided
by new (interpolated) cube. 
<h2><a name='sect6' href='#toc6'>Bugs</a></h2>
<i>hispectrum</i> uses an internal fortran-to-c interface,
and is unlikely to work on Unix versions where this is very different from
the default BSD convention.  <p>
There is no check on available diskspace (scratch
spectra plus gridded  output data cube) before the program starts. To estimate
the size of the scratch file is difficult. <p>
Although gridding in X and Y
is forced to be regular, the one in V is not forced to be. The CDELT1 written
in the FITS file will be wrong in this case. <p>
If the number of spectra per
pixel is larger than a compiler defined value (<b>MAXSCAN</b>) the program will
crash after all the hard work of sorting spectra has been done; this will
happen  in the middle of writing the output FITS file. <p>
Only scans with known
format (as defined in <i>hi.h</i> are understood. No provisions for some free format
has been made yet. 
<h2><a name='sect7' href='#toc7'>Files</a></h2>
<br>
<pre>$HI_DIR/        <tt> </tt>&nbsp;<tt> </tt>&nbsp;directory, or colon separated searchpath, where the ascii
(raw) scans live.
$NEMO/usr/bima/hi  <tt> </tt>&nbsp;<tt> </tt>&nbsp;source code
hiXXXXXX           <tt> </tt>&nbsp;<tt> </tt>&nbsp;scratch file (see mktemp) with scans for the cube gridding
</pre>
<h2><a name='sect8' href='#toc8'>See Also</a></h2>
<a href='hi.5NEMO.html'>hi(5NEMO)</a>
, <a href='fitsio.3NEMO.html'>fitsio(3NEMO)</a>
, <a href='tabplot.3NEMO.html'>tabplot(3NEMO)</a>
, <a href='himap.1NEMO.html'>himap(1NEMO)</a>
, <a href='fitstohi.1NEMO.html'>fitstohi(1NEMO)</a>


<h2><a name='sect9' href='#toc9'>Author</a></h2>
Peter Teuben, William T. Reach (decode.f) 
<h2><a name='sect10' href='#toc10'>Update History</a></h2>
<br>
<pre>29-Jun-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.0 Created: simple spectrum extraction<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
1-jul-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.1 cube gridder - using nearest cells <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
6-jul-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.2 added HI_DIR, deleted nx=, ny=       <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
8-nov-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.3 10% faster code, but using 50% more memory<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
17-sep-93<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.6 added mode= for single spectrum search<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
2-apr-94<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.6a fixed bug in WW decoding           <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
6-apr-94<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.7 sigma=0 now default; delete scratchfile<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
29-sep-95<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.8 added npolar/spolar projection options <tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
x-mar-96<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.9 added cosb averagin, gridding options<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Examples</a></li>
<li><a name='toc5' href='#sect5'>Limitations</a></li>
<li><a name='toc6' href='#sect6'>Bugs</a></li>
<li><a name='toc7' href='#sect7'>Files</a></li>
<li><a name='toc8' href='#sect8'>See Also</a></li>
<li><a name='toc9' href='#sect9'>Author</a></li>
<li><a name='toc10' href='#sect10'>Update History</a></li>
</ul>
</body>
</html>
