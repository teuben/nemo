<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>HACKDENS(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
HTML automatically generated with <A HREF=http://manpages.ubuntu.com/manpages/bionic/man1/rman.1.html>rman</A><br>
<a href='#toc'>Table of Contents</a><p>

<p> 
<h2><a name='sect0' href='#toc0'>Name</a></h2>
hackdens - local density estimator using tree algorithm 
<p> 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<b>hackdens
in=</b>snapshot <b>out=</b>image [parameter=value] 
<p> 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<i>hackdens</i> calculates
the local density in the configuration space using the hierarchical N-body
algorithm (J. Barnes and P. Hut, <i>Nature</i> <b>324</b>, 446). For small N or systems
with complex geometry <a href='snapdens.1.html'><b>snapdens(1NEMO)</b></a>
 may be preferred. For even more performance,
<a href='density.1falcON.html'><b>density(1falcON)</b></a>
 can be used. <p>
The density can be writtin in the slot normally
used for Potentials (the default), or if <b>write_at_phi=f</b> be written to a
tag named <i>Density</i>. 
<p> 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
 The following parameters are recognized in
order; they may be given in any order if the keyword is also given. Use
--help to confirm this man page is up to date.  
<dl>

<dt><b>in</b>=<i>in-file</i> </dt>
<dd>Input data will
be read from <i>in-file</i> in snapshot format. </dd>

<dt><b>out</b>=<i>out-file</i> </dt>
<dd>Output data are written
to <i>out-file</i> in snapshot format. </dd>

<dt><b>neib</b>=<i>value</i> </dt>
<dd>Number of neighbors used to determine
the local density. The default of 6 is the recommended value by Casertano
&amp; Hut (1985) [default: 6]. 
<p> </dd>

<dt><b>rneib</b>=<i>value</i> </dt>
<dd>Initial radius to search the neighbors.
<i>Hackdens</i> adaptively change this search radius during the calculation. Therefore
it is definitely required that particles in the snapshot are arranged so
that the neighboring particles have similar local density. (See NOTES) [default:
0.1]. </dd>

<dt><b>write_at_phi</b>=<i>t|f</i> </dt>
<dd>Logical if the density data is written in the "Potential"
slot of the snapshot file. If false, the density will be written with tag
"Density". [default: f] </dd>

<dt><b>rsize</b>=<i>value</i> </dt>
<dd>Intial size of the root box. Box will
automatically expanded to keep all particles in it [defaults:4.0] </dd>

<dt><b>rmin</b>=<i>value</i>
</dt>
<dd>If given, the coordinates of the lower left corner of the initial box. If
not given, the center of the root box will lie at the origin. [defaults:none]
</dd>

<dt><b>options</b>=<i>option-string</i> </dt>
<dd>Output control options, specified as a comma-separated
list of keywords. Currently recognized keywords are: <b>mass</b>, <b>phase</b>: output
mass, phase space data with major data outputs [defaults:mass,phase]. </dd>

<dt><b>fcells</b>=<i>value</i>
</dt>
<dd>Ratio of cells to bodies, used  when allocating cells [defaults:0.9]. </dd>

<dt><b>nudge</b>=<i>size</i>
</dt>
<dd>
<p> </dd>

<dt><b>verbose</b>=<i>t|f</i> </dt>
<dd>Logical if print out the number of particles processed during
the calculation [defaults:f]. 
<p> </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Notes</a></h2>
Since the search radius is adaptively
changed during the calculation, the local density of particles which are
close in the position in the snapshot file should be similar. <p>
Ideally, it
is best if particles are sorted by the local density itself. Since the local
density is not available, the second choice is to sort particles with some
quantity that has strong correlation with the local density. For example,
if the potential is available, sort particles by potential. <p>
In many cases
the system is roughly spherically symmetric. That means the density has
strong correlation with the distance from the center of the cluster. Then
sorting particles by the distance from the center will improve the speed
significantly. 
<p> 
<h2><a name='sect5' href='#toc5'>Examples</a></h2>
The following example takes an N-body snapshot, sort
the particles in the order of the distance from the C.M., and calculate local
density. <br>
<pre>   snapcenter nbody.dat nbody.centered
   snapsort nbody.centered nbody.sorted rank="x*x+y*y+z*z"
   hackdens nbody.sorted nbody.density
</pre>One can also weight the particles by its potential to some power. For this
we create a Plummer sphere, without centering, and compute the center in
two ways: <br>
<pre>   mkplummer - 100 zerocm=f | snapsort - - rank=r &gt; p.dat
   snapcenter p.dat . report=t
   hackdens p.dat - | snapcenter  - . weight=dens report=t
   hackforce p.dat - | snapcenter - . weight="-phi*phi*phi" report=t
   hackforce p.dat - | snapcenter - . weight="phi*phi*phi*phi" report=t
   
</pre>Note that in this case the Plummer sphere should have the correct mathematical
center, and not <i>centered</i>. This snippet of code is expanded in a script $NEMO/scripts/csh/centering.sh,
in which these different methods can also be applied to different models,
as expanded in the following table. <br>
<pre>    nbody=100 models:     Plummer   King1   King3   King5  DeVauc
    -------------------------------------------------------------
    snapcenter  on m:       0.102   0.029*  0.030*  0.033   0.299
    snapcenter  on dens:    0.060   0.039   0.036   0.030   0.030*
    snapcenter  on phi:     0.053
    snapcenter  on phi^2:   0.050*
    snapcenter  on phi^3:   0.052   0.032   0.030   0.026*  0.035
    snapcenter  on phi^4:   0.054   0.034   0.032   0.027   0.031
    snapcenterp:            0.080
    snapmnmx on min phi:    0.122
    snapmnmx on m 50% phi:  0.058
    snapmnmx on m 33% phi:  0.063                           0.053
    snapmnmx on m 25% phi:  0.067
    rockstart on m:         0.082:
A (*) denotes the best method for that model.
</pre>Although for a Plummer sphere the best method is more than twice as good
than the worst method, this does not apply to other models. 
<p> 
<h2><a name='sect6' href='#toc6'>See Also</a></h2>
<a href='hackforce.1.html'>hackforce(1NEMO)</a>
,
<a href='snapdens.1.html'>snapdens(1NEMO)</a>
, <a href='snapcenterp.1.html'>snapcenterp(1NEMO)</a>
, <a href='density.1falcON.html'>density(1falcON)</a>
 <p>
<a href='https://ui.adsabs.harvard.edu/abs/1985ApJ...298...80C/'>https://ui.adsabs.harvard.edu/abs/1985ApJ...298...80C/</a>

- Casertano &amp; Hut (1985) 
<p> 
<h2><a name='sect7' href='#toc7'>Ads</a></h2>
@ads <A HREF=https://ui.adsabs.harvard.edu/abs/1985ApJ...298...80C> 1985ApJ...298...80C </A>
<p> 
<h2><a name='sect8' href='#toc8'>Bugs</a></h2>
The local density is
calculated using (neib-1)th neighbor. Calculation can become very slow if
the input snapshot is not well-formed. There should exist an option that
forces the density will be written in the "Aux" slot of the snapshot file.
Current version does not use standard <i>get_snap/put_snap</i> macros. KEY and
AUX will be lost from the output snapshot.  
<p> 
<h2><a name='sect9' href='#toc9'>Timing</a></h2>
N=4096, merger remnant
<p>
Presorted snapshot: 5 minutes on Sun-3/60, particles are presorted by the
distance from the center of mass of the system. <p>
Random snapshot: 60 minutes

<p>Sun-3/60 
<p> 
<h2><a name='sect10' href='#toc10'>Author</a></h2>
Jun Makino 
<p> 
<h2><a name='sect11' href='#toc11'>Update History</a></h2>
<br>
<pre>2-Dec-88  <tt> </tt>&nbsp;<tt> </tt>&nbsp;V1.0:Created  <tt> </tt>&nbsp;<tt> </tt>&nbsp;Jun
6-jul-89<tt> </tt>&nbsp;<tt> </tt>&nbsp;doc updated?<tt> </tt>&nbsp;<tt> </tt>&nbsp;Jun
23-oct-90<tt> </tt>&nbsp;<tt> </tt>&nbsp;doc updated<tt> </tt>&nbsp;<tt> </tt>&nbsp;Peter
18-jul-92<tt> </tt>&nbsp;<tt> </tt>&nbsp;printf -&gt; dprintf to make it pipable<tt> </tt>&nbsp;<tt> </tt>&nbsp;Peter
24-may-02<tt> </tt>&nbsp;<tt> </tt>&nbsp;fixed running out of bits for large-N systems<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
11-aug-2022<tt> </tt>&nbsp;<tt> </tt>&nbsp;added example hackforce vs. hackdens<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre>
<p> <p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Notes</a></li>
<li><a name='toc5' href='#sect5'>Examples</a></li>
<li><a name='toc6' href='#sect6'>See Also</a></li>
<li><a name='toc7' href='#sect7'>Ads</a></li>
<li><a name='toc8' href='#sect8'>Bugs</a></li>
<li><a name='toc9' href='#sect9'>Timing</a></li>
<li><a name='toc10' href='#sect10'>Author</a></li>
<li><a name='toc11' href='#sect11'>Update History</a></li>
</ul>
</body>
</html>
