<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>NLLSQFIT(3NEMO) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
nllsqfit, nr_nllsqfit - (non)linear least squares fit 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<br>
<pre>int nllsqfit(xdat, xdim, ydat, wdat, ddat, ndat, 
<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;fpar, epar, mpar, npar, 
<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;tol, its, lab, f, df)
int nr_nllsqfit(xdat, xdim, ydat, wdat, ddat, ndat, 
<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;fpar, epar, mpar, npar, 
<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;tol, its, lab, f, df)
  real *xdat, *ydat, *wdat, *ddat, *fpar, *epar, tol, lab;
  int  xdim, ndat, *mpar, npar, its;
  rproc f;
  iproc df;
</pre>
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<i>nllsqfit</i> is a routine for making a least-squares fit of a function
to a set of data points. The method used is described in: Marquardt, <i>J.Soc.Ind.Appl.Math.</i>
<b>11</b>, 431 (1963). (see also <i>Numerical Recipes</i>, Ch. 14) This method is a mixture
of the steepest descent method and the Taylor method. <p>
<i>nllsqfit</i> returns number
of iterations needed to achieve convergence according to <b>tol</b>.  When this
number is negative, the fitting was not continued because a fatal error
occurred: <br>
<pre>    -1     Too many free parameters, maximum "#define MAXPAR 32".
    -2     No free parameters.
    -3     Not enough degrees of freedom.
    -4     Too many iterations to get a solution which satisfies tol.
    -5     Diagonal of matrix contains elements which are zero, or less.
    -6     Determinant of the coefficient matrix is zero.
    -7     Square root of negative number.
</pre>A linear fit (<b>lab=0</b>) returns 0. <p>
<i>nr_nllsqfit</i> is a wrapper routine with the
same calling sequence, but calls the (NEMO adapted) Numerical Recipes routine
mrqmin() and its helper functions. 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>

<dl>

<dt><b>xdat</b>       </dt>
<dd>contains the coordinates
of the data points. <b>xdat</b> is two-dimensional: <b>xdat(xdim,ndatf</b>) in FORTRAN
notation or <b>xdat[ndat][xdim]</b> in C. sense. </dd>

<dt><b>xdim</b>       </dt>
<dd>is the dimension of
the fit. </dd>

<dt><b>ydat</b>       </dt>
<dd>contains the data points. </dd>

<dt><b>wdat</b>       </dt>
<dd>contains the weigths
for the data points.  Can be a NULL pointer, in which case all weights are
equal. </dd>

<dt><b>ddat</b>       </dt>
<dd>contains the difference between data and fit. Can be a
NULL pointer, in which case no fit differences are returned. </dd>

<dt><b>ndat</b>      
</dt>
<dd>is the number of data points. </dd>

<dt><b>fpar</b>       </dt>
<dd>On input contains initial estimates
of the parameters for non-linear fits, on output the fitted parameters. </dd>

<dt><b>epar</b>
      </dt>
<dd>contains estimates of errors in fitted parameters.  </dd>

<dt><b>mpar</b>       </dt>
<dd>logical
mask telling which parameters are free (<b>mpar[j]</b>=non-zero) and which parameters
are fixed (<b>mpar[j]</b>=0). </dd>

<dt><b>npar</b> </dt>
<dd>number of parameters (free+fixed). </dd>

<dt><b>tol</b>      
 </dt>
<dd>relative tolerance. <i>nllsqfit</i> stops when successive iterations fail to produce
a decrement in reduced chi-squared less than <b>tol</b>. If <b>tol</b> is less than the
minimum tolerance possible, <b>tol</b> will be set to this value. This means that
maximum accuracy can be obtained by setting <b>tol</b>=0.0. </dd>

<dt><b>its</b>       </dt>
<dd>maximum number
of iterations. </dd>

<dt><b>lab</b>       </dt>
<dd>mixing parameter, <b>lab</b> determines the initial weight
of steepest descent method relative to the Taylor method. <b>lab</b> should be
a small value (i.e. 0.01). <b>lab</b> can only be zero when the partial derivatives
are independent of the parameters. In fact in this case <b>lab</b> should be exactly
equal to zero, in which case the fit can (or is assumed to) be done linear.
</dd>

<dt><b>f</b><tt> </tt>&nbsp;<tt> </tt>&nbsp;         </dt>
<dd>external function, must return a real value, see below. </dd>

<dt><b>df</b><tt> </tt>&nbsp;<tt> </tt>&nbsp; </dt>
<dd>external
function, returns the partial deriviates to the fitted parameters, see
below </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Notes</a></h2>
The following routines have to be defined by the user: <br>
<pre>      real func(xdat, fpar, npar)
      func          returns the function value of the function to be fitted.
      real xdat[]   (input) coordinate(s) of data point.
      real fpar[]   (input) parameter list.
      int  npar     (input) number of parameters.
</pre><p>
      void derv(xdat, fpar, dpar, npar)<br>
 
<p>       real xdat[]   (input) coordinate(s) of data point.<br>
       real fpar[]   (input) parameter list.<br>
       real dpar[]   (output) partial derivatives to the parameters of
the<br>
                              function to be fitted.<br>
       int  npar     (input) number of parameters.<br>
 </pre>
<h2><a name='sect5' href='#toc5'>Example</a></h2>
Fitting a straight line <i> y(x) = a * x + b </i>: <p>
<br>
<pre>    real func(real *xdat, real *fpar, int npar)
    {
        return fpar[0] * (*xdat) + fpar[1];
    }
              
    void derv(real *xdat, real *fpar, real *dpar, int npar)
    {
        dpar[0] = *xdat;
        dpar[1] = 1.0;
    }
</pre>
<h2><a name='sect6' href='#toc6'>Files</a></h2>
nllsqfit.c 
<h2><a name='sect7' href='#toc7'>See Also</a></h2>
<a href='linreg.3.html'>linreg(3NEMO)</a>
, <a href='matinv.3.html'>matinv(3NEMO)</a>
, FIT.DC2(GIPSY) 
<h2><a name='sect8' href='#toc8'>Author</a></h2>
K.G.
Begeman (originally named FIT.SHL, in Sheltran), P.J. Teuben (C) 
<h2><a name='sect9' href='#toc9'>Copyright</a></h2>
Copyright
(c) Kapteyn Laboratorium Groningen 1990; All Rights Reserved. 
<h2><a name='sect10' href='#toc10'>History</a></h2>
<br>
<pre>May  7, 1990    Document created(KGB), document refereed(MXV)
Apr 30, 1991    NEMO version written for rotcur, as old PJT
July 23, 1992   manual page written PJT
Aug 20, 1992    turbocharged getvec() considerably  PJT
July 12, 2002<tt> </tt>&nbsp;<tt> </tt>&nbsp;allow &rsquo;wdat&rsquo; to be a NULL vector if all weights the same<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Notes</a></li>
<li><a name='toc5' href='#sect5'>Example</a></li>
<li><a name='toc6' href='#sect6'>Files</a></li>
<li><a name='toc7' href='#sect7'>See Also</a></li>
<li><a name='toc8' href='#sect8'>Author</a></li>
<li><a name='toc9' href='#sect9'>Copyright</a></li>
<li><a name='toc10' href='#sect10'>History</a></li>
</ul>
</body>
</html>
