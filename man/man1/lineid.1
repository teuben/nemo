.TH LINEID 1NEMO "19 January 2026"

.SH "NAME"
lineid \- spectral line ID tool

.SH "SYNOPSIS"
\fBlineid\fP in=file [parameter=value]

.SH "DESCRIPTION"
\fBlineid\fP is a tool that helps with converting between frequencies and doppler velocities, as well
as identifying lines when the rest frequency can be derived.

.PP
\fBlineid\fP currently operates in three modes:

.br
1. For a given doppler velocity (\fBvel=\fP) and an input list of sky
frequencies, the rest frequencies are calculated, and if a linelist
is given, a lineid is attempted. This will be useful for multiple
spectral lines in a given object.

.br
2. For a given rest frequency (\fBrestfreq=\fP) and an input list of
sky frequencies, their doppler shifts are calculated in a variety of
conventions (radio, relativistic, optical, and z). This will be useful
for a large field of view where always the same line (e.g. HI) is
detected in many sources at different cosmological distances.

.br
3. For a given \fBrestfreq=\fP and an input list of velocities (now
with \fBxunit=km/s\fP), the rest frequencies of the other lines are
computed, and a lineid can be attempted. The first velocity in the
list needs to match the given rest frequency This is probably a rare
case, as spectra typically originate in frequency, not doppler
velocity.

.br
4. For given \fBvel=\fP and list of velocities there is no
practical application? It can probably be run as mode 3.

.PP
In cases 1. and 3. a lineid can be attempted if a line list is supplied using \fBlinelist=\fP.
See LINELIST below for examples of line lists.

.PP
\fBlineid\fP can also attempt to find the strongest peak
in a spectrum if both the X and Y columns are given, but
\fItabpeak(1NEMO)\fP is probably a better feed into \fBlineid\fP.

.PP
More sophisticated algorithms for lineid can be found in ADMIT's LineID task, in particular
dealing with multiple "spectra" derived from a fits cube.

.SH "PARAMETERS"
.so man1/parameters
.TP 20
\fBin=\fP\fIfile\fP
Input file name, in ASCII \fItable(5NEMO)\fP format.  The number of columns will depend
on which of the xcol,ycol,dycol is used.
.br
No default.
.TP
\fBxcol=\fP\fIx-column\fP
X coordinate column, representing the frequency or wavelength axis.
Units are GHz, unless specified with the \fBxunit\fP keyword. The X column
is always required.
.br
[1]
.TP
\fBycol=\fP\fIy-column\fP
Y coordinate column, reprepenting an intensity. If not used, the xcol is assumed
to have the already determined values of the lines to be identified or
converted to doppler velocities.
.br
By default not used.
.TP
\fBdxcol=\fP\fIx-err-column\fP
Errors in the X coordnates. Only makes sense if no ycol is given.  Not implemented yet.
.br
By default not used.
.TP
\fBxunit=\fP
X axis unit. Currently only GHz and km/s are supported.
.br
[GHz]
.TP
\fBvel=[#[,unit]]\fP
Redshift of object, in km/s. Optional unit added, e.g. \fIvel=1.2,z\fP.
As for unit, only \fIkm/s\fP and the dimensionless \fIz\fP are allowed.
.br
Not set by default. If a value is given, the unit defaults to \fIkm/s\fP.
.TP
\fBrestfreq=\fP
If line is known, give rest frequency in \fBxunit\fP (only GHz supported now).
In a future version \fIrestwave=\fP might be supported.
.br
Not set by default.
.TP
\fBlinelist=\fP
Table with frequencies and line names. There is a simple list in $NEMODAT/z_lines.list
with some common high-Z lines.
.br
Not set by default.
.TP
\fBdv=\fP
Report all lines within \fBdv\fP km/s.
Negative values will use nearest neighbor and report the dv, and report but comment
out the line if the deviation is larger than -dv.
.br
[-10]
.TP
\fBclip=\fP
Do not fit peaks in the spectrum below this clip level.
.br
Default: not used
.TP
\fBveldef=RAD|OPT|REL\fP
Mode of velocity axis. Radio, Relativistic, or Optical are supported.
.br
[OPT]

.SH "CAVEATS"

The code was developed with frequency in mind, only GHz and km/s are supported. Wavelength
is planned.

Looks for a single emission line in the strongest peak.. May not work for absorption lines yet, or
use \fItabpeak(1NEMO)\fP if multiple lines are needed. See EXAMPLES below.

Although different doppler conventions are supported, coordinate frames are ignored.

.SH "EXAMPLES"
The following three example generates a spectrum from a random table of 115 values,
smoothes by 10 channels to create a handful
of peaks and investigates the strongest peak, which happens to be near 40 "GHz".  The frequencies
are labeled 0 to 114 in steps of 1 GHz.
.EX

  #> mode 1.
  tabgen - 115 1 2 123 | tabsmooth - 1 12 10,5 |\\
        lineid - 0 1 vel=1.872,z dv=200 linelist=$NEMODAT/z_lines.list
  ### nemo Debug[0]: Vrad=195408 Vrel=234961 Vopt=561211 z=1.872
  ### nemo Debug[0]: Found 23 lines in the linelist=/home/teuben/nemo/data/z_lines.list
  # There are 1 restfreq's to identify:
  # Commented lines do not fall within dv=200 km/s
  #    guess    ID    LINE     dFreq    deltaV  NAME
  #    GHz            Ghz      GHz      km/s
    115.230827   2 115.271202 0.040375 105.006 CO(1-0)


  #> mode 2.
  tabgen - 115 1 2 123 | tabsmooth - 1 12 10,5 | tabpeak -  0 1 |\\
        lineid - restfreq=115
  # restfreq=115
  # SkyFreq Vrad  Vrel   Vopt    z
  # GHz     km/s  km/s  km/s    
  29.914   221810 261794 852717  2.84436
  40.1222  195198 234729 559487  1.86625
  72.1352  111744 130493 178145  0.594229


  #> mode 3.
  tabgen - 115 1 2 123 | tabsmooth - 1 12 10,5 | tabpeak -  0 1 |\\
        lineid - restfreq=115 xunit=km/s
  ### nemo Debug[0]: Reading 2 column(s)
  # There are 3 restfreq's to identify: (use linelist= to find their names)
  115.000000
  114.996085
  114.983808

.EE

and here some examples with no input spectrum. Only \fBxcol=\fP is needed:

.EX

  #> mode 1.
  echo 1.397105 | lineid - vel=5000 
  ### nemo Debug[0]: Vrad=4917.98 Vrel=4958.31 Vopt=5000 z=0.0166782
  # There are 1 restfreq's to identify: (use linelist= to find their names)
  1.420406
  

  #> mode 2.
  nemoinp 1.397105,1.1 | lineid - restfreq=1.420405751786 
  # restfreq=1.42041
  # SkyFreq Vrad    Vrel     Vopt     z
  # GHz     km/s    km/s     km/s
  1.39711  4916.83  4957.14  4998.81  0.0166742
  1.1     67625.2  75009.8  87322.9   0.291278


  #> mode 3.
  echo 5000 | lineid - restfreq=1.420405751786 xunit=km/s
  ### nemo Debug[1]: 0a: Line at 5000.000000 km/s has skyfreq 1.397105  restfreq 1.420406
  # There are 1 restfreq's to identify: (use linelist= to find their names)
  1.420406

.EE

An contrived example of the CO(1-0) and CO(2-1) lines from the CO
ladder, deliberately doppler shifted a bit by 300 km/s (give or take):

.EX

  #> mode 1.
  nemoinp 110.092,115.155,220.179,230.308  |\\
      lineid - linelist=$NEMODAT/z_lines.list vel=300 dv=2.5
  ### nemo Debug[0]: Vrad=299.7 Vrel=299.85 Vopt=300 z=0.00100069
  ### nemo Debug[0]: Found 23 lines in the listlist /home/teuben/NEMO/nemo/data/z_lines.list
  # There are 4 restfreq's to identify:
  #    guess    ID    LINE     dFreq    deltaV   NAME
  #    GHz            Ghz      GHz      km/s
    110.202168   1 110.201354 0.000814 -2.21418  13CO(1-0)
  # 115.270235   2 115.271202 0.000967  2.51514  CO(1-0)
    220.399331   3 220.398680 0.000651 -0.886089 13CO(2-1)
    230.538467   4 230.538000 0.000467 -0.607859 CO(2-1)
    
.EE

Here an example of detected lines in velocity space and deriving their
restfreq's.  The first line in the list will be the one belonging to
the known restfreq of CO(1-0), and was detected at -20 km/s. But there
was a weak line at -312 km/s with unknown identification. To find what
line this is, We need to find the rest frequency and then a lineid. In
the example we only grab the restfreq's.

.EX

  #> mode 3.
  nemoinp -20,-310 | lineid - restfreq=115.2712018 xunit=km/s
  # There are 2 restfreq's to identify: (use linelist= to find names)
  115.271202
  115.382823
  
.EE

There is indeed a known SiC2,v=0 line at 115.382367 GHz.

.PP

Compare different doppler conventions (veldef)
.EX

  #> mode 1.
  echo 0 | lineid - vel=5000 veldef=rel
  ### nemo Debug[0]: rad=4958.99 rel=5000 opt=5042.4 z=0.0168196

.EE

.SH "LINELIST"
The input linelist is a very simple ascii table of (frequency,name).
There are many sources for a linelist, we mention a few:
.nf

1. $NEMO/data/z_lines.list : common high-Z lines, from HI at 1.4GHz upwards

2. ADMIT'S has a few in $ADMIT/etc/*list

3. Splatalogue at https://www.splatalogue.online/

4. Astroquery:   https://astroquery.readthedocs.io/en/latest/nist/nist.html and
   https://astroquery.readthedocs.io/en/latest/atomic/atomic.html


.fi

.SH "SEE ALSO"
tablsqfit(1NEMO), tabpeak(1NEMO), tabpp(1NEMO), ccdsky(1NEMO), table(5NEMO)
.PP
admit::LineID_AT()

.SH "AUTHOR"
Peter Teuben

.SH "UPDATE HISTORY"
.nf
.ta +1.25i +4.5i
13-dec-2024	0.1 Draft created	PJT
3-jul-2025	0.3 add mode=	PJT
15-jan-2026	0.4 added simple nearest neighbor line_id	PJT
16-jan-2026	0.5 implemented veldef=		PJT
17-jan-2026	0.6 mode= deprecated	PJT
18-jan-2026	0.7 removed never used keywords		PJT
.fi
