#	~/src/lars
include $(NEMOLIB)/makedefs

CFLAGS = 
FFLAGS = 

#	maximum number of particles which can be integrated by treecode
NMAX = 1024
#	dimension of problem (2 or 3)
NDIM = 3

L = $(NEMOLIB)/libnemo.a
LIBF77 = -lF77 -lI77 -lU77 -lF77 -lI77 -lU77

SRCDIR = $(NEMO)/src/nbody/evolve/treecode

FINC = treedefs.inc nmax.inc
CINC = common.h nmax.h
INC = $(FINC) $(CINC)
SRC = main.c treecode.f treeio.c treegr3d.f treeload.f
BIN = treecode
MAN1= treecode.1

help:
	@echo "Hernquist version of hackcode"
	@echo "Various Fortran and C versions available"
	@echo "target:     main:    I/O:"
	@echo ""
	@echo " ff         F        F        (vanilla I/O)"
	@echo " cc         c        c        (nemo)"
	@echo ""
	@echo "Note:"
	@echo "User definable macro is the NMAX macro (currently $(NMAX))"
	@echo "which is used to generate a new include file"
	@echo "such that this will be the maximum number of particles"
	@echo "that can be integrated with NBODY0"
	@echo "Assuming your local fortran compiler FC=$(FC) knows the"
	@echo "INCLUDE statement."

clean:
	rm -f *.o $(BIN) core

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#		N E M O  Install					#
nemo_lib:
	@echo No nemo_lib in `pwd`
#									#
nemo_bin:
	@echo "TREECODE requires manual install - compiler must be "
	@echo "       a truly recursive one. SUN OS <=4.0 has problems"

nemo_src:
#									#
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 

install:  install_src install_man

install_src: Makefile $(SRC) $(INC)
	cp $? $(SRCDIR)
	@touch install_src

install_man:  install_man1

install_man1: $(MAN1)
	cp $? $(NEMOPATH)/man/man1
	@touch install_man1

install_bin: $(BIN)

#  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  
treecode: main.c treecode.o treeio.o treegr3d.o treeload.o
	$(CC) $(CFLAGS) -o treecode main.c \
                treecode.o treeio.o treegr3d.o treeload.o \
 		$(L) $(LIBF77) -lm

treeio.o: treeio.c $(CINC)
	$(CC) $(CFLAGS) -c treeio.c

treecode.o: treecode.f $(FINC)
	$(FC) $(FFLAGS) -c treecode.f

treegr3d.o: treegr3d.f $(FINC)
	$(FC) $(FFLAGS) -c treegr3d.f

treeload.o: treeload.f $(FINC)
	$(FC) $(FFLAGS) -c treeload.f

nmax:	.dummy

.dummy:
	@echo "C include file generated by Makefile - do not edit" > nmax.inc
	@echo "C see Makefile for instructions"                   >> nmax.inc
	@echo "      PARAMETER ( NMAX=$(NMAX) )"                  >> nmax.inc
	@echo "      PARAMETER ( NDIM=$(NDIM) )"                  >> nmax.inc
	@echo "C end of include file"                             >> nmax.inc
	@echo "#define NMAX $(NMAX)"  > nmax.h
	@echo "#define NDIM $(NDIM)" >> nmax.h
	@echo "A new file nmax.inc and nmax.h with NMAX=$(NMAX) and NDIM=$(NDIM)"
	@echo "have just been created"

testrec:	testrec.f
	$(FC) $(CFLAGS) -o testrec testrec.f
